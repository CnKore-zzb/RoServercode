-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【中毒】
function CommonFun.calcAttrPoisonRate(srcUser, targetUser)
local Luk=srcUser:GetProperty("Luk")
local Vit=targetUser:GetProperty("Vit")
local Int=targetUser:GetProperty("Int")
local A = math.max(0.1,Luk*0.5/100)
local B = math.min(0.8,(Vit*0.3+Int*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end
-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【流血】
function CommonFun.calcAttrBlindRate(srcUser, targetUser)
local Int=srcUser:GetProperty("Int")
local Vit=targetUser:GetProperty("Vit")
local Int2=targetUser:GetProperty("Int")
local A = math.max(0.1,Int*0.5/100)
local B = math.min(0.8,(Vit*0.3+Int2*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end
-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【灼烧】
function CommonFun.calcAttrBurnRate(srcUser, targetUser)
local Int=srcUser:GetProperty("Int")
local Vit=targetUser:GetProperty("Vit")
local Agi=targetUser:GetProperty("Agi")
local A = math.max(0.1,Int*0.5/100)
local B = math.min(0.8,(Vit*0.3+Agi*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end
-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【眩晕】
function CommonFun.calcAttrDizzyRate(srcUser, targetUser)
local Str=srcUser:GetProperty("Str")
local Vit=targetUser:GetProperty("Vit")
local Agi=targetUser:GetProperty("Agi")
local A = math.max(0.1,Str*0.3/100)
local B = math.min(0.8,(Vit*0.3+Agi*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【冰冻】
function CommonFun.calcAttrFreezeRate(srcUser, targetUser)
local Int=srcUser:GetProperty("Int")
local Int2=targetUser:GetProperty("Int")
local Dex=targetUser:GetProperty("Dex")
local A = math.max(0.1,Int*0.3/100)
local B = math.min(0.8,(Int2*0.3+Dex*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【石化】
function CommonFun.calcAttrStoneRate(srcUser, targetUser)
local Int=srcUser:GetProperty("Int")
local Int2=targetUser:GetProperty("Int")
local Dex=targetUser:GetProperty("Dex")
local A = math.max(0.1,Int*0.3/100)
local B = math.min(0.8,(Int2*0.3+Dex*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【睡眠】
function CommonFun.calcAttrSleepRate(srcUser, targetUser)
local Dex=srcUser:GetProperty("Dex")
local Int=targetUser:GetProperty("Int")
local Luk=targetUser:GetProperty("Luk")
local A = math.max(0.1,Dex*0.3/100)
local B = math.min(0.5,(Int*0.3+Luk*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【恐惧】
function CommonFun.calcAttrFearRate(srcUser, targetUser)
local Dex=srcUser:GetProperty("Dex")
local Int=targetUser:GetProperty("Int")
local Luk=targetUser:GetProperty("Luk")
local A = math.max(0.1,Dex*0.5/100)
local B = math.min(0.5,(Int*0.3+Luk*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end
-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【定身】
function CommonFun.calcAttrSlowRate(srcUser, targetUser)
local Agi=srcUser:GetProperty("Agi")
local Vit=targetUser:GetProperty("Vit")
local Str=targetUser:GetProperty("Str")
local A = math.max(0.1,Agi*0.4/100)
local B = math.min(0.6,(Vit*0.3+Str*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end
-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【沉默】
function CommonFun.calcAttrSilenceRate(srcUser, targetUser)
local Dex=srcUser:GetProperty("Dex")
local Vit=targetUser:GetProperty("Vit")
local Str=targetUser:GetProperty("Str")
local A = math.max(0.1,Dex*0.5/100)
local B = math.min(0.6,(Vit*0.3+Str*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【诅咒】
function CommonFun.calcAttrCurseRate(srcUser, targetUser)
local Str=srcUser:GetProperty("Str")
local Int=targetUser:GetProperty("Int")
local Dex=targetUser:GetProperty("Dex")
local A = math.max(0.1,Str*0.5/100)
local B = math.min(0.5,(Int*0.3+Dex*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的概率计算公式--【黑暗】
function CommonFun.calcAttrDarkRate(srcUser, targetUser)
local Str=srcUser:GetProperty("Str")
local Int=targetUser:GetProperty("Int")
local Dex=targetUser:GetProperty("Dex")
local A = math.max(0.1,Str*0.5/100)
local B = math.min(0.5,(Int*0.3+Dex*0.3)/100)
local Rate = 1 + A - B 
if Rate <= 0 then
   Rate = 0
end
return Rate   
end
-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【中毒】
function CommonFun.calcAttrPoisonTime(srcUser, targetUser)
local Luk=srcUser:GetProperty("Luk")
local Vit=targetUser:GetProperty("Vit")
local A = math.max(0.3,Luk*0.6/100)
local B = math.min(0.8,Vit*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end
-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【流血】
function CommonFun.calcAttrBlindTime(srcUser, targetUser)
local Int=srcUser:GetProperty("Int")
local Vit=targetUser:GetProperty("Vit")
local A = math.max(0.3,Int*0.6/100)
local B = math.min(0.8,Vit*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end
-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【灼烧】
function CommonFun.calcAttrBurnTime(srcUser, targetUser)
local Int=srcUser:GetProperty("Int")
local Vit=targetUser:GetProperty("Vit")
local A = math.max(0.3,Int*0.6/100)
local B = math.min(0.8,Vit*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end
-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【眩晕】
function CommonFun.calcAttrDizzyTime(srcUser, targetUser)
local Str=srcUser:GetProperty("Str")
local Vit=targetUser:GetProperty("Vit")
local A = math.max(0.3,Str*0.6/100)
local B = math.min(0.8,Vit*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【冰冻】
function CommonFun.calcAttrFreezeTime(srcUser, targetUser)
local Int=srcUser:GetProperty("Int")
local Int2=targetUser:GetProperty("Int")
local A = math.max(0.3,Int*0.6/100)
local B = math.min(0.8,Int2*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【石化】
function CommonFun.calcAttrStoneTime(srcUser, targetUser)
local Int=srcUser:GetProperty("Int")
local Int2=targetUser:GetProperty("Int")
local A = math.max(0.3,Int*0.6/100)
local B = math.min(0.8,Int2*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【睡眠】
function CommonFun.calcAttrSleepTime(srcUser, targetUser)
local Dex=srcUser:GetProperty("Dex")
local Int=targetUser:GetProperty("Int")
local A = math.max(0.3,Dex*0.6/100)
local B = math.min(0.8,Int*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【恐惧】
function CommonFun.calcAttrFearTime(srcUser, targetUser)
local Dex=srcUser:GetProperty("Dex")
local Int=targetUser:GetProperty("Int")
local A = math.max(0.3,Dex*0.6/100)
local B = math.min(0.8,Int*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end
-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【定身】
function CommonFun.calcAttrSlowTime(srcUser, targetUser)
local Agi=srcUser:GetProperty("Agi")
local Vit=targetUser:GetProperty("Vit")
local A = math.max(0.3,Agi*0.6/100)
local B = math.min(0.8,Vit*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end
-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【沉默】
function CommonFun.calcAttrSilenceTime(srcUser, targetUser)
local Dex=srcUser:GetProperty("Dex")
local Vit=targetUser:GetProperty("Vit")
local A = math.max(0.3,Dex*0.6/100)
local B = math.min(0.8,Vit*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【诅咒】
function CommonFun.calcAttrCurseTime(srcUser, targetUser)
local Str=srcUser:GetProperty("Str")
local Int=targetUser:GetProperty("Int")
local A = math.max(0.3,Str*0.6/100)
local B = math.min(0.8,Int*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end

-----------------------------------------------------------------------------------------------------------------------------------------------素质影响的BUFF的时间计算公式--【黑暗】
function CommonFun.calcAttrDarkTime(srcUser, targetUser)
local Str=srcUser:GetProperty("Str")
local Int=targetUser:GetProperty("Int")
local A = math.max(0.3,Str*0.6/100)
local B = math.min(0.8,Int*0.4/100)
local Time = 1 + A - B 
if Time <= 0 then
   Time = 0
end
return Time   
end



-------------------------------------------------------------------------------------------------------------------------------------------------BUFF的概率和时间计算公式
function CommonFun.calcBuffValue(srcUser, targetUser, type, a, b, c, d,lv,damage)
  if CommonFun.CalcBuffFuncs[type] == nil then
    return 0
  end
  return CommonFun.CalcBuffFuncs[type](srcUser, targetUser, a, b, c, d,lv,damage)
end
----------------------------------------------------------------------------------------------------------点燃效果
function CommonFun.calcBuff_20(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
 
  local Int = srcUser:GetProperty("Int")
  local Vit = srcUser:GetProperty("Vit")
  local MAtk = srcUser:GetProperty("MAtk")
  local MAtkPer1 = srcUser:GetProperty("MAtkPer")
  ------------------------------------------------------------------------------------星盘带来的额外魔法攻击加成效果
  local Num1 = srcUser:GetRunePoint(22008)
  local Num2 = srcUser:GetRunePoint(22009)
  local RuneDamage = (Num1 + Num2)*0.03 
  local MAtkPer = MAtkPer1 + RuneDamage

  local MDamIncrease = CommonFun.calcMDamIncrease(srcUser, targetUser)
  local IgnoreMDef = srcUser:GetProperty("IgnoreMDef")
  ------------------------------------------------------------------------------------将原来的物伤加成改成精炼物理攻击
  local MRefine = srcUser:GetProperty("MRefine")

  local srcAtkElement    = 4
  local targetDefElement = targetUser:GetProperty("DefAttr")

 
  local MDef2 = targetUser:GetProperty("MDef")
  local MDefPer2 = targetUser:GetProperty("MDefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local VitPer2 = targetUser:GetProperty("VitPer")
  local Int2 = targetUser:GetProperty("Int")
  local IntPer2 = targetUser:GetProperty("IntPer")
  local MDamReduc2 = CommonFun.calcMDamReDuc(srcUser, targetUser)
  local RefineMDamReduc = targetUser:GetProperty("RefineMDamReduc")

  local BaseMAtk = Int+math.floor(Int*Int/100)
  local MAtkFinal= (MAtk-BaseMAtk)*(1+MAtkPer)+BaseMAtk+MRefine+MDamIncrease
 
  ----------------------------魔法防御减免
  local MDefReduc = CommonFun.CalcMDef(MDef,Int,Vit,srcUser,targetUser)

  local A = (MAtkFinal*MDefReduc*(1-MDamReduc2)*(a*lv+b)-Vit2/2*(1+VitPer2)-Int2*(1+IntPer2))*GameConfig.ElementRestrain[srcAtkElement][targetDefElement]*(1-RefineMDamReduc)
  
    ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = 1
    end
    --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = 1
    end
  if 1 >= A then
    return -1
  end

  return -A

end

function CommonFun.calcBuff_21(srcUser, targetUser, a, b, c, d,lv)

if srcUser == nil or targetUser == nil then
   return 0
end

local BaseLv = srcUser.BaseLv

local A = BaseLv*(a*lv+b)
      if A<=0 then
        A=1
      end  
return A

end


function CommonFun.calcBuff_22(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  local Int = srcUser:GetProperty("Int")
  local Vit = srcUser:GetProperty("Vit")
  local MAtk = srcUser:GetProperty("MAtk")
  local MAtkPer = srcUser:GetProperty("MAtkPer")
  local MDamIncrease = CommonFun.calcMDamIncrease(srcUser, targetUser)
  local IgnoreMDef = srcUser:GetProperty("IgnoreMDef")

  local srcAtkElement    = 3
  local targetDefElement = targetUser:GetProperty("DefAttr")

 
  local MDef2 = targetUser:GetProperty("MDef")
  local MDefPer2 = targetUser:GetProperty("MDefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local Int2 = targetUser:GetProperty("Int")
  local MDamReduc2 = CommonFun.calcMDamReDuc(srcUser, targetUser)
  
  local BaseMAtk = Int+math.floor(Int*Int/100)
  local MAtkFinal= (MAtk-BaseMAtk)*(1+MAtkPer)+BaseMAtk

  local A = MAtkFinal*(a*lv+b)*GameConfig.ElementRestrain[srcAtkElement][targetDefElement]
  
  if A >= 0 then
    return -1
  end
 
  return A

end

function CommonFun.calcBuff_23(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local BaseLv = targetUser.BaseLv
  local A= (math.random(1,BaseLv)*a+b)
  
  if A <= 1 then
    return 1
  end
 
  return A

end


-----------------获取职业等级和角色等级的计算结果
function CommonFun.calcBuff_39(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  
  local BaseLv = srcUser.BaseLv
  
  local A= BaseLv*a + b
  
  if A <= 0 then
    return 0
  end

  return A

end

-----------------获取职业等级和角色等级的计算结果
function CommonFun.calcBuff_40(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  
  local JobLv =srcUser:GetJobLv()
  
  local A= JobLv*a+b
  
  if A <= 0 then
    return 0
  end

  return A

end

------------------------------------------------------------------------隐匿状态下提升技能释放成功率
function CommonFun.calcBuff_41(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  
  local Hiding = srcUser:GetProperty("Hiding")
  
  local A= lv*a+b
  
  if A <= 0 then
    return 0
  end
  
  if Hiding==1 or bits[CommonFun.AttrEffect.HideStrengthEffect]==1 then
      return A*2
  end
  
  return A

end


function CommonFun.calcBuff_50(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  
 local Hp    =  srcUser:GetProperty("Hp")
 local MaxHp =  srcUser:GetProperty("MaxHp")
 local A     =  (1-Hp/MaxHp)*0.6
  
 if A <= 0 then
    return 0
 end
  
 if A >= 0.5 then
    return 0.5
 end    

 return A

end
--------------------------------------------------------------------------------有守卫光环下添加buff
function CommonFun.calcBuff_51(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Buff = srcUser:HasBuffID(114)
  local A = 0

  if Buff==true then
    return 100
  end
  
  return A

end
--------------------------------------------------------------------------------气泡虫存储buff下生效
function CommonFun.calcBuff_52(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Buff = srcUser:HasBuffID(80001190)
  local A = 0

  if Buff==true then
    return 100
  end
  
  return A

end
---------------------------------------------------------------------------------野猪卡片存储
function CommonFun.calcBuff_53(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0
  if targetUser:GetNpcID() == 10057 then
      return 100
  end

  return A

end
---------------------------------------------------------------------------------野猪卡片存储体质相关
function CommonFun.calcBuff_54(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Vit = srcUser:GetProperty("Vit")
  local A = Vit*-5

  return A

end
-----------------------------------------------------------------------------------------------生命点燃伤害公式
function CommonFun.calcBuff_55(srcUser, targetUser, a, b, c, d,lv)
  local MaxHp = srcUser:GetProperty("MaxHp")
  local MaxSp = srcUser:GetProperty("MaxSp")
  local skilllv_1 = srcUser:GetLernedSkillLevel(69)
  local Buff = srcUser:HasBuffID(80000410)
  local Card1 = srcUser:GetEquipCardNum(2,20041)-------------获取盔甲部位大嘴鸟卡片数量
  local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图

  if srcUser == nil or targetUser == nil then
      return 0
  end
  
  ----------------------------------------------------------竞技场最大生命除以4
  if maptype==2 or maptype==4 then
     MaxHp = MaxHp*0.25
  end

  local A = MaxHp*a+MaxSp*b+skilllv_1*c+(2*skilllv_1-10)*d
  -----------------------------------------------装备大嘴鸟卡片且存储伤害增加
  if Buff==true and Card1>0 then
    return A*1.1
  end
  
    ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = -1
    end
        --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = -1
    end

  return A

end
---------------------------------------------------------------------------------水母卡片存储冰冻概率增加
function CommonFun.calcBuff_56(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 5
  
  local Buff = srcUser:HasBuffID(80000250)
  if Buff==true then
     A = 10
  end    

  return A

end
---------------------------------------------------------------------------------牺牲祈福根据星盘获得额外的时间加成
function CommonFun.calcBuff_57(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1  = srcUser:GetRunePoint(52034)

  local A = lv*a + b + 2*Num1

  return A
end

----------------------------------------------------------------------------------------------血的贪求（生命体）计算公式
function CommonFun.calcBuff_58(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local Atk = srcUser:GetProperty("Atk")
  local AtkPer  = srcUser:GetProperty("AtkPer")
  local BaseLv = srcUser.BaseLv

  local master = srcUser:GetMasterUser()

  if master == nil then
    return 0
  end
  
  local masterRefine = master:GetProperty("Refine")
  local masterAtk = master:GetProperty("Atk")


  ---生命体攻击力计算公式
  Atk = (masterRefine*2 + Atk*(1+AtkPer)/10) * (a+b)

  local DamIncrease = srcUser:GetProperty("DamIncrease")

  local Def2 = targetUser:GetProperty("Def")
  local DefPer2 = targetUser:GetProperty("DefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local VitPer2 = targetUser:GetProperty("VitPer")
  local DamReduc2 = CommonFun.calcDamReDuc(srcUser, targetUser)
  local RefineDamReduc = targetUser:GetProperty("RefineDamReduc")

  local AtkFinal = Atk*CommonFun.ShapeCorrection(srcUser,targetUser)

  ----------------------------物理防御减免
  local DefReduc= CommonFun.CalcDef(Def,Vit,srcUser,targetUser)
  
  local A = AtkFinal*DefReduc*(1-DamReduc2)*(1-RefineDamReduc)*(1+DamIncrease)-Vit2*(1+VitPer2)

    ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = 1
    end
     --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = 1
    end

  if 1 >= A then
    return -1
  end
   
  return -A
end

----------------------------------------------------------------------------------------------------------生物炸弹（生命体）计算公式
function CommonFun.calcBuff_59(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local Int = srcUser:GetProperty("Int")
  local Vit = srcUser:GetProperty("Vit")
  local MAtk = srcUser:GetProperty("MAtk")
  local MAtkPer = srcUser:GetProperty("MAtkPer")



  local skilllv_1 = srcUser:GetLernedSkillLevel(446)
  MAtk = MAtk  *(1+MAtkPer) 
  skillDamPer = skilllv_1 * c + d

  local MDamIncrease = CommonFun.calcMDamIncrease(srcUser, targetUser)
  local IgnoreMDef = srcUser:GetProperty("IgnoreMDef")

  local srcAtkElement    = 5
  local targetDefElement = targetUser:GetProperty("DefAttr")

 
  local MDef2 = targetUser:GetProperty("MDef")
  local MDefPer2 = targetUser:GetProperty("MDefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local VitPer2 = targetUser:GetProperty("VitPer")
  local Int2 = targetUser:GetProperty("Int")
  local IntPer2 = targetUser:GetProperty("IntPer")
  local MDamReduc2 = CommonFun.calcMDamReDuc(srcUser, targetUser)
  local RefineMDamReduc = targetUser:GetProperty("RefineMDamReduc")

  local BaseMAtk = Int+math.floor(Int*Int/100)
  local MAtkFinal= MAtk+MDamIncrease

  ----------------------------魔法防御减免
  local MDefReduc = CommonFun.CalcMDef(MDef,Int,Vit,srcUser,targetUser)

  local A = (MAtkFinal*MDefReduc*(1-MDamReduc2)-Vit2/2*(1+VitPer2)-Int2*(1+IntPer2))*GameConfig.ElementRestrain[srcAtkElement][targetDefElement]*skillDamPer*(1-RefineMDamReduc)

   ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = 1
    end
      --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = 1
    end
  if 1 >= A then
    return -1
  end

  return -A

end

----------------------------------------------------------------------------------------------------------王牌驯兽师11-15属性判断
function CommonFun.calcBuff_60(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local skilllv = srcUser:GetLernedSkillLevel(251)
  local CriDamage = 0
  if skilllv > 10 then
    CriDamage = (skilllv-10)*0.01
    return CriDamage
  else
    return CriDamage
  end

end

----------------------------------------------------------------------------------------------------------心神凝结11-20属性判断
function CommonFun.calcBuff_61(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local skilllv = srcUser:GetLernedSkillLevel(115)
  local value_add= 0
  if skilllv > 10 then
    value_add =  (skilllv-10)*a
    return value_add
  else
    return value_add
  end

end
-----------------------------------------------------------------------------------------------生命点燃 自身损血伤害公式
function CommonFun.calcBuff_62(srcUser, targetUser, a, b, c, d,lv)
  local MaxHp = srcUser:GetProperty("MaxHp")
  local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图

  if srcUser == nil or targetUser == nil then
      return 0
  end
  
  ----------------------------------------------------------竞技场最大生命除以4
  if maptype==2 or maptype==4 then
     MaxHp = MaxHp*0.25
  end

  local A = MaxHp*a
    
  return A

end

------------------------------------------------------------------------状态抗性带来的时间减少公式(沉默)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【沉默概率】
function CommonFun.calcBuff_100(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local SilenceAtk  = srcUser:GetProperty("SilenceAtk")
  local SilenceDef2 = targetUser:GetProperty("SilenceDef")
  local SlienceDam  = 1 + SilenceAtk - SilenceDef2
  if SlienceDam <=0 then
     SlienceDam  =0
  end   
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end   

  local A= (lv*a+b)*SlienceDam*StateDam*CommonFun.calcAttrSilenceRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end

  return A
end

------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【沉默时间】
function CommonFun.calcBuff_1000(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local SilenceAtk  = srcUser:GetProperty("SilenceAtk")
  local SilenceDef2 = targetUser:GetProperty("SilenceDef")
  local SlienceDam  = 1 + SilenceAtk - SilenceDef2
  if SlienceDam <=0 then
     SlienceDam  =0
  end   
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end   

  local A= (lv*a+b)*SlienceDam*StateDam*CommonFun.calcAttrSilenceTime(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end

  return A
end


------------------------------------------------------------------------状态抗性带来的时间减少公式(沉默)【牧师普攻附带沉默效果】
------------------------------------------------------------------------【需要增加素质抵抗的概率计算公式】--【沉默概率】
function CommonFun.calcBuff_101(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------星盘计算牧师普攻沉默目标
  local Num1  = srcUser:GetRunePoint(52019)
  local Num2  = srcUser:GetRunePoint(52020)
  local Num3  = srcUser:GetRunePoint(52022)
  local Num4  = srcUser:GetRunePoint(52025)
  local Num5  = srcUser:GetRunePoint(52026)
  local RuneRate = (Num1 + Num2 + Num3 + Num4 + Num5)   

  local SilenceAtk  = srcUser:GetProperty("SilenceAtk")
  local SilenceDef2 = targetUser:GetProperty("SilenceDef")
  local SlienceDam  = 1 + SilenceAtk - SilenceDef2
  if SlienceDam <=0 then
     SlienceDam  =0
  end   
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk)*(1-StateDef2)
  if StateDam<=0 then
     StateDam =0
  end   

  local A= RuneRate*a*SlienceDam*StateDam*CommonFun.calcAttrSilenceRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end

  return A
end

------------------------------------------------------------------------【需要增加素质抵抗的时间计算公式】--【沉默时间】
function CommonFun.calcBuff_102(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------星盘计算牧师普攻沉默目标
  local Num1  = srcUser:GetRunePoint(52019)
  local Num2  = srcUser:GetRunePoint(52020)
  local Num3  = srcUser:GetRunePoint(52022)
  local Num4  = srcUser:GetRunePoint(52025)
  local Num5  = srcUser:GetRunePoint(52026)
  local RuneTime = (Num1 + Num2 + Num3 + Num4 + Num5)   
  
  local A= RuneTime*CommonFun.calcAttrSilenceTime(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end

  return A
end

--------------------------------------------------------------------------------------------计算沉默之术切换效果的添加概率
------------------------------------------------------------------------【需要增加素质抵抗的概率计算公式】--【沉默概率】
function CommonFun.calcBuff_103(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------星盘增加沉默之术效果切换
  local Num1  = srcUser:GetRunePoint(52100)
  local SilenceAtk  = srcUser:GetProperty("SilenceAtk")
  local SilenceDef2 = targetUser:GetProperty("SilenceDef")
  local SlienceDam  = 1 + SilenceAtk - SilenceDef2
  if SlienceDam <=0 then
     SlienceDam  =0
  end   
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk)*(1-StateDef2)
  if StateDam<=0 then
     StateDam =0
  end  

  local A = 100*SlienceDam*StateDam*CommonFun.calcAttrSilenceRate(srcUser, targetUser)   

  if Num1 > 0 then
     A = 0
  end   
  
  if A <= 0 then
    return 0
  end

  return A
end

--------------------------------------------------------------------------------------------计算沉默之术切换效果的添加概率
------------------------------------------------------------------------【需要增加素质抵抗的概率计算公式】--【沉默概率】
function CommonFun.calcBuff_104(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------星盘增加沉默之术效果切换
  local Num1  = srcUser:GetRunePoint(52100)
  local A =  Num1*100*CommonFun.calcAttrSilenceRate(srcUser, targetUser)

  if (targetUser.boss or targetUser.mini) then----------------------对MVP　mini 无效
     A = 0
  end   
  
  if A <= 0 then
    return 0
  end

  return A
end

--------------------------------------------------------------------------------------------计算沉默之术切换效果的添加效果【效果计算】
function CommonFun.calcBuff_105(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------星盘增加沉默之术效果切换
  local Num1  = srcUser:GetRunePoint(52100)
  local A =  Num1*a  

  if A <= 0 then
    return 0
  end

  return A
end

--------------------------------------------------------------------------------------------计算沉默之术损失魔法上限的添加概率和添加效果
------------------------------------------------------------------------【需要增加素质抵抗的概率计算公式】--【沉默】
function CommonFun.calcBuff_106(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------星盘增加沉默之术效果切换
  local Num1  = srcUser:GetRunePoint(52130)
  local Num2  = srcUser:GetRunePoint(52100)
  local A =  Num1*a*CommonFun.calcAttrSilenceRate(srcUser, targetUser) 
  if  Num2>=1 then
      A = 0
  end    

  if A <= 0 then
    return 0
  end

  return A
end

--------------------------------------------------------------------------------------------计算沉默之术损失魔法上限的添加概率和添加效果【效果计算】
function CommonFun.calcBuff_107(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------星盘增加沉默之术效果切换
  local Num1  = srcUser:GetRunePoint(52130)
  local MaxSp  = srcUser:GetProperty("MaxSp")
  local A =  Num1*a*MaxSp  

  return A
end

------------------------------------------------------------------------状态抗性带来的时间减少公式(冰冻)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【冰冻概率】
function CommonFun.calcBuff_110(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local FreezeAtk  = srcUser:GetProperty("FreezeAtk")
  local FreezeDef2 = targetUser:GetProperty("FreezeDef")
  local FreezeDam  = (1 + FreezeAtk - FreezeDef2)
  if FreezeDam <=0 then
     FreezeDam  =0
  end   

  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 

  local A= (lv*a+b)*FreezeDam*StateDam*CommonFun.calcAttrFreezeRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end

  return A
end

------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【冰冻时间】
function CommonFun.calcBuff_1100(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local FreezeAtk  = srcUser:GetProperty("FreezeAtk")
  local FreezeDef2 = targetUser:GetProperty("FreezeDef")
  local FreezeDam  = (1 + FreezeAtk - FreezeDef2)
  if FreezeDam <=0 then
     FreezeDam  =0
  end   

  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 

  local A= (lv*a+b)*FreezeDam*StateDam*CommonFun.calcAttrFreezeTime(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end

  return A
end

------------------------------------------------------------------------冰冻术专用效果
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【冰冻】
function CommonFun.calcBuff_111(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local FreezeAtk  = srcUser:GetProperty("FreezeAtk")
  local FreezeDef2 = targetUser:GetProperty("FreezeDef")
  local FreezeDam  = (1 + FreezeAtk - FreezeDef2)
  if FreezeDam <=0 then
     FreezeDam  =0
  end   

  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  ---------------------------------------------------------------------星盘效果
  local Num1 = srcUser:GetRunePoint(22130)
  local A= (lv*a+b)*FreezeDam*StateDam*CommonFun.calcAttrFreezeRate(srcUser, targetUser)
  
  if Num1>=1 then 
     A = 0
  end

  if A <= 0 then
    return 0
  end

  return A
end

------------------------------------------------------------------------冰冻术专用冰冻自己的添加概率
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【冰冻】
function CommonFun.calcBuff_112(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  ---------------------------------------------------------------------星盘效果
  local Num1 = srcUser:GetRunePoint(22130)
  local A= 0
  
  if Num1>=1 then 
     A = (lv*a+b)
  end
  
  if A <= 0 then
    return 0
  end

  return A
end

------------------------------------------------------------------------冰冻术专用冰冻自己的添加概率
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【冰冻】
function CommonFun.calcBuff_113(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  ---------------------------------------------------------------------星盘效果
  local Num1 = srcUser:GetRunePoint(22130)
  local A= Num1*a
  
  if A <= 0 then
    return 0
  end

  return A
end
------------------------------------------------------------------------冰冻术专用添加回复的概率
function CommonFun.calcBuff_114(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  ---------------------------------------------------------------------星盘效果
  local Num1 = srcUser:GetRunePoint(22140)
  local A= Num1*100
  
  if A <= 0 then
    return 0
  end

  return A
end

------------------------------------------------------------------------冰冻术专用恢复效果的概率
function CommonFun.calcBuff_115(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  ---------------------------------------------------------------------星盘效果
  local Num1 = srcUser:GetRunePoint(22140)
  local MaxHp = srcUser:GetProperty("MaxHp")
  local A= Num1*a*MaxHp
  
  if A <= 0 then
    return 0
  end

  return A
end
------------------------------------------------------------------------状态抗性带来的时间减少公式(石化)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【石化概率】
function CommonFun.calcBuff_120(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local StoneAtk = srcUser:GetProperty("StoneAtk")
  local StoneDef2 = targetUser:GetProperty("StoneDef")
  local StoneDam  = (1 + StoneAtk - StoneDef2)
  if StoneDam <=0 then
     StoneDam  =0
  end 
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 

  local A= (lv*a+b)*StoneDam*StateDam*CommonFun.calcAttrStoneRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【石化时间】
function CommonFun.calcBuff_1200(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local StoneAtk = srcUser:GetProperty("StoneAtk")
  local StoneDef2 = targetUser:GetProperty("StoneDef")
  local StoneDam  = (1 + StoneAtk - StoneDef2)
  if StoneDam <=0 then
     StoneDam  =0
  end 
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 

  local A= (lv*a+b)*StoneDam*StateDam*CommonFun.calcAttrStoneTime(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------状态抗性带来的时间减少公式(晕眩)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【晕眩概率】
function CommonFun.calcBuff_130(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local StunAtk = srcUser:GetProperty("StunAtk")
  local StunDef2 = targetUser:GetProperty("StunDef")
  local StunDam  = (1 + StunAtk - StunDef2)
  if StunDam <=0 then
     StunDam  =0
  end 
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 

  
 
  local A= (lv*a+b)*StunDam*StateDam*CommonFun.calcAttrDizzyRate(srcUser, targetUser)
  local Buff = srcUser:HasBuffID(80000220)
  
  if Buff==true then
     A = (lv*a+b+2)*StunDam*StateDam*CommonFun.calcAttrDizzyRate(srcUser, targetUser)
  end

  if A <= 0 then
    return 0
  end   

  return A
end

------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【晕眩时间】
function CommonFun.calcBuff_1300(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local StunAtk = srcUser:GetProperty("StunAtk")
  local StunDef2 = targetUser:GetProperty("StunDef")
  local StunDam  = (1 + StunAtk - StunDef2)
  if StunDam <=0 then
     StunDam  =0
  end 
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  
  local A= (lv*a+b)*StunDam*StateDam*CommonFun.calcAttrDizzyTime(srcUser, targetUser)
  local Buff = srcUser:HasBuffID(80000220)
  
  if Buff==true then
     A = (lv*a+b+2)*StunDam*StateDam*CommonFun.calcAttrDizzyTime(srcUser, targetUser)
  end

  if A <= 0 then
    return 0
  end   

  return A
end
------------------------------------------------------------------------神圣增幅技能---状态抗性带来的时间减少公式(晕眩)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【晕眩】
function CommonFun.calcBuff_131(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local skilllv_1 = srcUser:GetLernedSkillLevel(235)
  ---------------------------------------------------------------------星盘加成的额外眩晕效果
  local Num1 = srcUser:GetRunePoint(51019)
  local Num2 = srcUser:GetRunePoint(51020)
  local RuneRate =  (Num1 + Num2)*20
  --------------------------------------------------------------------分割线
  local StunAtk = srcUser:GetProperty("StunAtk")
  local StunDef2 = targetUser:GetProperty("StunDef")
  local StunDam  = (1 + StunAtk - StunDef2)
  if StunDam <=0 then
     StunDam  =0
  end 
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  
  local A= (skilllv_1*a + b + RuneRate)*StunDam*StateDam*CommonFun.calcAttrDizzyRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end

  if skilllv_1<=0 then
     return 0
  end   

  return A
end

------------------------------------------------------------------------震慑技能效果---状态抗性带来的时间减少公式(晕眩)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【晕眩】
function CommonFun.calcBuff_132(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local skilllv_1 = srcUser:GetLernedSkillLevel(123)
  local StunAtk = srcUser:GetProperty("StunAtk")
  local StunDef2 = targetUser:GetProperty("StunDef")
  local StunDam  = (1 + StunAtk - StunDef2)
  if StunDam <=0 then
     StunDam  =0
  end 
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  
  local A= (skilllv_1*a+b)*StunDam*StateDam*CommonFun.calcAttrDizzyRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end

  if skilllv_1<=0 then
     return 0
  end   

  return A
end

------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【晕眩】
function CommonFun.calcBuff_1320(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local skilllv_1 = srcUser:GetLernedSkillLevel(123)
  local StunAtk = srcUser:GetProperty("StunAtk")
  local StunDef2 = targetUser:GetProperty("StunDef")
  local StunDam  = (1 + StunAtk - StunDef2)
  if StunDam <=0 then
     StunDam  =0
  end 
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  
  local A= (skilllv_1*a+b)*StunDam*StateDam*CommonFun.calcAttrDizzyTime(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end

  if skilllv_1<=0 then
     return 0
  end   

  return A
end
------------------------------------------------------------------------状态抗性带来的时间减少公式(灼烧)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【灼烧概率】
function CommonFun.calcBuff_140(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local BlindAtk = srcUser:GetProperty("BlindAtk")
  local BlindDef2 = targetUser:GetProperty("BlindDef")
  local BlindDam  = (1 + BlindAtk - BlindDef2)
  if BlindDam <=0 then
     BlindDam  =0
  end  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  

  local A= (lv*a+b)*BlindDam*StateDam*CommonFun.calcAttrBurnRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【灼烧时间】
function CommonFun.calcBuff_1400(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local BlindAtk = srcUser:GetProperty("BlindAtk")
  local BlindDef2 = targetUser:GetProperty("BlindDef")
  local BlindDam  = (1 + BlindAtk - BlindDef2)
  if BlindDam <=0 then
     BlindDam  =0
  end  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  

  local A= (lv*a+b)*BlindDam*StateDam*CommonFun.calcAttrBurnTime(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------状态抗性带来的时间减少公式(灼烧)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【灼烧】
function CommonFun.calcBuff_141(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local skilllv_1 = srcUser:GetLernedSkillLevel(88)
  local BlindAtk = srcUser:GetProperty("BlindAtk")
  local BlindDef2 = targetUser:GetProperty("BlindDef")
  local BlindDam  = (1 + BlindAtk - BlindDef2)
  if BlindDam <=0 then
     BlindDam  =0
  end  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  

  local A= (skilllv_1*a+b)*BlindDam*StateDam*CommonFun.calcAttrBurnRate(srcUser, targetUser)
  
  if skilllv_1<=0 then
     return 0 
  end   

  if A <= 0 then
    return 0
  end


  return A
end

------------------------------------------------------------------------状态抗性带来的时间减少公式(中毒)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【中毒概率】
function CommonFun.calcBuff_150(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local PoisonAtk = srcUser:GetProperty("PoisonAtk")
  local PoisonDef2 = targetUser:GetProperty("PoisonDef")
  local PoisonDam  = (1 + PoisonAtk - PoisonDef2)
  if PoisonDam <=0 then
     PoisonDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  

  local A= (lv*a+b)*PoisonDam*StateDam*CommonFun.calcAttrPoisonRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【中毒时间】
function CommonFun.calcBuff_1500(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local PoisonAtk = srcUser:GetProperty("PoisonAtk")
  local PoisonDef2 = targetUser:GetProperty("PoisonDef")
  local PoisonDam  = (1 + PoisonAtk - PoisonDef2)
  if PoisonDam <=0 then
     PoisonDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  

  local A= (lv*a+b)*PoisonDam*StateDam*CommonFun.calcAttrPoisonTime(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------状态抗性带来的时间减少公式(中毒)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【中毒】
function CommonFun.calcBuff_151(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local skilllv_1 = srcUser:GetLernedSkillLevel(191)
  local PoisonAtk = srcUser:GetProperty("PoisonAtk")
  local PoisonDef2 = targetUser:GetProperty("PoisonDef")
  local PoisonDam  = (1 + PoisonAtk - PoisonDef2)
  if PoisonDam <=0 then
     PoisonDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  

  local A= (skilllv_1*a+b)*PoisonDam*StateDam*CommonFun.calcAttrPoisonTime(srcUser, targetUser)

  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------剧毒暗器添加不可被治疗不可使用药瓶的概率
function CommonFun.calcBuff_152(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  ------------------------------------------------------------------------星盘加成的效果
  local Num1 = srcUser:GetRunePoint(32005)
  local RuneRate = Num1*10
  local A= RuneRate
  
  if A <= 0 then
    return 0
  end
  return A
end


------------------------------------------------------------------------星盘带来的中毒损血百分比效果
function CommonFun.calcBuff_153(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  ------------------------------------------------------------------------星盘加成的效果
  local Num1 = srcUser:GetRunePoint(31026)
  local Num2 = srcUser:GetRunePoint(31027)
  local RuneDamage = Num1*0.05 + Num2*0.05
  local A= a - RuneDamage
  
  if A <= 0 then
    return 0
  end
  return A
end


------------------------------------------------------------------------凯美拉卡片效果
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【中毒概率】
function CommonFun.calcBuff_154(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local PoisonAtk = srcUser:GetProperty("PoisonAtk")
  local PoisonDef2 = targetUser:GetProperty("PoisonDef")
  local PoisonDam  = (1 + PoisonAtk - PoisonDef2)
  local Profession=srcUser:GetProfressionID()

  if PoisonDam <=0 then
     PoisonDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  
  if Profession==31 or Profession==32 or Profession==33 or Profession==34 then
      b = 12
  end

  local A= (lv*a+b)*PoisonDam*StateDam*CommonFun.calcAttrPoisonRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------状态抗性带来的时间减少公式(定身)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【定身概率】
function CommonFun.calcBuff_160(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local SlowAtk = srcUser:GetProperty("SlowAtk")
  local SlowDef2 = targetUser:GetProperty("SlowDef")
  local SlowDam  = (1 + SlowAtk - SlowDef2)
  if SlowDam <=0 then
     SlowDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 

  local A= (lv*a+b)*SlowDam*StateDam*CommonFun.calcAttrSlowRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【定身时间】
function CommonFun.calcBuff_1600(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local SlowAtk = srcUser:GetProperty("SlowAtk")
  local SlowDef2 = targetUser:GetProperty("SlowDef")
  local SlowDam  = (1 + SlowAtk - SlowDef2)
  if SlowDam <=0 then
     SlowDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  

  local A= (lv*a+b)*SlowDam*StateDam*CommonFun.calcAttrSlowTime(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------状态抗性带来的时间减少公式(恐惧)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【恐惧概率】
function CommonFun.calcBuff_170(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local ChaosAtk = srcUser:GetProperty("ChaosAtk")
  local ChaosDef2 = targetUser:GetProperty("ChaosDef")
  local ChaosDam  = (1 + ChaosAtk - ChaosDef2)
  if ChaosDam <=0 then
     ChaosDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 


  local A= (lv*a+b)*ChaosDam*StateDam*CommonFun.calcAttrFearRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------黑洞 - 迷失【恐惧概率】
function CommonFun.calcBuff_171(srcUser, targetUser, a, b, c, d,lv)
  local A = 0
  local Num1=srcUser:GetRunePoint(94030)

  if Num1>0 then 
      A = 100
  end

  if A <= 0 then
    return 0
  end
  print("A="..A)
  return A
end
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【恐惧时间】
function CommonFun.calcBuff_1700(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local ChaosAtk = srcUser:GetProperty("ChaosAtk")
  local ChaosDef2 = targetUser:GetProperty("ChaosDef")
  local ChaosDam  = (1 + ChaosAtk - ChaosDef2)
  if ChaosDam <=0 then
     ChaosDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 


  local A= (lv*a+b)*ChaosDam*StateDam*CommonFun.calcAttrFearTime(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------黑洞 迷失--【恐惧时间】
function CommonFun.calcBuff_1701(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(94030)

  local A= Num1
  print("A="..A)
  if A <= 0 then
    return 0
  end

  return A
end
------------------------------------------------------------------------状态抗性带来的时间减少公式(诅咒)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【诅咒】
function CommonFun.calcBuff_180(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local CurseAtk = srcUser:GetProperty("CurseAtk")
  local CurseDef2 = targetUser:GetProperty("CurseDef")
  local CurseDam  = (1 + CurseAtk - CurseDef2)
  if CurseDam <=0 then
     CurseDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 

  local A= (lv*a+b)*CurseDam*StateDam*CommonFun.calcAttrCurseRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【诅咒】
function CommonFun.calcBuff_1800(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local CurseAtk = srcUser:GetProperty("CurseAtk")
  local CurseDef2 = targetUser:GetProperty("CurseDef")
  local CurseDam  = (1 + CurseAtk - CurseDef2)
  if CurseDam <=0 then
     CurseDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 


  local A= (lv*a+b)*CurseDam*StateDam*CommonFun.calcAttrCurseTime(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------状态抗性带来的时间减少公式(流血)
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--流血
function CommonFun.calcBuff_185(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 

  local A= (lv*a+b)*StateDam*CommonFun.calcAttrBlindRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--流血时间
function CommonFun.calcBuff_1850(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 


  local A= (lv*a+b)*StateDam*CommonFun.calcAttrBlindTime(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------诅咒之弓效果更改
function CommonFun.calcBuff_190(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  
  local Weapon=srcUser:GetEquipedID(7)
  local A = 0

  if (Weapon==41233 or Weapon==141233 or Weapon==41256 or Weapon==141256) then
        A = 10
  end 
  
  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------生命转换物理攻击
function CommonFun.calcBuff_200(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local MaxHp = srcUser:GetProperty("MaxHp")
  local MDef = srcUser:GetProperty("MDef")
  local Flee = srcUser:GetProperty("Flee")
  local Weapon2=srcUser:GetEquipedID(2)
  local A = 0
  local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图
  ----------------------------------------------------------竞技场最大生命除以4
  if maptype==2 or maptype==4 then
     MaxHp = MaxHp*0.25
  end
  -------------------------------------------------------------圣者法袍的生命值转换物理攻击比例
  if (Weapon2==42058 or Weapon2==142058) then
        A = MaxHp/200
  end 
  
  if A <= 0 then
    return 0
  end
  return A
end

  -----------------------------------------------------------大天使圣像的魔法防御转换魔法攻击比例
function CommonFun.calcBuff_201(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local MaxHp = srcUser:GetProperty("MaxHp")
  local MDef = srcUser:GetProperty("MDef")
  local Flee = srcUser:GetProperty("Flee")
  local Weapon1=srcUser:GetEquipedID(1)
  local A = 0

  -----------------------------------------------------------大天使圣像的魔法防御转换魔法攻击比例
  if (Weapon1==60512 or Weapon1==160512) then
        A = MDef/10
  end
  
  if A <= 0 then
    return 0
  end
  return A
end

    -------------------------------------------------------------芬特克的手环的闪避转换物理攻击比例
function CommonFun.calcBuff_202(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local MaxHp = srcUser:GetProperty("MaxHp")
  local MDef = srcUser:GetProperty("MDef")
  local Flee = srcUser:GetProperty("Flee")
  local Weapon1=srcUser:GetEquipedID(1)
  local A = 0

    -------------------------------------------------------------芬特克的手环的闪避转换物理攻击比例
  if (Weapon1==61512 or Weapon1==161512) then
        A = Flee/10
  end 
  
  if A <= 0 then
    return 0
  end
  return A
end

    -------------------------------------------------------------华贵腕甲的装备攻速转攻击力
function CommonFun.calcBuff_203(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local MaxHp = srcUser:GetProperty("MaxHp")
  local MDef = srcUser:GetProperty("MDef")
  local EquipASPD = srcUser:GetProperty("EquipASPD")
  local Weapon1=srcUser:GetEquipedID(1)

  local A = 0

    -------------------------------------------------------------芬特克的手环的闪避转换物理攻击比例
  if (Weapon1==61011 or Weapon1==161011) then
        A = EquipASPD*100
  end 
  
  if A <= 0 then
    return 0
  end
  return A
end
-----------------------------------------------------------------------------------星盘灵巧转攻击力
function CommonFun.calcBuff_204(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Dex = srcUser:GetProperty("Dex")
  local Num1=srcUser:GetRunePoint(62013)
  local Num2=srcUser:GetRunePoint(62014)
  local Num3=srcUser:GetRunePoint(62015)
  local Num4=srcUser:GetRunePoint(62016)
  local Num5=srcUser:GetRunePoint(62017)
  local RuneDamage=Num1*0.2+Num2*0.2+Num3*0.2+Num4*0.2+Num5*0.2

  local A = Dex*RuneDamage

  if A <= 0 then
    return 0
  end
  return A
end
-----------------------------------------------------------------------------------星盘幸运转攻击力
function CommonFun.calcBuff_205(srcUser, targetUser, a, b, c, d,lv)
    if srcUser == nil or targetUser == nil then
      return 0
  end
  local Luk = srcUser:GetProperty("Luk")
  local Num1=srcUser:GetRunePoint(62026)
  local Num2=srcUser:GetRunePoint(62027)
  local Num3=srcUser:GetRunePoint(62028)
  local Num4=srcUser:GetRunePoint(62029)
  local Num5=srcUser:GetRunePoint(62030)
  local RuneDamage=Num1*0.2+Num2*0.4+Num3*0.2+Num4*0.2+Num5*0.2

  local A = Luk*RuneDamage

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------持久愈合-高效生效条件
function CommonFun.calcBuff_300(srcUser, targetUser, a, b, c, d,lv)
    if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(51002)
  local Num2=srcUser:GetRunePoint(51007)
  local Num3=srcUser:GetRunePoint(51008)
  local RuneDamage=(Num1 + Num2 + Num3)
  local A = 0
  if RuneDamage > 0 then
     A = 100 
  end  
  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------持久愈合-高效持续效果
function CommonFun.calcBuff_301(srcUser, targetUser, a, b, c, d,lv)
    if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(51003)
  local Num2=srcUser:GetRunePoint(51006)
  local Num3=srcUser:GetRunePoint(51009)
  local Num4=srcUser:GetRunePoint(52002)
  local RuneDamage=(Num1 + Num2 + Num3 + Num4)

  local A = RuneDamage * a 

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------持久愈合-高效持续时间
function CommonFun.calcBuff_302(srcUser, targetUser, a, b, c, d,lv)
    if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(51002)
  local Num2=srcUser:GetRunePoint(51007)
  local Num3=srcUser:GetRunePoint(51008)
  local RuneDamage=(Num1 + Num2 + Num3)

  local A = RuneDamage*a

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------霸邪之阵-生效条件
function CommonFun.calcBuff_310(srcUser, targetUser, a, b, c, d,lv)
    if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(51004)
  local Num2=srcUser:GetRunePoint(51005)
  local Num3=srcUser:GetRunePoint(52010)
  local RuneDamage=(Num1 + Num2 + Num3)
  local A = 0
  if RuneDamage > 0 then
     A = 100 
  end  
  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------霸邪之阵-持续时间
function CommonFun.calcBuff_311(srcUser, targetUser, a, b, c, d,lv)
    if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(51004)
  local Num2=srcUser:GetRunePoint(51005)
  local Num3=srcUser:GetRunePoint(52010)
  local RuneDamage=(Num1 + Num2 + Num3)

  local A = RuneDamage*a

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------剑术修炼-强效
function CommonFun.calcBuff_320(srcUser, targetUser, a, b, c, d,lv)
    if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(11002)
  local Num2=srcUser:GetRunePoint(11007)
  local Num3=srcUser:GetRunePoint(11013)  
  local RuneDamage=(Num1 + Num2 + Num3)*c + 1

  local A = (lv*a + b)*RuneDamage

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------风行护甲
function CommonFun.calcBuff_321(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Agi = srcUser:GetProperty("Agi")
  local Num1=srcUser:GetRunePoint(11011)
  local Num2=srcUser:GetRunePoint(12012)
  local A=(Num1 + Num2)*(math.floor(Agi/5)) 

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------挑衅-警惕
function CommonFun.calcBuff_322(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(11003)
  local Num2=srcUser:GetRunePoint(11009)
  local Num3=srcUser:GetRunePoint(11016)
  local Num4=srcUser:GetRunePoint(11017)
  local Num5=srcUser:GetRunePoint(12022)
  local A=lv*a + b + (Num1 + Num2 + Num3 + Num4 + Num5)*c
  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------骑乘训练
function CommonFun.calcBuff_323(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local skilllv_1 = srcUser:GetLernedSkillLevel(45)   ----骑士系
  local skilllv_2 = srcUser:GetLernedSkillLevel(370)  ----十字军系
  local Num1=srcUser:GetRunePoint(12014)
  local Num2=srcUser:GetRunePoint(12015)
  local Num3=srcUser:GetRunePoint(12016)
  local Num4=srcUser:GetRunePoint(12036)
  local Num5=srcUser:GetRunePoint(12037)
  local Num6=srcUser:GetRunePoint(12038)
  local A=(Num1 + Num2 + Num3 + Num4 + Num5 + Num6)*a*skilllv_1+(Num1 + Num2 + Num3 + Num4 + Num5 + Num6)*a*skilllv_2
  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------强化涂毒
function CommonFun.calcBuff_330(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local skillLevel = srcUser:GetLernedSkillLevel(191)
  local Num1=srcUser:GetRunePoint(31024)
  local Num2=srcUser:GetRunePoint(31025)
  local Num3=srcUser:GetRunePoint(32024)
  local Num4=srcUser:GetRunePoint(32025)
  local RuneDamage = (Num1*0.25 + Num2*0.5 + Num3*0.5 + Num4*0.25 + 1)

  local A = skillLevel*a*RuneDamage

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------后退回避闪避
function CommonFun.calcBuff_340(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(32004)
  local RuneDamage = Num1*15
  local A=lv*a + RuneDamage

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------后退回避移动速度
function CommonFun.calcBuff_350(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(32003)

  local A = Num1*0.25

  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------状态抗性带来的时间减少公式(火箭雨灼烧)
-----------------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【灼烧】
function CommonFun.calcBuff_360(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local BlindAtk = srcUser:GetProperty("BlindAtk")
  local BlindDef2 = targetUser:GetProperty("BlindDef")
  local BlindDam  = (1 + BlindAtk - BlindDef2)
  if BlindDam <=0 then
     BlindDam  =0
  end  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk)*(1-StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 

  local A = 0
  local Num1=srcUser:GetRunePoint(41006)

  local SkillAttr = srcUser:GetCurSkillAtkAttr()

  if SkillAttr ==4 then
      A= (lv*a+b)*BlindDam*StateDam*Num1
  end
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------状态抗性带来的时间减少公式(分裂箭灼烧)
-----------------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【灼烧】
function CommonFun.calcBuff_370(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local BlindAtk = srcUser:GetProperty("BlindAtk")
  local BlindDef2 = targetUser:GetProperty("BlindDef")
  local BlindDam  = (1 + BlindAtk - BlindDef2)
  if BlindDam <=0 then
     BlindDam  =0
  end  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk)*(1-StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 

  local Num1=srcUser:GetRunePoint(42022)
 
  local A= (lv*a+b)*BlindDam*StateDam*Num1

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------爆散陷阱火属性加成
function CommonFun.calcBuff_380(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(42025)
  local Num2=srcUser:GetRunePoint(42026)
  local Num3=srcUser:GetRunePoint(42027)
  local Num4=srcUser:GetRunePoint(42028)
  local Num5=srcUser:GetRunePoint(42029)

  local A = -(Num1*0.1+Num2*0.05+Num3*0.05+Num4*0.05+Num5*0.1)

  return A

end
-----------------------------------------------------------------------------------冰霜陷阱水属性加成
function CommonFun.calcBuff_390(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(42036)
  local Num2=srcUser:GetRunePoint(42037)
  local Num3=srcUser:GetRunePoint(42038)
  local Num4=srcUser:GetRunePoint(42039)
  local Num5=srcUser:GetRunePoint(42040)

  local A = -(Num1*0.05+Num2*0.1+Num3*0.05+Num4*0.1+Num5*0.1)

  return A
end
-----------------------------------------------------------------------------------火狩释放火之猎杀技能的概率
function CommonFun.calcBuff_400(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(21006)

  local A = Num1*100

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------火狩添加层数的概率
function CommonFun.calcBuff_401(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(22007)

  local A = Num1*3

  ------------------------------------------层数小于等于0表示无限制
  if A <= 1 then
    return 1
  end
  return A
end

-----------------------------------------------------------------------------------释放圣灵召唤的概率
function CommonFun.calcBuff_410(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(22020)
  local Num2=srcUser:GetRunePoint(22019)
  local Num3=srcUser:GetRunePoint(22021)

  local A = Num1*5 + Num2*2 + Num3*2

  if A <= 0 then
    return 0
  end
  return A
end

-- --------------------------------------------------------------------------------------------------------冰冻术，霜冻之术破冰伤害
function CommonFun.calcBuff_420(srcUser, targetUser, a, b, c, d,lv)
  local Int = srcUser:GetProperty("Int")
  local Vit = srcUser:GetProperty("Vit")
  local MAtk = srcUser:GetProperty("MAtk")
  local MAtkPer1 = srcUser:GetProperty("MAtkPer")
  local MDamIncrease = CommonFun.calcMDamIncrease(srcUser, targetUser)
  local IgnoreMDef = srcUser:GetProperty("IgnoreMDef")
  if IgnoreMDef >= 1 then
     IgnoreMDef  = 1
  end


  ------------------------------------------------------------------------------------将原来的物伤加成改成精炼物理攻击
  local MRefine  = srcUser:GetProperty("MRefine")
  local RangeDam = srcUser:GetProperty("RangeDam")


  -------------------------------------------------------------------------------------星盘加成冰冻术霜冻之术伤害百分比效果
  local Num1=srcUser:GetRunePoint(22024)
  local Num2=srcUser:GetRunePoint(22025)
  local RuneDamage = (Num1*0.4*lv)*(Num2*0.15 + 1)
  ----------------------------------------------------------------------------------------------------------------获取冰冻术技能等级 

 
  local MDef2 = targetUser:GetProperty("MDef")
  local MDefPer2 = targetUser:GetProperty("MDefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local VitPer2 = targetUser:GetProperty("VitPer")
  local Int2 = targetUser:GetProperty("Int")
  local IntPer2 = targetUser:GetProperty("IntPer")
  local MDamReduc2 = CommonFun.calcMDamReDuc(srcUser, targetUser)
  local RefineMDamReduc = targetUser:GetProperty("RefineMDamReduc")

  local BaseMAtk = Int+math.floor(Int*Int/100)
  local MAtkFinal= ((MAtk-BaseMAtk)*(1+MAtkPer1)+BaseMAtk)

  ----------------------------魔法防御减免
  local MDefReduc = CommonFun.CalcMDef(MDef,Int,Vit,srcUser,targetUser)

  local B = ((MAtkFinal*MDefReduc*(1-MDamReduc2)+MRefine)*(1-RefineMDamReduc)*(1+MDamIncrease)-Vit2/2*(1+VitPer2)-Int2*(1+IntPer2))
   ------------------------------------------攻击年兽伤害为1

  local A = - B*RuneDamage
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = -1
    end
            --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = -1
    end
  return A
end


-- --------------------------------------------------------------------------------------------------------忏悔的持续魔法伤害
function CommonFun.calcBuff_421(srcUser, targetUser, a, b, c, d,lv)
  local Int = srcUser:GetProperty("Int")
  local Vit = srcUser:GetProperty("Vit")
  local MAtk = srcUser:GetProperty("MAtk")
  local MAtkPer1 = srcUser:GetProperty("MAtkPer")
  local MDamIncrease = CommonFun.calcMDamIncrease(srcUser, targetUser)
  local IgnoreMDef = srcUser:GetProperty("IgnoreMDef")
  if IgnoreMDef >= 1 then
     IgnoreMDef  = 1
  end
  
  local Num1=srcUser:GetRunePoint(52024)
  ------------------------------------------------------------------------------------将原来的物伤加成改成精炼物理攻击
  local MRefine  = srcUser:GetProperty("MRefine")
  local RangeDam = srcUser:GetProperty("RangeDam")
  --------------------------------------------------------------------------------------分割
  local MDef2 = targetUser:GetProperty("MDef")
  local MDefPer2 = targetUser:GetProperty("MDefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local VitPer2 = targetUser:GetProperty("VitPer")
  local Int2 = targetUser:GetProperty("Int")
  local IntPer2 = targetUser:GetProperty("IntPer")
  local MDamReduc2 = CommonFun.calcMDamReDuc(srcUser, targetUser)
  local RefineMDamReduc = targetUser:GetProperty("RefineMDamReduc")

  local BaseMAtk = Int+math.floor(Int*Int/100)
  local MAtkFinal= (MAtk-BaseMAtk)*(1+MAtkPer1)+BaseMAtk

  ----------------------------魔法防御减免
  local MDefReduc = CommonFun.CalcMDef(MDef,Int,Vit,srcUser,targetUser)

  local B = ((MAtkFinal*MDefReduc*(1-MDamReduc2)+MRefine)*(1-RefineMDamReduc)*(1+MDamIncrease)-Vit2/2*(1+VitPer2)-Int2*(1+IntPer2))
  local A = - B*a*Num1
          ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = -1
    end
        --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = -1
    end
  return A
end


-----------------------------------------------------------------------------------忏悔的概率计算公式
function CommonFun.calcBuff_422(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(52024)
  local A = Num1*a

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------光猎延长时间计算公式
function CommonFun.calcBuff_430(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1=srcUser:GetRunePoint(52035)
  local Num2=srcUser:GetRunePoint(120200)
  local A = Num1*10 + Num2*10 + a*lv + b

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------持久愈合的添加概率计算
function CommonFun.calcBuff_440(srcUser, targetUser, a, b, c, d,lv,damage)----damage>0 表示扣血，<0 表示加血
  if srcUser == nil or targetUser == nil then
      return 0
  end
  --------------------------------------------------------------治愈术效果
  local Num1 = srcUser:GetRunePoint(51002)
  local Num2 = srcUser:GetRunePoint(51007)
  local Num3 = srcUser:GetRunePoint(51008)
  local RuneRate = (Num1 + Num2 + Num3)
  local A = RuneRate*100
 
  if A <= 0 then
    return 0
  end
  return A
end


-----------------------------------------------------------------------------------持久愈合的添加效果计算
function CommonFun.calcBuff_441(srcUser, targetUser, a, b, c, d,lv,damage)----damage>0 表示扣血，<0 表示加血
  if srcUser == nil or targetUser == nil then
      return 0
  end

  --------------------------------------------------------------持久愈合治愈量加成
  local Num4=srcUser:GetRunePoint(51003)
  local Num5=srcUser:GetRunePoint(51002)
  local Num6=srcUser:GetRunePoint(51009)
  local Num7=srcUser:GetRunePoint(52002)
  local RuneValue = 0
  
  if Num5>=1 then
     RuneValue=0.1
  end 
    
  local RuneDamage = ((Num4 + Num5 + Num6 + Num7)*0.05+RuneValue)*(-1)

  local A = RuneDamage*damage

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------持久愈合的添加时间计算
function CommonFun.calcBuff_442(srcUser, targetUser, a, b, c, d,lv,damage)----damage>0 表示扣血，<0 表示加血
  if srcUser == nil or targetUser == nil then
      return 0
  end
  --------------------------------------------------------------治愈术效果
  local Num1=srcUser:GetRunePoint(51002)
  local Num2=srcUser:GetRunePoint(51007)
  local Num3=srcUser:GetRunePoint(51008)

  local RuneDamage = (Num1 + Num2 + Num3)*7

  local A = RuneDamage

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------双重愈合添加时间计算
function CommonFun.calcBuff_450(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  --------------------------------------------------------------治愈术效果
  local Num1=srcUser:GetRunePoint(52003)
  local RuneDamage = Num1*3

  local A = RuneDamage + a

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------乘胜追击时间计算
function CommonFun.calcBuff_460(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  --------------------------------------------------------------治愈术效果
  local Num1=srcUser:GetRunePoint(12005)
  local Num2=srcUser:GetRunePoint(12007)
  local Num3=srcUser:GetRunePoint(12008)

  local RuneDamage = (Num1 + Num2 + Num3)

  local A = RuneDamage*a

  if A <= 0 then
    return 0
  end
  return A
end
-----------------------------------------------------------------------------------信仰祈福效果计算
function CommonFun.calcBuff_470(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(52008)
  local Num2=srcUser:GetRunePoint(52009)
  local RuneDamage = (Num1 + Num2)*0.05

  local A = RuneDamage

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------信仰祈福概率计算
function CommonFun.calcBuff_471(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(52008)
  local A = Num1*100
  
  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------手推车撞击降低攻击力概率
function CommonFun.calcBuff_480(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(62020)
  local Num2=srcUser:GetRunePoint(62021)
  local Num3=srcUser:GetRunePoint(62022)
  local Num4=srcUser:GetRunePoint(62023)
  local RuneRate =Num1*10+Num2*5+Num3*5+Num4*5

  local A = RuneRate

  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------手推车撞击降低攻击力
function CommonFun.calcBuff_490(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(62020)
  local Num2=srcUser:GetRunePoint(62021)
  local Num3=srcUser:GetRunePoint(62022)
  local Num4=srcUser:GetRunePoint(62023)
  local RuneAtk =-(Num1*0.1+Num2*0.05+Num3*0.05+Num4*0.05)

  local A = RuneAtk
  
  return A
end

--------------------------------------------------------------------------------------神威祈福增加物理攻击效果
function CommonFun.calcBuff_500(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(51015)
  local Num2  = srcUser:GetRunePoint(51016)
  local Num3  = srcUser:GetRunePoint(52028)
  local Num4  = srcUser:GetRunePoint(52029)
  local RuneDamage = (Num1 + Num2 + Num3 + Num4)*0.05+1
  
  local A= RuneDamage*(a*lv + b)
  
  if A <= 0 then
    return 0
  end

  return A
end

-----------------------------------------------------------------------------------毒药投掷生命上限降低
function CommonFun.calcBuff_510(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(32050)

  local A =-0.01*Num1+a

  return A
end
-----------------------------------------------------------------------------------毒药投掷毒属性技能额外伤害
function CommonFun.calcBuff_511(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(32050)

  local A =-0.1*Num1+a

  return A
end

--------------------------------------------------------------------------------------致命涂毒效果
function CommonFun.calcBuff_520(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(32100)

  local RuneDamage = Num1*0.02
  
  if lv> 10 then
    lv = 10
  end

  local A= a*lv+RuneDamage
  
  if A <= 0 then
    return 0
  end

  return A
end

--------------------------------------------------------------------------------------缓速术的添加概率
function CommonFun.calcBuff_530(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(52110)

  local A = Num1*100
  
  if A <= 0 then
    return 0
  end

  return A
end

--------------------------------------------------------------------------------------牺牲祈福的添加概率
function CommonFun.calcBuff_540(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(52080)

  local A = Num1*100
  
  if A <= 0 then
    return 0
  end

  return A
end

--------------------------------------------------------------------------------------牺牲祈福的添加概率
function CommonFun.calcBuff_550(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(52080)

  local A = 100

  if  Num1>0 then
      A = 0
  end    
  
  if A <= 0 then
    return 0
  end

  return A
end

--------------------------------------------------------------------------------------牺牲祈福的添加概率
function CommonFun.calcBuff_551(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(52080)

  local A = Num1*100
  
  if A <= 0 then
    return 0
  end

  return A
end

--------------------------------------------------------------------------------------牺牲祈福的添加概率
function CommonFun.calcBuff_552(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(52080)

  local A = Num1*a

  return A
end

--------------------------------------------------------------------------------------牧师普攻释放神威祈福
function CommonFun.calcBuff_560(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(52160)

  local A = Num1*a
  
  if A <= 0 then
    return 0
  end

  return A
end


--------------------------------------------------------------------------------------忏悔效果时间计算
function CommonFun.calcBuff_570(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(52023)
  local Num2  = srcUser:GetRunePoint(52170)
  local Num3  = srcUser:GetRunePoint(52171)
  local A = (Num1*6 + Num2*2 + Num3*2)

  if A <= 0 then
    return 0
  end

  return A
end


--------------------------------------------------------------------------------------驱散身上的增益效果
function CommonFun.calcBuff_580(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(52090)

  local A = Num1*a

  if A <= 0 then
    return 0
  end

  return A
end

-----------------------------------------------------------------------------------灵魂抽取额外加成伤害
function CommonFun.calcBuff_590(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(42100)

  local A =-0.05*Num1

  return A
end

------------------------------------------------------------------------闪电冲击驱散buff
function CommonFun.calcBuff_600(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1 = srcUser:GetRunePoint(42090)
  local RuneRate = Num1*5

  local A= RuneRate
  
  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------光猎会对隐匿目标造成额外伤害
function CommonFun.calcBuff_610(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Hiding = targetUser:GetProperty("Hiding")
  local A = 0
  if Hiding==1 then
     A = 100
  end   
  
  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------斧头精炼度提升效果
function CommonFun.calcBuff_620(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1 = srcUser:GetRunePoint(62040)
  local RuneDamage = Num1*0.1+1

  local A= RuneDamage*a
  
  if A <= 0 then
    return 0
  end
  return A
end

-----------------------------------------------------------------------------------旋风斧减移动速度
function CommonFun.calcBuff_630(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(62060)
  local Num2=srcUser:GetRunePoint(62061)
  local Num3=srcUser:GetRunePoint(62062)
  local Num4=srcUser:GetRunePoint(62063)
  local Num5=srcUser:GetRunePoint(62064)

  local A =-0.1*(Num1+Num2+Num3+Num4+Num5)

  return A
end

-----------------------------------------------------------------------------------旋风斧持续时间
function CommonFun.calcBuff_631(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(62060)
  local Num2=srcUser:GetRunePoint(62061)
  local Num3=srcUser:GetRunePoint(62062)
  local Num4=srcUser:GetRunePoint(62063)
  local Num5=srcUser:GetRunePoint(62064)

  local A = Num1+Num2+Num3+Num4+Num5

  return A
end

-----------------------------------------------------------------------------------分裂斧触发概率
function CommonFun.calcBuff_640(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1 = srcUser:GetRunePoint(62090)
  local Num2 = srcUser:GetRunePoint(62091)
  local Num3 = srcUser:GetRunePoint(62092)

  local A = (Num1+Num2+Num3)*5

  return A
end

-----------------------------------------------------------------------------------法师普攻也能触发点燃
function CommonFun.calcBuff_650(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local skilllv_1 = srcUser:GetLernedSkillLevel(88)
  local Num1=srcUser:GetRunePoint(22170)
  local AtkAttr = srcUser:GetProperty("AtkAttr")
  local A = 0
  
  if AtkAttr==4 and Num1>=1 then
     A = 5*skilllv_1
  end   

  return A
end

--------------------------------------------------------------------------------------------------------------------------法师星盘风属性魔法伤害计算公式
function CommonFun.calcBuff_660(srcUser, targetUser, a, b, c, d,lv,damage)
  local Luk = srcUser:GetProperty("Luk")
  local Int = srcUser:GetProperty("Int")
  local Vit = srcUser:GetProperty("Vit")
  local MAtk = srcUser:GetProperty("MAtk")
  local MAtkPer = srcUser:GetProperty("MAtkPer")
  -----------------------------------------------------------------------------------分割线
  local MDamIncrease = CommonFun.calcMDamIncrease(srcUser, targetUser)
  local IgnoreMDef = srcUser:GetProperty("IgnoreMDef")
  if IgnoreMDef >= 1 then
     IgnoreMDef  = 1
  end
 
  ------------------------------------------------------------------------------------将原来的物伤加成改成精炼物理攻击
  local MRefine = srcUser:GetProperty("MRefine")

  local srcAtkElement    = 1
  local targetDefElement = targetUser:GetProperty("DefAttr")
 
  local MDef2 = targetUser:GetProperty("MDef")
  local MDefPer2 = targetUser:GetProperty("MDefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local VitPer2 = targetUser:GetProperty("VitPer")
  local Int2 = targetUser:GetProperty("Int")
  local IntPer2 = targetUser:GetProperty("IntPer")
  local MDamReduc2 = CommonFun.calcMDamReDuc(srcUser, targetUser)
  local RefineMDamReduc = targetUser:GetProperty("RefineMDamReduc")

  local BaseMAtk = Int+math.floor(Int*Int/100)
  local MAtkFinal= ((MAtk-BaseMAtk)*(1+MAtkPer)+BaseMAtk)*GameConfig.ElementRestrain[srcAtkElement][targetDefElement]

  ----------------------------魔法防御减免
  local MDefReduc = CommonFun.CalcMDef(MDef,Int,Vit,srcUser,targetUser)

  local A = ((MAtkFinal*MDefReduc*(1-MDamReduc2)+MRefine)*(a*lv)*math.floor(Int/10)*(1-RefineMDamReduc)*(1+MDamIncrease)-Vit2/2*(1+VitPer2)-Int2*(1+IntPer2))
 
    ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = -1
    end
    --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = -1
    end
  return A

end

-----------------------------------------------------------------------------------破冰之后继续冰冻的添加概率
-----------------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【冰冻】
function CommonFun.calcBuff_670(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(22110)
  local A = Num1*100

  return A
end


-----------------------------------------------------------------------------------破冰之后继续冰冻的生效范围
function CommonFun.calcBuff_671(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(22110)
  local A = Num1+a

  return A
end
-----------------------------------------------------------------------------------陨石术概率释放火柱的添加概率
function CommonFun.calcBuff_680(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Num1=srcUser:GetRunePoint(22041)
  local Num2=srcUser:GetRunePoint(22043)
  local A = 0
  if (Num1 + Num2)>=1 then
     A = a
  end   

  return A
end

-----------------------------------------------------------------------------------集中攻击减少防御力
function CommonFun.calcBuff_690(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12080)

  local RuneDamage = Num1*0.07
  
  local A= a*lv+RuneDamage

  if A>=0 then
    return 0
  end

  return A
end

-----------------------------------------------------------------------------------狂怒之枪减少闪避
function CommonFun.calcBuff_700(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12130)

  local RuneDamage = Num1*0.12
  
  local A= a+RuneDamage

  if A>=0 then
    return 0
  end

  return A
end

-----------------------------------------------------------------------------------投掷长矛减速概率
function CommonFun.calcBuff_710(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12120)

  local A = Num1*15

  return A
end

-----------------------------------------------------------------------------------投掷长矛减速效果
function CommonFun.calcBuff_720(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12120)

  local A = -0.2*Num1

  return A
end


-----------------------------------------------------------------------------------反击造成的去除原本的反击效果
function CommonFun.calcBuff_730(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12050)

  local A = 100 - Num1*100

  if A<=0 then
    return 0
  end

  return A
end
-----------------------------------------------------------------------------------反击造成的近战物理反伤效果
function CommonFun.calcBuff_731(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12050)

  local A = Num1*100

  if A<=0 then
    return 0
  end

  return A
end

-----------------------------------------------------------------------------------反击造成的远程物理反伤和远程魔法反伤效果
function CommonFun.calcBuff_732(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12050)
  local Num2  = srcUser:GetRunePoint(12040)

  local A = 0
 
  if Num1 >=1 then
    A = 100*Num2
  end  

  if A<=0 then
    return 0
  end

  return A
end

-----------------------------------------------------------------------------------反击造成的远程物理反伤和远程魔法反伤效果
function CommonFun.calcBuff_733(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12050)
  local Num2  = srcUser:GetRunePoint(12041)

  local A = 0
 
  if Num1 >=1 then
    A = 100*Num2
  end  

  if A<=0 then
    return 0
  end

  return A
end

-----------------------------------------------------------------------------------反击造成的近战物理反伤效果
function CommonFun.calcBuff_734(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12050)
  local Def = srcUser:GetProperty("Def")
  local Vit = srcUser:GetProperty("Vit")
  local DefPer = srcUser:GetProperty("DefPer")
  local DefFinal = (Def-Vit)*(1+DefPer)+Vit


  local A = (Num1*a)*b*DefFinal

  return A
end
-----------------------------------------------------------------------------------霸体的原石效果删除概率
function CommonFun.calcBuff_740(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12180)

  local A = 100-Num1*100

  if A<=0 then
    return 0
  end

  return A
end
-----------------------------------------------------------------------------------霸体的原石效果删除概率
function CommonFun.calcBuff_741(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12180)

  local A = Num1*(a*lv+b)

  if A<=0 then
    return 0
  end

  return A
end

-----------------------------------------------------------------------------------霸体的原始效果删除概率
function CommonFun.calcBuff_750(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12060)

  local A = Num1*a

  return A
end

-----------------------------------------------------------------------------------狂暴之怒的添加效果
function CommonFun.calcBuff_760(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Num1  = srcUser:GetRunePoint(12131)

  local A = Num1*a + b

  if A<=0 then
    return 0
  end

  return A
end
----------------------------------------------------------------------------------蓄气的上限
function CommonFun.calcBuff_770(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local profressionID = targetUser:GetProfressionID()
  local skilllv_1 = targetUser:GetLernedSkillLevel(301)----蓄气
  local skilllv_2 = targetUser:GetLernedSkillLevel(1207)----潜龙升天
  local Dragon = 0

  local A = 5
  -----------------------------------------------潜龙升天 加气弹
  if srcUser:HasBuffID(117110) then
      Dragon = skilllv_2
  end
  if (profressionID==122 or profressionID==123 or profressionID==124) then
      A = skilllv_1 + Dragon
  end

  if A <= 0 then
     A = 1
  end
  --print("skilllv_1="..skilllv_1,"skilllv_2="..skilllv_2,"A="..A)
  return A
end

----------------------------------------------------------------------------------蓄气(气弹精修)
function CommonFun.calcBuff_780(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local skilllv_1 = srcUser:GetLernedSkillLevel(322)---------------气弹精修
  local skilllv_2 =0
  if srcUser:HasBuffID(100510) then
     skilllv_2 = srcUser:GetLernedSkillLevel(303)---------------爆气加攻击
  end
  
  local atk1 = 0
  if skilllv_1>=1 and skilllv_1 <=5 then
        atk1=1
  elseif skilllv_1>5 then
        atk1=2
  end

  local A = (a + atk1)*(1 + skilllv_2*0.2)

  return A
end

----------------------------------------------------------------------------------蓄气(气弹精修)
function CommonFun.calcBuff_790(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local skilllv_1 = srcUser:GetLernedSkillLevel(322)---------------气弹精修
  local IgnoreDef = 0
  if skilllv_1>=1 and skilllv_1 <=5 then
        IgnoreDef=0.005
  elseif skilllv_1>5 then
        IgnoreDef=0.01
  end

  local A = a + IgnoreDef

  return A
end

----------------------------------------------------------------------------------纳迦鳞盾效果
function CommonFun.calcBuff_800(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local Int = srcUser:GetProperty("Int")
  local A = math.floor(Int/3)
  if A<=0 then 
     A = 0
  end   

  return A
end

----------------------------------------------------------------------------------运气调息
function CommonFun.calcBuff_1900(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local MaxHp = srcUser:GetProperty("MaxHp")
  local Num1  = srcUser:GetRunePoint(120070)
  local RuneDamage = Num1 * 0.1 + 1

  local A = math.floor((MaxHp/a+b)*RuneDamage)*lv

  return A
end

----------------------------------------------------------------------------------运气调息
function CommonFun.calcBuff_1901(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local MaxSp = srcUser:GetProperty("MaxSp")
  local Num1  = srcUser:GetRunePoint(120070)
  local RuneDamage = Num1 * 0.1 + 1

  local A = math.floor((MaxSp/a+b)*RuneDamage)*lv

  return A
end

----------------------------------------------------------------------------------神之威压扣蓝
function CommonFun.calcBuff_1910(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  -------------------------------------------------------------------
  local MaxSp = srcUser:GetProperty("MaxSp")
  
  local A = -math.floor(MaxSp*(0.01+(lv-1)*0.005)+lv*5+15)

  return A
end
----------------------------------------------------------------------------------牺牲 光之盾 传递概率
function CommonFun.calcBuff_1920(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 0
  -------------------------------------------------------------------
  if srcUser:HasBuffID(115080) then
      A = 100
  end
      
  return A
end
----------------------------------------------------------------------------------牺牲 光之盾 传递时间
function CommonFun.calcBuff_1930(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = srcUser:GetBuffEndTime(115080)
      
  return A
end
----------------------------------------------------------------------------------恩赐 受治愈属性 舍命庇护
function CommonFun.calcBuff_1940(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  
  local A = 0.01*lv
  
  return A
end
----------------------------------------------------------------------------------金刚不坏攻击速度
function CommonFun.calcBuff_1950(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  
  local Num1  = srcUser:GetRunePoint(120030)

  local A = -0.5 + lv*0.05 + 0.03*Num1
      
  return A
end

----------------------------------------------------------------------------------普攻恢复SP
function CommonFun.calcBuff_1960(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  
  local Num1  = srcUser:GetRunePoint(120080)

  local A = 25*Num1
      
  return A
end

----------------------------------------------------------------------------------爆气攻速
function CommonFun.calcBuff_1970(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  
  local Num1  = srcUser:GetRunePoint(120090)

  local A = Num1 * 0.01
      
  return A
end

----------------------------------------------------------------------------------蓄气(忽视魔防)
function CommonFun.calcBuff_1980(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Num1  = srcUser:GetRunePoint(120170)
  local A = Num1*0.01

  return A
end
------------------------------------------------------------------------盾击眩晕概率【需要增加素质抵抗的计算公式】--【晕眩概率】
function CommonFun.calcBuff_2000(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local StunAtk = srcUser:GetProperty("StunAtk")
  local StunDef2 = targetUser:GetProperty("StunDef")
  local StunDam  = (1 + StunAtk - StunDef2)
  if StunDam <=0 then
     StunDam  =0
  end 
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk)*(1-StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  local Num1  = srcUser:GetRunePoint(70110)
  local A= (lv*a+b+Num1*15)*StunDam*StateDam*CommonFun.calcAttrDizzyRate(srcUser, targetUser)

  if A <= 0 then
    return 0
  end   

  return A
end

----------------------------------------------------------------------------------圣十字审判自身受到的伤害
function CommonFun.calcBuff_2010(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local BaseLv = srcUser.BaseLv
  local Str = srcUser:GetProperty("Str")
  local Int = srcUser:GetProperty("Int")
  local Num1  = srcUser:GetRunePoint(70080)

  local A = -(Str*2+math.floor(Str*Str/100)+Int*2+math.floor(Int*Int/100)+BaseLv*10)*3*(1-Num1*0.05)

  return A
end

----------------------------------------------------------------------------------大天使之盾反射魔法伤害
function CommonFun.calcBuff_2020(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0

  if srcUser:HasBuffID(40430) then
    local RefineLv = srcUser:GetEquipedRefineLv(1)
    A = RefineLv/100
  end

  return A
end

----------------------------------------------------------------------------------阿修罗 物伤减免添加概率
function CommonFun.calcBuff_2030(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0

  if srcUser:HasBuffID(90000935) then
     A = 100
  end

  return A
end
----------------------------------------------------------------------------------红十字杖+天衣月舞
function CommonFun.calcBuff_2040(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0

  if srcUser:HasBuffID(90000653) and srcUser:HasBuffID(90000683) then
    local RefineLv=srcUser:GetEquipedRefineLv(2)
    if RefineLv>=10 then
        A = 0.1
    else 
        A = 0.05
    end
  end

  return A
end

----------------------------------------------------------------------------------生机之杖+天衣月舞
function CommonFun.calcBuff_2041(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0

  if srcUser:HasBuffID(41960) and srcUser:HasBuffID(90000683) then
    local RefineLv=srcUser:GetEquipedRefineLv(2)
    if RefineLv>=10 then
        A = 0.1
    else 
        A = 0.05
    end
  end

  return A
end
----------------------------------------------------------------------------------秘衣恶德升级效果
function CommonFun.calcBuff_2050(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0
  local RefineLv=srcUser:GetEquipedRefineLv(2)

    if RefineLv>=5 and RefineLv<10 then
        A = 0.03
    elseif RefineLv>=10 and RefineLv<15 then
        A = 0.07
    elseif RefineLv ==15 then
        A = 0.12
    end
  
  return A
end
----------------------------------------------------------------------------------三角裤+衬衫 添加概率
function CommonFun.calcBuff_2060(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0
  if srcUser:HasBuffID(90000895) and srcUser:HasBuffID(90000733) then
      A = 100
  end

  return A
end
----------------------------------------------------------------------------------三角裤+衬衫 闪避转换
function CommonFun.calcBuff_2061(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Flee = srcUser:GetProperty("Flee")
  local A = 5*Flee

  return A
end
----------------------------------------------------------------------------------露娜弓+月亮胸针 添加概率
function CommonFun.calcBuff_2070(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0
  if srcUser:HasBuffID(90000995) and srcUser:HasBuffID(90001005) then
      A = 100
  end

  return A
end
----------------------------------------------------------------------------------大猫+时之蓝+高等布袋熊 添加概率
function CommonFun.calcBuff_2080(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0
  if srcUser:HasBuffID(90000985) and srcUser:HasBuffID(90001073) and srcUser:HasBuffID(40470) then
      A = 100
  end

  return A
end
----------------------------------------------------------------------------------神圣复仇者 减少 舍命攻击扣除的血量 （天谴）
function CommonFun.calcBuff_2090(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local MaxHp = srcUser:GetProperty("MaxHp")
  local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图
  local pvpRatio = 1

  if maptype==2 or maptype==4 then
      pvpRatio = 0.25
  end

  local A = -MaxHp*0.09*pvpRatio

  if srcUser:HasBuffID(90001093)  or srcUser:HasBuffID(41732) then
      A = -MaxHp*0.07*pvpRatio
  end

  return A
end
----------------------------------------------------------------------------------神圣复仇者  舍命攻击添加概率  （天谴）
function CommonFun.calcBuff_2091(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 8
  local B = 0

  --拥有华贵腕甲或狐纹腕甲[第四档]的Buff时概率额外附加
  if srcUser:HasBuffID(40170) or srcUser:HasBuffID(90000533)  then
    B = 12
  end

  if srcUser:HasBuffID(115090) and (srcUser:HasBuffID(90001093) or srcUser:HasBuffID(41732))then
    local Hp = srcUser:GetProperty("Hp")
    local MaxHp = srcUser:GetProperty("MaxHp")

    if Hp>MaxHp*0.09 then
        A = 40 
    end 
   end

   return A + B
end

----------------------------------------------------------------------------------狮鹫兽[存储]概率
function CommonFun.calcBuff_2092(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Profession=srcUser:GetProfressionID()
  local A = 3

  --怪物互击效果
  if srcUser:HasBuffID(80000710) and (Profession == 11 or Profession == 12 or Profession == 13 or Profession == 14 or Profession == 72 or Profession == 73 or Profession == 74 )  then
    A = 6
  end
  
  return A
end

----------------------------------------------------------------------------------半龙人[存储]概率
function CommonFun.calcBuff_2093(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 3

  --拥有半龙人[存储]的Buff时概率额外附加
  if srcUser:HasBuffID(80001290)  then
    A = 6
  end
  
  return A
end

----------------------------------------------------------------------------------大猫+水晶靴 添加概率
function CommonFun.calcBuff_2100(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0
  if srcUser:HasBuffID(90000985) and srcUser:HasBuffID(40440) then
      A = 100
  end

  return A
end
----------------------------------------------------------------------------------血之泪 拳刃修炼 
function CommonFun.calcBuff_2110(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local skilllv_1 = srcUser:GetLernedSkillLevel(189)

  if skilllv_1~=10 then
      a = 0
  end
  local A = a + b 

  return A
end
----------------------------------------------------------------------------------洛奇的指甲+华贵腕甲 添加概率
function CommonFun.calcBuff_2120(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0
  if srcUser:HasBuffID(90001034) and srcUser:HasBuffID(40170) then
      A = 100
  end

  return A
end
-------------------------------------------------------------洛奇的指甲  华贵腕甲的装备攻速转攻击力
function CommonFun.calcBuff_2121(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
    local EquipASPD = srcUser:GetProperty("EquipASPD")
    local A = math.floor(EquipASPD/2*100)
  
  if A <= 0 then
    return 0
  end
  return A
end
----------------------------------------------------------------------------------防水靴+丝质外袍 添加概率
function CommonFun.calcBuff_2130(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0
  if srcUser:HasBuffID(90000945) and srcUser:HasBuffID(90000955) then
      A = 100
  end

  return A
end
----------------------------------------------------------------------------------定位陷阱 伤害加成 添加概率
function CommonFun.calcBuff_2140(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 0
  if srcUser:HasBuffID(90001004)  then
      A = 0.1
  end

  return A
end
----------------------------------------------------------------------------------霸邪之阵
function CommonFun.calcBuff_2150(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 5

  local skilllv_1 = srcUser:GetLernedSkillLevel(150)

  if skilllv_1>=2 and skilllv_1<4 then
    A = 6
  elseif skilllv_1>=4 and skilllv_1<6 then
    A = 7
  elseif skilllv_1>=6 and skilllv_1<8 then
    A = 8
  elseif skilllv_1>=8 and skilllv_1<10 then 
    A = 9
  elseif skilllv_1 >=10 then
    A = 10
  end     

  return A
end
----------------------------------------------------------------------------------霸邪之阵
function CommonFun.calcBuff_2151(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local MaxHp = targetUser:GetProperty("MaxHp")
  local skilllv_1 = srcUser:GetLernedSkillLevel(150)-----------霸邪之阵

  local Num = srcUser:GetRunePoint(51004) ----霸邪之阵疾走 

  local extraLv = 0 
  if skilllv_1 >10 then
      extraLv = skilllv_1-10
  end

  local A = 0.1 + 0.02*math.min(skilllv_1,10) + (Num*1500+1500*extraLv)/MaxHp

  return A
end
----------------------------------------------------------------------------------隐匿眩晕概率
function CommonFun.calcBuff_2160(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 0
  local AttrEffect = srcUser:GetProperty("AttrEffect")
  local bits=CommonFun.getBits(AttrEffect)
  if bits[CommonFun.AttrEffect.HideStrengthEffect]==1 then
    A = 100
  end  

 return A
end

----------------------------------------------------------------------------------按技能等级恢复Hp
function CommonFun.calcBuff_2170(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local MaxHp = targetUser:GetProperty("MaxHp")
  local skilllv_1 = srcUser:GetLernedSkillLevel(102010)
  local A = MaxHp*(a+skilllv_1*b)

  if A <= 1 then
    A = 1
  end  
 return A
end

----------------------------------------------------------------------------------按技能等级恢复Sp
function CommonFun.calcBuff_2180(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local MaxSp = targetUser:GetProperty("MaxSp")
  local skilllv_1 = srcUser:GetLernedSkillLevel(102000)
  local A = MaxSp*(a+skilllv_1*b)

  if A <= 1 then
    A = 1
  end  

 return A
end

----------------------------------------------------------------------------------哥布灵首领卡片存储效果
function CommonFun.calcBuff_2190(srcUser, targetUser, a, b, c, d,lv, damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  if damage <= 1 then
    return 1
  end  

  local MaxHp = srcUser:GetProperty("MaxHp")
  local Hp = srcUser:GetProperty("Hp")
  local HpRatio = Hp / MaxHp
 
  if  CommonFun.IsInRate(50, srcUser:GetRandom())  and srcUser:HasBuffID(80000770) and HpRatio <=0.3 then
    return damage * 0.1
  else
    return damage * 0.05
  end

  
end

----------------------------------------------------------------------------------赤苍蝇卡片效果
function CommonFun.calcBuff_2200(srcUser, targetUser, a, b, c, d,lv,damage)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local MaxHp = srcUser:GetProperty("MaxHp")
  if damage <= 1 then
    return 1
  end  
  
  if srcUser:HasBuffID(80000880) then
    return MaxHp * 0.03
  else
    return MaxHp * 0.02
  end


end

----------------------------------------------------------------------------------毕帝特飞龙[存储]
function CommonFun.calcBuff_2210(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local MaxHp = srcUser:GetProperty("MaxHp")
  local MaxSp = srcUser:GetProperty("MaxSp")
  local MaxHpRatio = 0
  local MaxSpRatio = 0

  if MaxHp >=0 and MaxHp<2000 then
    MaxHpRatio = 0.01
  elseif MaxHp >=2000 and MaxHp<5000 then
    MaxHpRatio = 0.02    
  elseif MaxHp >=5000 and MaxHp<10000 then
    MaxHpRatio = 0.03
  elseif MaxHp >=10000 and MaxHp<20000 then
    MaxHpRatio = 0.04
  elseif MaxHp >=20000 and MaxHp<50000 then
    MaxHpRatio = 0.05
  elseif MaxHp >=50000 and MaxHp<100000 then
    MaxHpRatio = 0.06
  else
    MaxHpRatio = 0.07
  end


  if MaxSp >=0 and MaxSp<200 then
    MaxSpRatio = 0.01
  elseif MaxSp >=200 and MaxSp<500 then
    MaxSpRatio = 0.02
  elseif MaxSp >=500 and MaxSp<1000 then
    MaxSpRatio = 0.03
  elseif MaxSp >=1000 and MaxSp<2000 then
    MaxSpRatio = 0.04
  elseif MaxSp >=2000 and MaxSp<5000 then
    MaxSpRatio = 0.05
  elseif MaxSp >=5000 and MaxSp<10000 then
    MaxSpRatio = 0.06
  else
    MaxSpRatio = 0.07
  end

  local A = MaxHpRatio + MaxSpRatio + b

  if A >=1 then
    A = 1
  end  

  return A
end

----------------------------------------------------------------------------------兽人腐尸卡片[存储]
function CommonFun.calcBuff_2220(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local targetRace =  targetUser.race

  if targetRace ==5 and srcUser:HasBuffID(50670) then
    return -0.2
  else
    return 0
  end
end

----------------------------------------------------------------------------------永恒戒指
function CommonFun.calcBuff_2230(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring1=srcUser:GetEquipedID(5)
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local Ring2=srcUser:GetEquipedID(6)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)

  local a = 0
  local b = 0

  if (Ring1==44008 or Ring1==144008) and RefineLv1>=10 then
      a = RefineLv1/100
  end
  if (Ring2==44008 or Ring2==144008) and RefineLv2>=10 then
      b = RefineLv2/100
  end

 local A = a + b  

 return A
end

----------------------------------------------------------------------------------回血判断
function CommonFun.calcBuff_2240(srcUser, targetUser, a, b, c, d,lv)
--a HP百分比
--b SP百分比

  if srcUser == nil or targetUser == nil then
      return 0
  end

  local MaxHp = srcUser:GetProperty("MaxHp")
  local Hp = srcUser:GetProperty("Hp")
  local MaxSp = srcUser:GetProperty("MaxSp")
  local Sp = srcUser:GetProperty("Sp")
  local HpRatio = Hp / MaxHp
  local SpRatio = Sp / MaxSp

  if HpRatio <=a and srcUser:HasBuffID(80001440) and srcUser:HasBuffID(51251) then
    return 100
  else
    return 0
  end
end

----------------------------------------------------------------------------------生命药水投掷
function CommonFun.calcBuff_2250(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  local Vit = targetUser:GetProperty("Vit")
  local Int = srcUser:GetProperty("Int")
  local skilllv_1 = srcUser:GetLernedSkillLevel(419) ---知识药水
  local skilllv_2 = srcUser:GetLernedSkillLevel(423) ---生命药水投掷 
  local rate1 = 1
  local rate2 = 1

  if skilllv_1>=1 then
      rate1 = 1 + 0.1 + 0.02*skilllv_1
  end
  
  if skilllv_2>=1 then
      rate2 = 1 + 0.1*skilllv_2
  end
----------------------------------------------------------------援护者皮靴
  local Weapon=srcUser:GetEquipedID(4)
  local rate3 = 1
    if (Weapon==43551 or Weapon==143551) then
      rate3=rate3+0.2
  end
----------------------------------------------------------------援护者皮靴升级
  if srcUser:HasBuffID(90001563) then
      rate3=rate3+0.2
  end 
------------------------------------------------------[艾尔德之锤】]+[援护者皮靴]
  if srcUser:HasBuffID(91000130) then
      rate3=rate3+0.1
  end 
------------------------------------------------------酸蚀之触 + 援护者皮靴
  if srcUser:HasBuffID(91000700) then
      rate3=rate3+0.1
  end 
      
  local A = 400*(1+Vit*0.025)*(1+Int*0.005)*rate1*rate2*rate3

  return A

end

----------------------------------------------------------------------------------魔力药水投掷
function CommonFun.calcBuff_2260(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  local Int1 = targetUser:GetProperty("Int")
  local Int2 = srcUser:GetProperty("Int")
  local skilllv_1 = srcUser:GetLernedSkillLevel(419) ---知识药水
  local skilllv_2 = srcUser:GetLernedSkillLevel(424) ---魔力药水投掷 
  local rate1 = 1
  local rate2 = 1

  if skilllv_1>=1 then
      rate1 = 1 + 0.1 + 0.02*skilllv_1
  end
  
  if skilllv_2>=1 then
      rate2 = 1 + skilllv_2
  end

----------------------------------------------------------------援护者皮靴
  local Weapon=srcUser:GetEquipedID(4)
  local rate3 = 1
  if (Weapon==43551 or Weapon==143551) then
      rate3=rate3+0.2
  end
----------------------------------------------------------------援护者皮靴升级
  if srcUser:HasBuffID(90001563) then
      rate3=rate3+0.2
  end 
------------------------------------------------------[艾尔德之锤]+[援护者皮靴]
  if srcUser:HasBuffID(91000130) then
      rate3=rate3+0.1
  end 
------------------------------------------------------酸蚀之触 + 援护者皮靴
  if srcUser:HasBuffID(91000700) then
      rate3=rate3+0.1
  end 

  local A = 50*(1+Int1*0.015)*(1+Int2*0.0015)*rate1*rate2*rate3

  return A

end


----------------------------------------------------------------------------------银月魔女
function CommonFun.calcBuff_2270(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local IgnoreDef = 0
  local IgnoreDef1 = srcUser:GetProperty("IgnoreDef")
  local IgnoreDef2 = srcUser:GetProperty("IgnoreEquipDef")
  if targetUser.boss or targetUser.mini then
     IgnoreDef=IgnoreDef1
  else
     IgnoreDef=(IgnoreDef1+IgnoreDef2)  
  end
  
  if IgnoreDef >= 1 then
     IgnoreDef=1
  end 

  local Def2 = targetUser:GetProperty("Def")
  local DefPer2 = targetUser:GetProperty("DefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local VitPer2 = targetUser:GetProperty("VitPer")
  local DamReduc2 = CommonFun.calcDamReDuc(srcUser, targetUser)
  local RefineDamReduc = targetUser:GetProperty("RefineDamReduc")
  local Sp = srcUser:GetProperty("Sp")
  local Luk = srcUser:GetProperty("Luk")

  ----------------------------物理防御减免
  local DefReduc= CommonFun.CalcDef(Def,Vit,srcUser,targetUser)

  local A = -(Sp*(1+Luk/100)*DefReduc*(1-RefineDamReduc)*(1-DamReduc2)-Vit2*(1+VitPer2))

  ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = -1
    end
        --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = -1
    end

  --print("A="..A,"Sp="..Sp,"Luk="..Luk)

  return A

end

----------------------------------------------------------------------------------生命通灵(生命体2)
function CommonFun.calcBuff_2280(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  local Atk = srcUser:GetProperty("Atk")
  local AtkPer = srcUser:GetProperty("AtkPer")
  local MAtk = srcUser:GetProperty("MAtk")
  local MAtkPer = srcUser:GetProperty("MAtkPer")
  local skilllv_1 = srcUser:GetLernedSkillLevel(417) ---生命通灵

  local A = Atk*(1+AtkPer+0.1+0.01*skilllv_1)*(0.1+skilllv_1*0.02)+MAtk*(1+MAtkPer+0.1+0.01*skilllv_1)*skilllv_1*0.01

  return A

end
----------------------------------------------------------------------------------生命通灵(生命体3)
function CommonFun.calcBuff_2290(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  local Atk = srcUser:GetProperty("Atk")
  local AtkPer = srcUser:GetProperty("AtkPer")
  local MAtk = srcUser:GetProperty("MAtk")
  local MAtkPer = srcUser:GetProperty("MAtkPer")
  local skilllv_1 = srcUser:GetLernedSkillLevel(417) ---生命通灵

  local A = Atk*(1+AtkPer+0.1+0.01*skilllv_1)*skilllv_1*0.01+MAtk*(1+MAtkPer+0.1+0.01*skilllv_1)*(0.1+skilllv_1*0.02)

  return A

end

----------------------------------------------------------------------------------超生命通灵(生命体2)
function CommonFun.calcBuff_2300(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  local Vit = srcUser:GetProperty("Vit")

  local skilllv_1 = srcUser:GetLernedSkillLevel(427) ---生命通灵
  skilllv_1 = math.min(skilllv_1,7)
  local A = Vit*(skilllv_1+2)

  return A

end

----------------------------------------------------------------------------------超生命通灵(生命体3)
function CommonFun.calcBuff_2310(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  local Vit = srcUser:GetProperty("Vit")

  local skilllv_1 = srcUser:GetLernedSkillLevel(427) ---生命通灵
  skilllv_1 = math.min(skilllv_1,5)
  local A = Vit*skilllv_1

  return A

end

----------------------------------------------------------------------------------化学铠甲保护
function CommonFun.calcBuff_2320(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local skilllv_1 = srcUser:GetLernedSkillLevel(430) ---化学铠甲保护

  local A = 100*skilllv_1

  return A

end

----------------------------------------------------------------------------------巴尼米乐斯的祈福
function CommonFun.calcBuff_2330(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

   local A = 0

   if  srcUser:IsBeingPresent(600030)==true then
       A = 20
   end

  return A

end

----------------------------------------------------------------------------------艾米斯可鲁的祈福
function CommonFun.calcBuff_2340(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

   local A = 0

   if  srcUser:IsBeingPresent(600020)==true then
       A = 20
   end

  return A

end

----------------------------------------------------------------------------------智力转换
function CommonFun.calcBuff_2350(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
   local Int = srcUser:GetProperty("Int")
   local Num = srcUser:GetRunePoint(130070)

   local A = 0.2*Num*Int

  return A

end

----------------------------------------------------------------------------------幸运转换
function CommonFun.calcBuff_2360(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
   local Luk = srcUser:GetProperty("Luk")
   local Num = srcUser:GetRunePoint(130240)

   local A = 0.2*Num*Luk

  return A

end

----------------------------------------------------------------------------------化学头盔保护
function CommonFun.calcBuff_2370(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local skilllv_1 = srcUser:GetLernedSkillLevel(433) ---化学头盔保护

  local A = 100*skilllv_1

  return A

end
----------------------------------------------------------------------------------化学副手保护
function CommonFun.calcBuff_2380(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local skilllv_1 = srcUser:GetLernedSkillLevel(434) ---化学副手保护

  local A = 100*skilllv_1

  return A

end
----------------------------------------------------------------------------------生命体修复
function CommonFun.calcBuff_2390(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local skilllv_1 = srcUser:GetLernedSkillLevel(435) ---化学副手保护
  local MaxHp = targetUser:GetProperty("MaxHp")

  local A = 0.02*skilllv_1*MaxHp

  return A

end
----------------------------------------------------------------------------------配药 生命药水投掷
function CommonFun.calcBuff_2400(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local skilllv_1 = srcUser:GetLernedSkillLevel(423) ---生命药水投掷
  local A = 0
  
  if skilllv_1 >=1 then
     A = 0.04*skilllv_1+0.1
  end

  return A

end
----------------------------------------------------------------------------------饰品 拆卸
function CommonFun.calcBuff_2410(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   local skilllv_1 = srcUser:GetLernedSkillLevel(491) ---卸除饰品
   local skilllv_2 = srcUser:GetLernedSkillLevel(492) ---卸除双倍饰品
   local skilllv_3 = srcUser:GetLernedSkillLevel(493) ---卸除武器
   local Luk = srcUser:GetProperty("Luk")
   local Dex = srcUser:GetProperty("Dex")

   -----------------------------------------------------------------------------------破甲短锥卸除首饰
   local RefineLv=srcUser:GetEquipedRefineLv(7)
   local Weapon=srcUser:GetEquipedID(7)
   local pojia=0
   if (Weapon==40746 or Weapon==140746) then
    if (RefineLv>=5 and RefineLv<10 ) then 
      pojia=5
      elseif (RefineLv>=10 and RefineLv<15 ) then 
        pojia=10
      elseif RefineLv==15 then
          pojia=20
      end
    end
  -----------------------------------------------------------------------------------破甲短锥[第四档]卸除首饰 
    if srcUser:HasBuffID(90001893) then 
        if RefineLv > 5 then 
         pojia=pojia + (RefineLv-5)* 1
        end 
    end

-----------------------------------------------------------------------------------象牙匕首卸除首饰 
   local Weapon_1=srcUser:GetEquipedID(7)
   local pojia_1=0
   if (Weapon_1==40743 or Weapon_1==140743) then 
      pojia_1=3
    end

-----------------------------------------------------------------------------------象牙匕首精炼+8卸除盾牌
   local pojia_8=0
    if srcUser:HasBuffID(90001643) then 
     if RefineLv>=8  then 
      pojia_8=3
    end
  end

   local Rate = math.min(skilllv_1*3+skilllv_2*3+skilllv_3*3+pojia+pojia_1+pojia_8+(Luk+Dex)/5,90)

   if CommonFun.IsInRate(Rate, srcUser:GetRandom()) then---------------成功卸除的话，判断卸除部位
      local off5 = targetUser:IsEquipForceOff(5)
      local off6 = targetUser:IsEquipForceOff(6)
      local off7 = targetUser:IsEquipForceOff(7)
      local equiped5 = targetUser:GetEquipedID(5) ~= 0
      local equiped6 = targetUser:GetEquipedID(6) ~= 0
      local equiped7 = targetUser:GetEquipedID(7) ~= 0
      local skill2 = skilllv_2>0
      local skill3 = skilllv_3>0

      local odd = {1,1,0,0}
      if skill2 then
         odd[3] = 2
      end
      if skill3 then
         odd[4] = 2
      end
      if off5 or equiped5 == false then
         odd[1] = 0
      end
      if off6 or equiped6 == false then
         odd[2] = 0
      end
      if off7 or equiped7 == false then
         odd[4] = 0
      end
      if odd[1] == 0 or odd[2] == 0 then
         odd[3] = 0
      end

      local r = 100
      local c1, c2 = 0, 0
      for i, v in ipairs(odd) do
         if v == 2 then
            odd[i] = 30
            r = r - 30
            c2 = c2 + 1
         elseif v == 1 then
            c1 = c1 + 1
         end
      end

      if c1 > 0 then
         for i, v in ipairs(odd) do
            if v == 1 then
               odd[i] = r / c1
            end
         end
      elseif c2 > 0 then
         for i, v in ipairs(odd) do
            if v == 30 then
               odd[i] = 100 / c2
            end
         end
      end

      r = 0
      for i, v in ipairs(odd) do
         if v ~= 0 then
            r = r + v
            odd[i] = r
         end
      end

      local pos = {[1] = {w = odd[1], pos = 5}, [2] = {w = odd[2], pos = 6}, [3] = {w = odd[3], pos = 506}, [4] = {w = odd[4], pos = 7}}
      local random = srcUser:GetRandom()

      for k,v in ipairs(pos) do
         if v.w>=random then
            return v.pos
         end
      end

      return 0
   end

   return 0

end
--------------------------------------------------------------------------------饰品拆除 降低魔物攻击力
function CommonFun.calcBuff_2420(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   local n,m = 0,0

   if  targetUser:GetNpcID() == 0 then
        n = 1
   end

   if targetUser:GetNpcID() ~= 0 and targetUser.boss == false and targetUser.mini == false then
        m = 1
   end

   local A =a*n+b*m

   return A 

end
--------------------------------------------------------------------------------野蛮凶砍  怪物
function CommonFun.calcBuff_2421(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local m = 0

   if targetUser:GetNpcID() ~= 0 then
        m = 1
   end

   local A =a*m

   return A 

end
----------------------------------------------------------------------------------盾牌 拆卸
function CommonFun.calcBuff_2430(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   local skilllv_1 = srcUser:GetLernedSkillLevel(494) ---卸除盾牌
   local skilllv_2 = srcUser:GetLernedSkillLevel(495) ---卸除靴子
   local skilllv_3 = srcUser:GetLernedSkillLevel(496) ---卸除头盔
   local skilllv_4 = srcUser:GetLernedSkillLevel(497) ---卸除铠甲
   local skilllv_5 = srcUser:GetLernedSkillLevel(498) ---双倍卸除防具

   local Luk = srcUser:GetProperty("Luk")
   local Dex = srcUser:GetProperty("Dex")
--------------------------------------------------------------破甲短锥卸除盾牌
   local RefineLv=srcUser:GetEquipedRefineLv(7)
   local Weapon=srcUser:GetEquipedID(7)
   local pojia=0
   if (Weapon==40746 or Weapon==140746) then
    if (RefineLv>=5 and RefineLv<10 ) then 
      pojia=5
      elseif (RefineLv>=10 and RefineLv<15 ) then 
        pojia=10
      elseif RefineLv==15 then
          pojia=20
      end
    end
  -----------------------------------------------------------------------------------破甲短锥[第四档]卸除盾牌
    if srcUser:HasBuffID(90001893) then 
        if RefineLv > 5 then 
         pojia=pojia + (RefineLv-5)* 1
        end 
    end


    -----------------------------------------------------------------------------------象牙匕首卸除盾牌
   local Weapon_1=srcUser:GetEquipedID(7)
   local pojia_1=0
   if (Weapon_1==40743 or Weapon_1==140743) then 
      pojia_1=3
    end
   -----------------------------------------------------------------------------------象牙匕首精炼+8卸除盾牌
   local pojia_8=0
    if srcUser:HasBuffID(90001643) then 
     if RefineLv>=8  then 
      pojia_8=3
    end
  end
   
   local Rate = math.min(skilllv_1*3+skilllv_2*3+skilllv_3*3+skilllv_4*3 + pojia + pojia_1 +pojia_8+ (Luk+Dex)/5,90)


   if CommonFun.IsInRate(Rate, srcUser:GetRandom()) then---------------成功卸除的话，判断卸除部位
      local skill2=skilllv_2>0
      local skill3=skilllv_3>0
      local skill4=skilllv_4>0
      local skill5=skilllv_5>0
      local off, equiped = {}, {}
      off[1], equiped[1] = targetUser:IsEquipForceOff(1), targetUser:GetEquipedID(1) ~= 0-----盾牌
      off[4], equiped[4] = targetUser:IsEquipForceOff(4), targetUser:GetEquipedID(4) ~= 0-----靴子
      off[8], equiped[8] = targetUser:IsEquipForceOff(8), targetUser:GetEquipedID(8) ~= 0-----头盔
      off[2], equiped[2] = targetUser:IsEquipForceOff(2), targetUser:GetEquipedID(2) ~= 0-----铠甲
      local result, rate = 0, 1

      for i = 1, 2 do
         local odd={1,0,0,0}
         local c1 = 1

         if off[1] or equiped[1] == false then
            odd[1] = 0
            c1 = c1 - 1
         end
         if skill2 and off[4]==false and equiped[4] then
            odd[2] = 1
            c1 = c1 + 1
         end
         if skill3 and off[8]==false and equiped[8] then
            odd[3] = 1
            c1 = c1 + 1
         end
         if skill4 and off[2]==false and equiped[2] then
            odd[4] = 1
            c1 = c1 + 1
         end


         local r = 0
         for k, v in ipairs(odd) do
            if v == 1 then
               r = 100 / c1 + r
               odd[k] = r
            end
         end

         local pos = {[1] = {w = odd[1], pos = 1}, [2] = {w = odd[2], pos = 4}, [3] = {w = odd[3], pos = 8}, [4] = {w = odd[4], pos = 2}}
         local random = srcUser:GetRandom()

         for k,v in ipairs(pos) do
            if v.w>=random then
               result = result + v.pos * rate
               rate = rate * 100
               off[v.pos] = true
               break
            end
         end

         -- 随机双倍
         if srcUser:GetRandom() > skilllv_5 * 10 then
            break
         end
      end

      return result
   end

   return 0
   
end

----------------------------------------------------------------------------------火烟瓶投掷  武器破坏
function CommonFun.calcBuff_2440(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   local Rate = 5 --------------------基础破坏率
   local skilllv_1 = srcUser:GetLernedSkillLevel(432)-------------化学武器破坏
   local skilllv_2 = srcUser:GetLernedSkillLevel(464)-------------化学盾牌破坏
   local Luk = srcUser:GetProperty("Luk")
   local Dex = srcUser:GetProperty("Dex")

   local effect =0 
   if skilllv_1>0 and skilllv_1<=10 then
      effect = 10+5*skilllv_1
   elseif skilllv_1>10 then
      effect = 60 + (skilllv_1-10)*2
   end
  
   Rate = 5 + math.min(effect,(Luk+Dex)/5)/4
  ---------------------------------------------------------------------艾尔德提升基础率 +酸蚀之触
   local Weapon=srcUser:GetEquipedID(7)
   if (Weapon==41545 or Weapon==141545 or Weapon==41567 or Weapon==141567) then 
     Rate = Rate + 5
   end

   local pos = 0

   if CommonFun.IsInRate(Rate, srcUser:GetRandom())  then
      pos = 7
      if skilllv_2>0 and CommonFun.IsInRate(skilllv_2*10, srcUser:GetRandom()) then 
        pos =107
      end
   end 

   return pos 

end

----------------------------------------------------------------------------------武器破坏(怪物用)
function CommonFun.calcBuff_2441(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   local Rate = 20 --------------------基础破坏率
   local skilllv_1 = 10
   local skilllv_2 = 10
   local Luk = srcUser:GetProperty("Luk")
   local Dex = srcUser:GetProperty("Dex")

   if skilllv_1 >0 then 
      Rate = 5 + math.min(10+5*skilllv_1,(Luk+Dex)/5)/4
   end
   local pos = 0

   if CommonFun.IsInRate(Rate, srcUser:GetRandom())  then
      pos = 7
      if skilllv_2>0 and CommonFun.IsInRate(skilllv_2*10, srcUser:GetRandom()) then 
        pos =107
      end
   end 

   return pos 

end

----------------------------------------------------------------------------------铠甲破坏(怪物用)
function CommonFun.calcBuff_2442(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   local Rate = 20 --------------------基础破坏率
   local skilllv_1 = 10
   local skilllv_2 = 10
   local Luk = srcUser:GetProperty("Luk")
   local Dex = srcUser:GetProperty("Dex")

   if skilllv_1 >0 then 
      Rate = 5 + math.min(10+5*skilllv_1,(Luk+Dex)/5)
   end
   local pos = 0

   if CommonFun.IsInRate(Rate, srcUser:GetRandom())  then
      pos = 2
      if skilllv_2>0 and CommonFun.IsInRate(skilllv_2*10, srcUser:GetRandom()) then 
        pos =208
      end
   end 

   return pos 

end

--------------------------------------------------------------------------------强酸攻击  破坏铠甲
function CommonFun.calcBuff_2450(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skill = srcUser:GetLernedSkillLevel(411) ----------------强酸攻击
   local skilllv_1 = srcUser:GetLernedSkillLevel(432)-------------化学武器破坏
   local skilllv_2 = srcUser:GetLernedSkillLevel(463)-------------化学头盔破坏
   local Luk = srcUser:GetProperty("Luk")
   local Dex = srcUser:GetProperty("Dex")

   local Rate = skill
   local effect =0 
   if skilllv_1>0 and skilllv_1<=10 then
      effect = 10+5*skilllv_1
   elseif skilllv_1>10 then
      effect = 60 + (skilllv_1-10)*2
   end

   Rate = skill + math.min(effect,(Luk+Dex)/5)
  ---------------------------------------------------------------------  艾尔德提升基础率 +酸蚀之触
  local Weapon=srcUser:GetEquipedID(7)
   if (Weapon==41545 or Weapon==141545 or Weapon==41567 or Weapon==141567) then
      Rate = Rate+5
   end

  local pos = 0 

   if CommonFun.IsInRate(Rate, srcUser:GetRandom())  then
      pos = 2
      if skilllv_2>0 and CommonFun.IsInRate(skilllv_2*10, srcUser:GetRandom()) then 
        pos =208
      end
   end 

   return pos 

end

--------------------------------------------------------------------------------强酸火烟瓶  破坏武器
function CommonFun.calcBuff_2460(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skill = srcUser:GetLernedSkillLevel(422) ----------------强酸火烟瓶
   local skilllv_1 = srcUser:GetLernedSkillLevel(432)-------------化学武器破坏
   local skilllv_2 = srcUser:GetLernedSkillLevel(464)-------------化学盾牌破坏
   local Luk = srcUser:GetProperty("Luk")
   local Dex = srcUser:GetProperty("Dex")

   local Rate = skill
   local effect =0 
   if skilllv_1>0 and skilllv_1<=10 then
      effect = 10+5*skilllv_1
   elseif skilllv_1>10 then
      effect = 60 + (skilllv_1-10)*2
   end

   Rate = skill + math.min(effect,(Luk+Dex)/5)
---------------------------------------------------------------------艾尔德提升基础率 +酸蚀之触
  local Weapon=srcUser:GetEquipedID(7)
   if (Weapon==41545 or Weapon==141545 or Weapon==41567 or Weapon==141567) then
      Rate = Rate+5
    end  

   local pos = 0

   if CommonFun.IsInRate(Rate, srcUser:GetRandom())  then
      pos = 7
      if skilllv_2>0 and CommonFun.IsInRate(skilllv_2*10, srcUser:GetRandom()) then 
        pos =107
      end
   end 

   return pos 

end

--------------------------------------------------------------------------------强酸火烟瓶  破坏盔甲
function CommonFun.calcBuff_2470(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skill = srcUser:GetLernedSkillLevel(422) ----------------强酸火烟瓶
   local skilllv_1 = srcUser:GetLernedSkillLevel(432)-------------化学武器破坏
   local skilllv_2 = srcUser:GetLernedSkillLevel(463)-------------化学头盔破坏
   local Luk = srcUser:GetProperty("Luk")
   local Dex = srcUser:GetProperty("Dex")

   local Rate = skill 
   local effect =0 
   if skilllv_1>0 and skilllv_1<=10 then
      effect = 10+5*skilllv_1
   elseif skilllv_1>10 then
      effect = 60 + (skilllv_1-10)*2
   end

   Rate = skill + math.min(effect,(Luk+Dex)/5)
   ---------------------------------------------------------------------艾尔德提升基础率  +酸蚀之触
  local Weapon=srcUser:GetEquipedID(7)
   if (Weapon==41545 or Weapon==141545  or Weapon==41567 or Weapon==141567 ) then
      Rate = Rate+5
    end  

   local pos = 0

   if CommonFun.IsInRate(Rate, srcUser:GetRandom())  then
      pos = 2
      if skilllv_2>0 and CommonFun.IsInRate(skilllv_2*10, srcUser:GetRandom()) then 
        pos =208
      end
   end 

   return pos 

end

--------------------------------------------------------------------------------野蛮凶砍  破坏武器 铠甲
function CommonFun.calcBuff_2480(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skill = srcUser:GetLernedSkillLevel(217) ----------------野蛮凶砍

   local pos = 0
   local random1 = srcUser:GetRandom()
   local random2 = srcUser:GetRandom()

   if CommonFun.IsInRate(skill,random1) and CommonFun.IsInRate(skill*0.7,random2) then
      pos = 207
      if CommonFun.IsInRate(skill,random1) and CommonFun.IsInRate(skill*0.7,random2)==false then 
        pos =7
      elseif CommonFun.IsInRate(skill,random1)==false and CommonFun.IsInRate(skill*0.7,random2) then
        pos =2
      end
   end 

   return pos 

end
--------------------------------------------------------------------------------隐匿强化 
function CommonFun.calcBuff_2490(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skill = srcUser:GetLernedSkillLevel(467) ----------------隐匿强化
   ---------------------------星盘隐匿强化
   local Num1 = srcUser:GetRunePoint(90160)

   local A = skill*2 + 1 + Num1


   return A 

end
--------------------------------------------------------------------------------潜击 伤害加成
function CommonFun.calcBuff_2500(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skill = srcUser:GetLernedSkillLevel(481) ----------------潜击
   ---------------------------星盘潜击
   local Num1 = srcUser:GetRunePoint(90070)

   local A = skill*0.01 + 0.1 + Num1*0.03

   return A 

end
--------------------------------------------------------------------------------擒拿 霸邪 概率
function CommonFun.calcBuff_2510(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local A = 0 

   local Num1 = srcUser:GetRunePoint(90130)

   if Num1 > 0 then
        A = 100
   end

   return A 

end
--------------------------------------------------------------------------------擒拿 霸邪 次数
function CommonFun.calcBuff_2520(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   local Num1 = srcUser:GetRunePoint(90130)

   local A = Num1*2

   return A 

end
--------------------------------------------------------------------------------擒拿 霸邪 上限
function CommonFun.calcBuff_2530(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   local Num1 = srcUser:GetRunePoint(90130)

   local A = Num1*0.1

   return A 

end
--------------------------------------------------------------------------------致命涂毒 巅峰等级
function CommonFun.calcBuff_2540(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skill = srcUser:GetLernedSkillLevel(198) ----------------致命涂毒
   local A = 0

   if skill>10 then 
        A = 100
   end

   return A 

end
--------------------------------------------------------------------------------伏击 背刺添加概率
function CommonFun.calcBuff_2550(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local profressionID = srcUser:GetProfressionID()
   local A = 0       

   if (profressionID==92 or profressionID==93 or profressionID==94)  then
        A = 100
   end

   return A 

end
--------------------------------------------------------------------------------银月魔女猫  添加概率
function CommonFun.calcBuff_2560(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
   local A = 100      

   local AttrFunction = srcUser:GetProperty("AttrFunction")
   local bitfunc = CommonFun.getBits(AttrFunction)

    if (targetUser.boss or targetUser.mini or targetUser.changelinepunish) and targetUser.zoneType == 1 then
      if bitfunc[CommonFun.AttrFunction.JustInViceZone] == 1 then
        A = 0
      end
    end
    --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = 0
    end

   return A 

end
--------------------------------------------------------------------------------波利套装 添加概率
function CommonFun.calcBuff_2570(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
   local A = 100      

    if  targetUser:GetNpcID() == 0 or targetUser.boss or targetUser.mini then
        A = 0
    end    

   return A 

end

----------------------------------------------------------------------------------炼金铠甲_丽芙
function CommonFun.calcBuff_2580(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

   local A = 0

   if  srcUser:IsBeingPresent(600010)==true then
       A = 4
   end
  return A

end

----------------------------------------------------------------------------------炼金铠甲_丽芙2
function CommonFun.calcBuff_2581(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

   local A = 0

   if  srcUser:IsBeingPresent(600010)==true then
       A = 8
   end
  return A

end


----------------------------------------------------------------------------------炼金铠甲_艾米斯可鲁
function CommonFun.calcBuff_2590(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

   local A = 0

   if  srcUser:IsBeingPresent(600020)==true then
       A = 0.04
   end

  return A

end

----------------------------------------------------------------------------------炼金铠甲_艾米斯可鲁2
function CommonFun.calcBuff_2591(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

   local A = 0

   if  srcUser:IsBeingPresent(600020)==true then
       A = 0.08
   end

  return A

end

----------------------------------------------------------------------------------炼金铠甲_艾米斯可鲁3
function CommonFun.calcBuff_2592(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

   local A = 0

   if  srcUser:IsBeingPresent(600020)==true then
       A = 100
   end

  return A

end

----------------------------------------------------------------------------------炼金铠甲_巴尼米乐斯
function CommonFun.calcBuff_2600(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

   local A = 0

   if  srcUser:IsBeingPresent(600030)==true then
       A = 0.04
   end

  return A

end

----------------------------------------------------------------------------------炼金铠甲_巴尼米乐斯2
function CommonFun.calcBuff_2601(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

   local A = 0

   if  srcUser:IsBeingPresent(600030)==true then
       A = 0.08
   end

  return A

end

----------------------------------------------------------------------------------芬特克的手环精炼时闪避转换物理攻击
function CommonFun.calcBuff_2610(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Flee = srcUser:GetProperty("Flee")
  local Weapon1=srcUser:GetEquipedID(1)
  local RefineLv=srcUser:GetEquipedRefineLv(1)
  local Profession=srcUser:GetProfressionID()
  local A = 0
  if (Weapon1==61512 or Weapon1==161512) then
    if (RefineLv>=10 and RefineLv<15) then 
      A=Flee/10
      elseif RefineLv==15 then
      A=Flee/10+Flee/5
    end
  end
  if A <= 0 then
    return 0
  end
    return A
end

----------------------------------------------------------------------------------斯勒特手斧[第四档]

function CommonFun.calcBuff_2620(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Weapon1=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A = 0

  if (Weapon1==41836 or Weapon1==141836)  then
      A = RefineLv/100
  end

 return A
end

----------------------------------------------------------------------------------名刀不知火[第四档]

function CommonFun.calcBuff_2630(srcUser, targetUser, a, b, c, d,lv)


  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A = 0.05

  if (Ring==40322 or Ring==140322)  then
    if (RefineLv>=10 and RefineLv<15) then 
      A=0.05+0.05
      elseif RefineLv==15 then
      A=0.05+0.05+0.05
    end
  end

 return A
end
----------------------------------------------------------------------------------兔子拖鞋[第四档]

function CommonFun.calcBuff_2640(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(4)
  local RefineLv=srcUser:GetEquipedRefineLv(4)
  local A =0

  if (Ring==43509 or Ring==143509)  then
    if (RefineLv>=10 and RefineLv<15) then 
      A=0+0.05
      elseif RefineLv==15 then
      A=0+0.05+0.05
    end
  end

 return A
end

----------------------------------------------------------------------------------修尔特长矛[第四档]

function CommonFun.calcBuff_2650(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0.1

  if (Ring==40011 or Ring==140011)  then
    if (RefineLv>=10 and RefineLv<15) then 
      A=0.1+0.1
      elseif RefineLv==15 then
      A=0.1+0.1+0.3
    end
  end

 return A
end

----------------------------------------------------------------------------------多芙斗篷[第四档]

function CommonFun.calcBuff_2660(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(3)
  local RefineLv=srcUser:GetEquipedRefineLv(3)
  local A =0

  if (Ring==43030 or Ring==143030)  then
    if (RefineLv>=10 and RefineLv<15) then 
      A=0.05
      elseif RefineLv==15 then
      A=0.1
    end
  end

 return A
end

----------------------------------------------------------------------------------皇家之盾[第六档]

function CommonFun.calcBuff_2670(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(1)
  local RefineLv=srcUser:GetEquipedRefineLv(1)
  local A =10

  if (Ring==42513 or Ring==142513)  then
    if (RefineLv>=10 and RefineLv<15) then 
      A=10+5
      elseif RefineLv==15 then
      A=10+5+10
    end
  end

 return A
end


----------------------------------------------------------------------------------沙漠之风[第四档]1

function CommonFun.calcBuff_2680(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0

  if (Ring==40723 or Ring==140723)  then
    if RefineLv>=10 then 
      A=0+0.05
    end
  end

 return A
end

----------------------------------------------------------------------------------沙漠之风[第四档]2

function CommonFun.calcBuff_2690(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0

  if (Ring==40723 or Ring==140723)  then
    if RefineLv>=12 then 
      A=0+0.1
    end
  end

 return A
end
----------------------------------------------------------------------------------荒漠风暴

function CommonFun.calcBuff_2691(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0

  if (Ring==40766 or Ring==140766)  then
    if RefineLv>=12 then 
      A=0+0.1
    end
  end

 return A
end


----------------------------------------------------------------------------------代理者拳刃[第四档]

function CommonFun.calcBuff_2700(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Weapon1=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A = 0

  if (Weapon1==40914 or Weapon1==140914)  then
      A = RefineLv/100
  end

 return A
end

----------------------------------------------------------------------------------献祭之书[第四档]
function CommonFun.calcBuff_2710(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Weapon1=srcUser:GetEquipedID(1)
  local IgnoreMDef = srcUser:GetProperty("IgnoreMDef")
  local A = 0
  if (Weapon1==42535 or Weapon1==142535)  then
      A = IgnoreMDef*100*0.5
  end

 return A
end


----------------------------------------------------------------------------------魔锤安魂曲[第四档]

function CommonFun.calcBuff_2720(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0

  if (Ring==41509 or Ring==141509)  then
    if (RefineLv>=5 and RefineLv<10) then 
      A=0.03
      elseif (RefineLv>=10 and RefineLv<15) then 
      A=0.08
      elseif RefineLv==15 then
      A=0.15
    end
  end

 return A
end

----------------------------------------------------------------------------------高等生存魔杖[第四档]1

function CommonFun.calcBuff_2730(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0

  if (Ring==40621 or Ring==140621)  then
    if (RefineLv>=5 and RefineLv<10) then 
      A=0.05
      elseif (RefineLv>=10) then 
      A=0.1
    end
  end

 return A
end

----------------------------------------------------------------------------------高等生存魔杖[第四档]2

function CommonFun.calcBuff_2740(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0

  if (Ring==40621 or Ring==140621)  then
    if (RefineLv==15) then 
      A=0.05
  
    end
  end

 return A
end

----------------------------------------------------------------------------------深红闪电[第四档]1

function CommonFun.calcBuff_2750(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0

  if (Ring==41232 or Ring==141232)  then
    if (RefineLv>=10 and RefineLv<=15) then 
      A=0.08
    end
  end

 return A
end

----------------------------------------------------------------------------------深红闪电[第四档]2

function CommonFun.calcBuff_2760(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0

  if (Ring==41232 or Ring==141232)  then
    if (RefineLv==15) then 
      A=0.1
  
    end
  end

 return A
end


----------------------------------------------------------------------------------神射手之衣[第四档]

function CommonFun.calcBuff_2770(srcUser, targetUser, a, b, c, d,lv)

  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(2)
  local RefineLv=srcUser:GetEquipedRefineLv(2)
  local A = 0.05

  if (Ring==42055 or Ring==142055)  then
   if (RefineLv>=5 and RefineLv<10) then 
      A=0.05+0.03
      elseif (RefineLv>=10 and RefineLv<15) then 
      A=0.05+0.08
      elseif RefineLv==15 then
      A=0.05+0.15
  end
 end
 return A
end
----------------------------------------------------------------------------------巨灵拳套[第四档]1

function CommonFun.calcBuff_2780(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =24

  if (Ring==62509 or Ring==162509)  then
    if RefineLv>=5  then 
      A=24+40
    end
  end

 return A
end

----------------------------------------------------------------------------------巨灵拳套[第四档]2

function CommonFun.calcBuff_2790(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0

  if (Ring==62509 or Ring==162509)  then
    if (RefineLv>=10 and RefineLv<=15) then 
      A=200
    end
  end

 return A
end

----------------------------------------------------------------------------------巨灵拳套[第四档]3

function CommonFun.calcBuff_2800(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0

  if (Ring==62509 or Ring==162509)  then
    if RefineLv==15 then 
      A=0.05
    end
  end

 return A
end

----------------------------------------------------------------------------------升龙拳套[第四档]

function CommonFun.calcBuff_2810(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A =30
  if srcUser:HasBuffID(90001513) and srcUser:HasBuffID(90001123) then 
        A =60
  end

 return A
end


----------------------------------------------------------------------------------圣母圣像[第四档]

function CommonFun.calcBuff_2820(srcUser, targetUser, a, b, c, d,lv)

  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(1)
  local RefineLv=srcUser:GetEquipedRefineLv(1)
  local A = 0

  if (Ring==60504 or Ring==160504)  then
   if (RefineLv>=5 and RefineLv<10) then 
      A=0.05
      elseif (RefineLv>=10 and RefineLv<15) then 
      A=0.05+0.05
      elseif RefineLv==15 then
      A=0.05+0.05+0.1
  end
 end
 return A
end


----------------------------------------------------------------------------------炼金合金装甲[第四档]

function CommonFun.calcBuff_2830(srcUser, targetUser, a, b, c, d,lv)

  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(2)
  local RefineLv=srcUser:GetEquipedRefineLv(2)
  local A = 0

  if (Ring==42075 or Ring==142075)  then
   if (RefineLv>=5 and RefineLv<10) then 
      A=0.02
      elseif RefineLv>=10  then 
      A=0.02+0.03
  end
 end
 return A
end

----------------------------------------------------------------------------------考尔德短剑[第六档]

function CommonFun.calcBuff_2840(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(7)
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0

  if (Ring==40742 or Ring==140742)  then
    if (RefineLv>=10 and RefineLv<15) then 
      A=0.05
      elseif RefineLv==15 then
      A=0.05+0.1
    end
  end

 return A
end
----------------------------------------------------------------------------------黑曜石斗篷[第五档]
function CommonFun.calcBuff_2850(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(3)
  local RefineLv=srcUser:GetEquipedRefineLv(3)
  local A =a

  if (Ring==43028 or Ring==143028) and srcUser:HasBuffID(90001664) then
      A=RefineLv/100+a
 
  end

 return A
end


----------------------------------------------------------------------------------坚定魔法斗篷[第四档]
function CommonFun.calcBuff_2860(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring=srcUser:GetEquipedID(3)
  local RefineLv=srcUser:GetEquipedRefineLv(3)
  local A =0

  if (Ring==43032 or Ring==143032)  then
    if RefineLv>=10 then 
      A=0.1
    end
  end

 return A
end

----------------------------------------------------------------------------------【速度激发】Lv.10
function CommonFun.calcBuff_2870(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
local skilllv_1 = srcUser:GetLernedSkillLevel(210)
local A =210005
if skilllv_1 == 10 then
  A =210010
end

 return A
end

----------------------------------------------------------------------------------【圣十字攻击】Lv.10
function CommonFun.calcBuff_2880(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
local skilllv_1 = srcUser:GetLernedSkillLevel(354)
local A =354005
if skilllv_1 == 10 then
  A =354010
end

 return A
end

----------------------------------------------------------------------------------【毒刃】Lv.10
function CommonFun.calcBuff_2890(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
local skilllv_1 = srcUser:GetLernedSkillLevel(174)
local A =174005
if skilllv_1 == 10 then
  A =174010
end

 return A
end
----------------------------------------------------------------------------------炎灵护卫 添加概率
function CommonFun.calcBuff_2900(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local MaxHp = srcUser:GetProperty("MaxHp")
  local Hp = srcUser:GetProperty("Hp")

  local A =100
  if Hp >= MaxHp*0.4 then 
      A = 0
  end

 return A
end
----------------------------------------------------------------------------------炎灵守卫
function CommonFun.calcBuff_2910(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local MaxHp = targetUser:GetProperty("MaxHp")
  local Hp = targetUser:GetProperty("Hp")

  local A = -(MaxHp*0.3+Hp*0.1)

  return A

end
----------------------------------------------------------------------------------独角兽
function CommonFun.calcBuff_2920(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local Num1 = srcUser:GetBuffLayer(31561)
  local A = 75

  if Num1 >=1 and Num1 <=3 then 
      A = 55
  elseif Num1 >3 and Num1 <=6 then 
      A = 35 
  elseif Num1 >6 then
      A = 15
  end

  return A

end
----------------------------------------------------------------------------------巅峰等级 天使之击
function CommonFun.calcBuff_2930(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  local skilllv_1 = srcUser:GetLernedSkillLevel(234)
  local Luk = targetUser:GetProperty("Luk")
  local A = 0

  if skilllv_1>10 then
    A = Luk/(23-skilllv_1)/100
  end
  
  return A

end
----------------------------------------------------------------------------------音乐 添加概率
function CommonFun.calcBuff_2940(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  
  local A = 0

  if targetUser:HasSubmitQuest(393310001) ==true then
    A = 100
  end
  
  return A

end
----------------------------------------------------------------------------------超生命通灵 添加概率
function CommonFun.calcBuff_2950(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  
  local A = 0
  local skilllv_1 = srcUser:GetLernedSkillLevel(427)
  if skilllv_1>5 then
    A = 100
  end
  
  return A

end
----------------------------------------------------------------------------------邪骨腕甲
function CommonFun.calcBuff_2960(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  
  local A =0
  if srcUser:HasBuffID(90001303) then 
        A =0.05
  end
  
  return A

end
----------------------------------------------------------------------------------神器 虚空
function CommonFun.calcBuff_2970(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  
  local A =100
  if srcUser:HasBuffID(107090) or srcUser:HasBuffID(107094) then 
        A =0
  end
  
  return A

end


----------------------------------------------------------------------------------年兽技能
function CommonFun.calcBuff_3000(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  
  local Skilllv = srcUser:GetLernedSkillLevel(103130)
  local QualityValue_a = 0
  local QualityValue_b = 0

  QualityValue_a = math.ceil(Skilllv/2)  --向上取整(技能等级为单数时增加)
  QualityValue_b = math.floor(Skilllv/2)  --向下取整(技能等级为双数时增加)
 
  if a == 1 then
  	return QualityValue_a
  elseif b == 1 then
  	return QualityValue_b
  else
  	return 0
  end
end
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【言语沉默时间】
function CommonFun.calcBuff_3010(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

	local Dex=srcUser:GetProperty("Dex")
	local Vit=targetUser:GetProperty("Vit")
	local Dex2=targetUser:GetProperty("Dex")
	local m = math.min(0.3,Dex*0.2/100)
	local n = math.min(1,(Vit*0.4+Dex2*0.4)/100)
	local Time = 1 + m - n 
	if Time <= 0 then
	   Time = 0
	end

  local A= (lv*a+b)*Time
  
  if A <= 0 then
    return 0
  end

  return A
end
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【新毒中毒概率】
function CommonFun.calcBuff_3020(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local PoisonAtk = srcUser:GetProperty("PoisonAtk")
  local PoisonDef2 = targetUser:GetProperty("PoisonDef")
  local PoisonDam  = (1 + PoisonAtk - PoisonDef2)
  if PoisonDam <=0 then
     PoisonDam  =0
  end  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk)*(1-StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  local skilllv_1 = srcUser:GetLernedSkillLevel(1101)-------剧毒武器
  local skilllv_2 = srcUser:GetLernedSkillLevel(1102)-------新毒研究

  local A= (5+skilllv_2)*PoisonDam*StateDam*CommonFun.calcAttrPoisonRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【新毒毒雾中毒概率】
function CommonFun.calcBuff_3021(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local PoisonAtk = srcUser:GetProperty("PoisonAtk")
  local PoisonDef2 = targetUser:GetProperty("PoisonDef")
  local PoisonDam  = (1 + PoisonAtk - PoisonDef2)
  if PoisonDam <=0 then
     PoisonDam  =0
  end  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk)*(1-StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  local skilllv_1 = srcUser:GetLernedSkillLevel(1103)-------毒雾
  local skilllv_2 = srcUser:GetLernedSkillLevel(1102)-------新毒研究

  skilllv_1 = math.min(skilllv_1,10)----毒雾巅峰不加概率

  local A= (10+skilllv_1*4+skilllv_2)*PoisonDam*StateDam*CommonFun.calcAttrPoisonRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【新毒持续时间】
function CommonFun.calcBuff_3030(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local PoisonAtk = srcUser:GetProperty("PoisonAtk")
  local PoisonDef2 = targetUser:GetProperty("PoisonDef")
  local PoisonDam  = (1 + PoisonAtk - PoisonDef2)
  if PoisonDam <=0 then
     PoisonDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk)*(1-StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  local skilllv_1 = srcUser:GetLernedSkillLevel(1101)-------剧毒武器
  local skilllv_2 = srcUser:GetLernedSkillLevel(1102)-------新毒研究
  local Num = srcUser:GetRunePoint(34060)

  local A= (10+skilllv_1+skilllv_2 +Num*2 )*PoisonDam*StateDam*CommonFun.calcAttrPoisonTime(srcUser, targetUser)

  if A <= 0 then
    return 0
  end
  return A
end

------------------------------------------------------------------------基因调节
function CommonFun.calcBuff_3040(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Vit=srcUser:GetProperty("Vit")
  local skilllv_1 = srcUser:GetLernedSkillLevel(1128)-------基因调节
  local Num = srcUser:GetRunePoint(134030)
    skillv_1=math.min(skilllv_1,10)
  local A= Vit*(skilllv_1*4 + Num*5)
  
  if A <= 0 then
    return 0
  end

  return A
end
--------------------------------------------------------------------------------嗜血渴望
function CommonFun.calcBuff_3050(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1140)-------嗜血渴望
   local MaxHp = targetUser:GetProperty("MaxHp")
   local Hp = targetUser:GetProperty("Hp")

   local A =-skilllv_1/100*(1+MaxHp/Hp*0.05)*MaxHp

   if targetUser.boss == true and targetUser.mini == true then
        A = 0
   end

   return A 

end
--------------------------------------------------------------------------------嗜血渴望 减速
function CommonFun.calcBuff_3051(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local Num = srcUser:GetRunePoint(94010)
   local MaxHp = targetUser:GetProperty("MaxHp")
   local Hp = targetUser:GetProperty("Hp")
   local A = 0

   if Num>0 then
      A =-(Num*0.1+MaxHp/Hp*0.05)
   end

   if targetUser.boss == true and targetUser.mini == true then
        A = 0
   end

   return A 

end
----------------------------------------------------------------------------------血腥骑士卡片
function CommonFun.calcBuff_3060(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local A = 5

  --拥有苍白领主卡片概率额外附加
  if srcUser:HasBuffID(52430)  then
    A = 8
  end
  
  return A
end
--------------------------------------------------------------------------------陷阱对MINI MVP无效
function CommonFun.calcBuff_3070(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   local A = lv*a+b

   if targetUser:HasBuffID(160000) then
        A = 0
   end
   
   if targetUser.boss == true or targetUser.mini == true then
        A = 0
   end

   return A 

end
--------------------------------------------------------------------------------圣音
function CommonFun.calcBuff_3080(srcUser, targetUser, a, b, c, d,lv)
     if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1185)-------圣音
   local Vit = srcUser:GetProperty("Vit")
   local Num = srcUser:GetRunePoint(74070)
   local BeHealEncPer2 = targetUser:GetProperty("BeHealEncPer")
   local HealEncPer = srcUser:GetProperty("HealEncPer")
   local A=0 
   if skilllv_1>0 and skilllv_1<=10 then
      A = skilllv_1*2*(100+Vit)*(1+HealEncPer)*(1+BeHealEncPer2)*(1+Num/10)
   elseif skilllv_1>10 then
      A = (20+skilllv_1)*(100+Vit)*(1+HealEncPer)*(1+BeHealEncPer2)*(1+Num/10)
   end
   return A 
   

end
--------------------------------------------------------------------------------威望
function CommonFun.calcBuff_3090(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1190)-------威望
   
   local A = skilllv_1*a

   return A 

end
--------------------------------------------------------------------------------虎炮 减少SP
function CommonFun.calcBuff_3100(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1202)-------虎炮
   local MaxSp = targetUser:GetProperty("MaxSp")
   local Num = srcUser:GetRunePoint(124010)
   local A =-(skilllv_1*3+Num*5)/100*MaxSp

   return A 

end
----------------------------------------------------------------------------------点穴-愈
function CommonFun.calcBuff_3110(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  local Vit = targetUser:GetProperty("Vit")
  local Int = srcUser:GetProperty("Int")
  local skilllv_1 = srcUser:GetLernedSkillLevel(1204)-------点穴
  local BeHealEncPer2 = targetUser:GetProperty("BeHealEncPer")
  local HealEncPer = srcUser:GetProperty("HealEncPer")
  ------------------------------------------------星盘
  local Num = srcUser:GetRunePoint(124070)

  local A = 0
  if (skilllv_1>0 and skilllv_1<=5) then
     A= 100*(5+skilllv_1)*(1+Vit/100)*(1+Int/100)*(1+BeHealEncPer2)*(1+HealEncPer)*(1+Num*0.08)
  elseif (skilllv_1>5 and skilllv_1<=10) then
     A= 100*(10+skilllv_1*0.5)*(1+Vit/100)*(1+Int/100)*(1+BeHealEncPer2)*(1+HealEncPer)*(1+Num*0.08)
  end
  return A

end
----------------------------------------------------------------------------------大地扭曲（卸除武器）
function CommonFun.calcBuff_3120(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   return 7
end
----------------------------------------------------------------------------------大地扭曲（卸除头饰）
function CommonFun.calcBuff_3121(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   return 8
end
----------------------------------------------------------------------------------混乱恐慌（卸除坐骑）
function CommonFun.calcBuff_3122(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   return 13
end
----------------------------------------------------------------------------------白色监狱
function CommonFun.calcBuff_3130(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1161)-------白色监狱
   local MaxHp = targetUser:GetProperty("MaxHp")

   local A = -MaxHp*(0.06+skilllv_1*0.02)

   return A
end
--------------------------------------------------------------------------------电击 减少SP
function CommonFun.calcBuff_3140(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1247)-------电击
   local MaxSp = targetUser:GetProperty("MaxSp")
  
   local A =-skilllv_1/100*MaxSp

   return A 

end
------------------------------------------------------------------------------卸除装备（怪物专用
function CommonFun.calcBuff_3150(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
       
      local off1 = targetUser:IsEquipForceOff(1)
      local off2 = targetUser:IsEquipForceOff(2)
      local off3 = targetUser:IsEquipForceOff(3)
      local off4 = targetUser:IsEquipForceOff(4)
      local off5 = targetUser:IsEquipForceOff(5)
      local off6 = targetUser:IsEquipForceOff(6)
      local off7 = targetUser:IsEquipForceOff(7)
      local off8 = targetUser:IsEquipForceOff(8)
      local equiped1 = targetUser:GetEquipedID(1) ~= 0
      local equiped2 = targetUser:GetEquipedID(2) ~= 0
      local equiped3 = targetUser:GetEquipedID(3) ~= 0
      local equiped4 = targetUser:GetEquipedID(4) ~= 0
      local equiped5 = targetUser:GetEquipedID(5) ~= 0
      local equiped6 = targetUser:GetEquipedID(6) ~= 0
      local equiped7 = targetUser:GetEquipedID(7) ~= 0
      local equiped8 = targetUser:GetEquipedID(8) ~= 0
      local list = {}
      if off1 == false and equiped1 == true then
         table.insert(list,1)
      end
      if off2 == false and equiped2 == true then
         table.insert(list,2)
      end
      if off3 == false and equiped3 == true then
         table.insert(list,3)
      end
      if off4 == false and equiped4 == true then
         table.insert(list,4)
      end
      if off5 == false and equiped5 == true then
         table.insert(list,5)
      end
      if off6 == false and equiped6 == true then
         table.insert(list,6)
      end
      if off7 == false and equiped7 == true then
         table.insert(list,7)
      end
      if off8 == false and equiped8 == true then
         table.insert(list,8)
      end
          

      if #list <= 0 then
        return 0
      end
      local random = srcUser:GetRandom()
      return list[(random % #list) + 1]
end
------------------------------------------------------------------------------卸除装备（怪物专用
function CommonFun.calcBuff_3151(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
       
      local off2 = targetUser:IsEquipForceOff(2)
      local off7 = targetUser:IsEquipForceOff(7)
      local equiped2 = targetUser:GetEquipedID(2) ~= 0
      local equiped7 = targetUser:GetEquipedID(7) ~= 0
      local list = {}
      if off2 == false and equiped2 == true then
         table.insert(list,2)
      end
      if off7 == false and equiped7 == true then
         table.insert(list,7)
      end

      if #list <= 0 then
        return 0
      end
      local random = srcUser:GetRandom()
      return list[(random % #list) + 1]
end
------------------------------------------------------------------------------卸除装备（怪物专用
function CommonFun.calcBuff_3152(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
       
      local off2 = targetUser:IsEquipForceOff(2)
      local off4 = targetUser:IsEquipForceOff(4)
      local equiped2 = targetUser:GetEquipedID(2) ~= 0
      local equiped4 = targetUser:GetEquipedID(4) ~= 0
      local list = {}
      if off2 == false and equiped2 == true then
         table.insert(list,2)
      end
      if off4 == false and equiped4 == true then
         table.insert(list,4)
      end

      if #list <= 0 then
        return 0
      end
      local random = srcUser:GetRandom()
      return list[(random % #list) + 1]
end
--------------------------------------------------------------------------------驯龙术 无视体型伤害
function CommonFun.calcBuff_3160(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1260)-------驯龙术
   local WeaponType =srcUser:GetEquipedWeaponType()
  
   local A =0

   if WeaponType==170 then
      A = skilllv_1*0.2
   end

   return A 

end
--------------------------------------------------------------------------------附魔之刃
function CommonFun.calcBuff_3170(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1263)-------附魔
   local MAtk = srcUser:GetProperty("MAtk")
   local MAtkPer = srcUser:GetProperty("MAtkPer")
   local Num = srcUser:GetRunePoint(14060)
   local A =MAtk*(1+MAtkPer)*skilllv_1*0.1*(1+Num/20)

   return A 

end
--------------------------------------------------------------------------------孤注一掷
function CommonFun.calcBuff_3180(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1264)-------孤注一掷
   local MDef2 = srcUser:GetProperty("MDef")
   local MDefPer2 = srcUser:GetProperty("MDefPer")
   skilllv_1 = math.min(skilllv_1,5)
   local A =MDef2*(1+MDefPer2)*skilllv_1*0.3 

   --print("skilllv_1="..skilllv_1,"MDef2="..MDef2,"A="..A)
   
   return A 

end
--------------------------------------------------------------------------------孤注一掷
function CommonFun.calcBuff_3181(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local MDef2 = srcUser:GetProperty("MDef")
   local MDefPer2 = srcUser:GetProperty("MDefPer")
   local Num = srcUser:GetRunePoint(14070)

   local A = -(MDef2*(1+MDefPer2)*(1-Num/10))

   --print("MDef2="..MDef2,"A="..A)
   
   return A 

end
--------------------------------------------------------------------------------符文石持续时间
function CommonFun.calcBuff_3190(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1269)-------符文精通
   local Num = srcUser:GetRunePoint(14050)
   local A =a*(1+skilllv_1/10+Num/20)

   return A 

end
--------------------------------------------------------------------------------圣灵降临
function CommonFun.calcBuff_3200(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local MaxHp = targetUser:GetProperty("MaxHp")
   local MaxSp = targetUser:GetProperty("MaxSp")
   local skilllv_1 = srcUser:GetLernedSkillLevel(1222)-------圣灵降临
   skilllv_1 = math.min(skilllv_1,5)

   local A =MaxHp*(skilllv_1*0.005+0.015)*a + MaxSp*(skilllv_1*0.005+0.015)*b

   return A 

end

--------------------------------------------------------------------------------狼突击 流血
function CommonFun.calcBuff_3210(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local MaxHp = targetUser:GetProperty("MaxHp")

   local skilllv_1 = srcUser:GetLernedSkillLevel(1242)-------狼牙

   local A =-MaxHp*(skilllv_1/10+1)*0.005

   return A 

end
--------------------------------------------------------------------------------磁场 对MINI MVP无效
function CommonFun.calcBuff_3220(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   --------------------------------------------------------------悬浮
   local AttrEffect= targetUser:GetProperty("AttrEffect2")
   local bits=CommonFun.getBits(AttrEffect)
   
   local A = 100

   if targetUser.boss == true or targetUser.mini == true or bits[CommonFun.AttrEffect2.Suspend]==1 then
        A = 0
   end

   return A 

end
--------------------------------------------------------------------------------白色监狱
function CommonFun.calcBuff_3221(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local Num = srcUser:GetRunePoint(24050)
   local MaxHp = targetUser:GetProperty("MaxHp")

   local A =-(Num*2/100*MaxHp)

   if targetUser.boss == true and targetUser.mini == true then
        A = 0
   end

   return A 

end
--------------------------------------------------------------------------------飞行椅子 减少SP
function CommonFun.calcBuff_3222(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   local Sp = targetUser:GetProperty("Sp")
  
   local A =-Sp

   return A 

end
--------------------------------------------------------------------------------贪得无厌
function CommonFun.calcBuff_3223(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local TargetAppleNum = srcUser:GetAppleNum()
  
   local A =0

   if TargetAppleNum>5 then
      A = math.max(-0.95,- 0.05*(TargetAppleNum-5))
   end 

   return A 

end
---------------------------------------------------------------------星盘 技能相关的计算

function CommonFun.calcBuff_3250(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
   local Num = srcUser:GetRunePoint(c)

   local A = lv*a + b + Num*d 
   --print("lv="..lv,"a="..a,"b="..b,"c="..c,"Num="..Num,"A="..A)

  return A
end

---------------------------------------------------------------------独奏 属性 技能相关的计算
function CommonFun.calcBuff_3251(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
   local Attr = srcUser:GetProperty(CommonFun.GetAttrName(c))

   local A = math.floor(Attr/a) + lv*b + d 
   --print("lv="..lv,"a="..a,"b="..b,"c="..c,"Num="..Num,"A="..A)

  return A
end
---------------------------------------------------------------------合奏 属性 技能相关的计算
function CommonFun.calcBuff_3252(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
   local Attr = srcUser:GetProperty(CommonFun.GetAttrName(c))

   local Ensemble = srcUser:GetEnsemblePartner()                  ----------获取伴奏者

   if Ensemble==nil then
      return 0
   end

   local Attr2 = Ensemble:GetProperty(CommonFun.GetAttrName(c))   ----------获取伴奏者属性

   local A = math.floor(Attr/a + Attr2/a) + lv*b + d 
   --print("lv="..lv,"a="..a,"b="..b,"c="..c,"Num="..Num,"A="..A)

  return A
end
---------------------------------------------------------------------合奏   星盘  属性 技能相关的计算
function CommonFun.calcBuff_3253(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
   local Num1 = srcUser:GetRunePoint(c)

   local Ensemble = srcUser:GetEnsemblePartner()                  ----------获取伴奏者
  
   if Ensemble==nil then
      return 0
   end

   local Num2 = Ensemble:GetRunePoint(c)                          ----------获取伴奏者 星盘点数

   local A = lv*a + b + (Num1+Num2)*d 
   --print("lv="..lv,"a="..a,"b="..b,"c="..c,"Num="..Num,"A="..A)

  return A
end
------------------------------------------------------------------------------布莱奇之诗
function CommonFun.calcBuff_3254(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end

   local Int = srcUser:GetProperty("Int")
   local Num = srcUser:GetRunePoint(102034)

   local A = Int/300 + lv*0.1 + Num*0.05
   --print("lv="..lv,"a="..a,"b="..b,"c="..c,"Num="..Num,"A="..A)

  return A
end

------------------------------------------------------------------装备升级精炼+5、+10、+15[衣服通用]
function CommonFun.calcBuff_3300(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = d
  local RefineLv=srcUser:GetEquipedRefineLv(2)

    if (RefineLv>=5 and RefineLv<10) then
        A = d + a 
    elseif (RefineLv>=10 and RefineLv<15) then
        A = d + a + b
    elseif RefineLv ==15 then
        A = d + a + b + c
    end
  
  return A
end


------------------------------------------------------------------装备升级精炼+5、+10、+15[武器通用]

function CommonFun.calcBuff_3301(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = d
  local RefineLv=srcUser:GetEquipedRefineLv(7)

    if (RefineLv>=5 and RefineLv<10) then
        A = d + a 
    elseif (RefineLv>=10 and RefineLv<15) then
        A = d + a + b
    elseif RefineLv ==15 then
        A = d + a + b + c
    end
  
  return A
end


------------------------------------------------------------------装备升级精炼+5、+10、+15[鞋子通用]

function CommonFun.calcBuff_3302(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = d
  local RefineLv=srcUser:GetEquipedRefineLv(4)

    if (RefineLv>=5 and RefineLv<10) then
        A = d + a 
    elseif (RefineLv>=10 and RefineLv<15) then
        A = d + a + b
    elseif RefineLv ==15 then
        A = d + a + b + c
    end
  
  return A
end

------------------------------------------------------------------装备升级精炼+5、+10、+15[副手通用]

function CommonFun.calcBuff_3303(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = d
  local RefineLv=srcUser:GetEquipedRefineLv(1)

    if (RefineLv>=5 and RefineLv<10) then
        A = d + a 
    elseif (RefineLv>=10 and RefineLv<15) then
        A = d + a + b
    elseif RefineLv ==15 then
        A = d + a + b + c
    end
  
  return A
end

------------------------------------------------------------------装备升级精炼+5、+10、+15[披风通用]

function CommonFun.calcBuff_3304(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = d
  local RefineLv=srcUser:GetEquipedRefineLv(3)

    if (RefineLv>=5 and RefineLv<10) then
        A = d + a 
    elseif (RefineLv>=10 and RefineLv<15) then
        A = d + a + b
    elseif RefineLv ==15 then
        A = d + a + b + c
    end
  
  return A
end
----------------------------------------------------------------------------------衬衫[第七档]
function CommonFun.calcBuff_3310(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Flee = srcUser:GetProperty("Flee")
  local A =  math.floor(Flee/10*1)
  if A <= 0 then
    return 0
  end

 return A
end

---------------------------------------------------------------精炼+b以上，每精炼+1,属性+a，c固定值[3号位通用]
function CommonFun.calcBuff_3320(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(3)
  local A =c

  if RefineLv > b then 
      A=(RefineLv-b)* a + A
  end

 return A
end

---------------------------------------------------------------精炼+b以上，每精炼+1,属性+a，c固定值[1号位通用]
function CommonFun.calcBuff_3321(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(1)
  local A =c

  if RefineLv > b then 
      A=(RefineLv-b)* a + A
  end

 return A
end

---------------------------------------------------------------精炼+b以上，每精炼+1,属性+a，c固定值[7号位通用]
function CommonFun.calcBuff_3322(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =c

  if RefineLv > b then 
      A=(RefineLv-b)* a + A
  end

 return A
end

---------------------------------------------------------------精炼+b以上，每精炼+1,属性+a，c固定值[2号位通用]
function CommonFun.calcBuff_3323(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(2)
  local A =c

  if RefineLv > b then 
      A=(RefineLv-b)* a + A
  end

 return A
end

---------------------------------------------------------------精炼+b以上，每精炼+1,属性+a，c固定值[4号位通用]
function CommonFun.calcBuff_3324(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(4)
  local A =c

  if RefineLv > b then 
      A=(RefineLv-b)* a + A
  end

 return A
end

---------------------------------------------------------------迪斯凯特的软甲(6档)
function CommonFun.calcBuff_3325(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(2)
  local A =c

  if (RefineLv > b and srcUser:HasBuffID(90002255) )then 
      A=(RefineLv-b)* a + A
  end

 return A
end



---------------------------------------------------------------高等布袋熊长靴[第四档]
function CommonFun.calcBuff_3330(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(4)
  local Agi = srcUser:GetProperty("Agi")
  local A =0
  if RefineLv >= 12 then 
    if Agi >= 150 then 
      A=0.05
    end
  end

 return A
end

---------------------------------------------------------------高等布袋熊长靴[第四档]
function CommonFun.calcBuff_3340(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(4)
  local Str = srcUser:GetProperty("Str")
  local Dex = srcUser:GetProperty("Dex")
  local A =0
  if RefineLv >= 0 then 
    if (Str >= 225 or Dex >= 225) then 
      A=0.03
    end
  end

 return A
end


----------------------------------------------------------------------------------强运项链
function CommonFun.calcBuff_3350(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring1=srcUser:GetEquipedID(5)
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local Ring2=srcUser:GetEquipedID(6)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)

  local a = 0
  local b = 0

  if (Ring1==44032 or Ring1==144032) and RefineLv1>=12 then
      a = 0.04
  end
  if (Ring2==44032 or Ring2==144032) and RefineLv2>=12 then
      b = 0.04
  end

 local A = a + b  

 return A
end

----------------------------------------------------------------------------------强力戒指
function CommonFun.calcBuff_3360(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring1=srcUser:GetEquipedID(5)
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local Ring2=srcUser:GetEquipedID(6)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)

  local a = 0
  local b = 0

  if (Ring1==44029 or Ring1==144029) and RefineLv1>=12 then
      a = 0.03
  end
  if (Ring2==44029 or Ring2==144029) and RefineLv2>=12 then
      b = 0.03
  end

 local A = a + b  

 return A
end

----------------------------------------------------------------------------------强体项链
function CommonFun.calcBuff_3370(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring1=srcUser:GetEquipedID(5)
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local Ring2=srcUser:GetEquipedID(6)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)

  local a = 0
  local b = 0

  if (Ring1==44031 or Ring1==144031) and RefineLv1>=12 then
      a = 0.03
  end
  if (Ring2==44031 or Ring2==144031) and RefineLv2>=12 then
      b = 0.03

  end

 local A = a + b  

 return A
end

----------------------------------------------------------------------------------强敏别针
function CommonFun.calcBuff_3380(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring1=srcUser:GetEquipedID(5)
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local Ring2=srcUser:GetEquipedID(6)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)

  local a = 0
  local b = 0

  if (Ring1==44030 or Ring1==144030) and RefineLv1>=12 then
      a = 0.06
  end
  if (Ring2==44030 or Ring2==144030) and RefineLv2>=12 then
      b = 0.06
  end

 local A = a + b  

 return A
end

----------------------------------------------------------------------------------犬牙手套
function CommonFun.calcBuff_3390(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring1=srcUser:GetEquipedID(5)
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local Ring2=srcUser:GetEquipedID(6)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)

  local a = 0
  local b = 0

  if (Ring1==44010 or Ring1==144010) and RefineLv1>=12 then
      a = 0.04
  end
  if (Ring2==44010 or Ring2==144010) and RefineLv2>=12 then
      b = 0.04
  end

 local A = a + b  

 return A
end

----------------------------------------------------------------------------------永恒戒指1
function CommonFun.calcBuff_3400(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring1=srcUser:GetEquipedID(5)
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local Ring2=srcUser:GetEquipedID(6)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)

  local a = 0
  local b = 0

  if (Ring1==44008 or Ring1==144008) and RefineLv1>=12 then
      a = 0.05
        end
  if (Ring2==44008 or Ring2==144008) and RefineLv2>=12 then
      b = 0.05
  end

 local A = a + b  

 return A
end

----------------------------------------------------------------------------------永恒戒指2
function CommonFun.calcBuff_3401(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring1=srcUser:GetEquipedID(5)
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local Ring2=srcUser:GetEquipedID(6)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)

  local a = 0
  local b = 0

  if (Ring1==44008 or Ring1==144008) and RefineLv1>=12 then
      a = -0.05
  end
  if (Ring2==44008 or Ring2==144008) and RefineLv2>=12 then
      b = -0.05
  end

 local A = a + b  

 return A
end

----------------------------------------------------------------------------------大巫师之杖[第八档]
function CommonFun.calcBuff_3410(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0
  if RefineLv >= 12 then 
          A=0.03
  end

 return A
end

----------------------------------------------------------------------------------水晶靴[第四档]
function CommonFun.calcBuff_3420(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(4)
  local A =0
  if RefineLv >= 12 then 
          A=0.02
  end

 return A
end

----------------------------------------------------------------------------------红十字杖[1][第八档]
function CommonFun.calcBuff_3430(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0
  if RefineLv >= 13 then 
          A=0.05
  end

 return A
end

----------------------------------------------------------------------------------红十字杖[1][第八档]
function CommonFun.calcBuff_3440(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0.05
  if RefineLv >= 13 then 
        A=0.1 + A
  end

 return A
end

----------------------------------------------------------------------------------生机之杖
function CommonFun.calcBuff_3441(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0
  if RefineLv >= 13 then 
          A=0.1
  end

 return A
end

----------------------------------------------------------------------------------神秘之弓[1][第八档]
function CommonFun.calcBuff_3450(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local Dex=targetUser:GetProperty("Dex")
  local A =53
  if RefineLv == 15 then 
      A =  math.floor(Dex/10)*4 + A
  end
  if A <= 0 then
    return 0
  end

 return A
end
----------------------------------------------------------------------------------神秘之弓[1][第八档]

function CommonFun.calcBuff_3451(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = d
  local RefineLv=srcUser:GetEquipedRefineLv(7)

    if (RefineLv>=5 and RefineLv<10) then
        A = d + a 
    elseif (RefineLv>=10 and RefineLv<15) then
        A = d + a + b
    elseif RefineLv ==15 then
        A = d + a + b + c
    end
  local Dex = srcUser:GetProperty("Dex")
    if Dex >= 240 then 
      A= 0.02 + A
    end
  
  return A
end

----------------------------------------------------------------------------------追风者之弓
function CommonFun.calcBuff_3452(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local Dex=targetUser:GetProperty("Dex")
  local A =0
  if RefineLv == 15 then 
      A =  math.floor(Dex/10)*4 + A
  end
  if A <= 0 then
    return 0
  end

 return A
end


---------------------------------------------------------------鲜血斧[第四档]
function CommonFun.calcBuff_3460(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local Str = srcUser:GetProperty("Str")
  local Dex = srcUser:GetProperty("Dex")
  local Luk = srcUser:GetProperty("Luk")
  local A =70
  if RefineLv >= 12 then 
     A = A + math.floor(Str/10)*2+math.floor(Dex/10)*2+math.floor(Luk/10)*2
  end

 return A
end
---------------------------------------------------------------鲜血斧[第四档]
function CommonFun.calcBuff_3461(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local Str = srcUser:GetProperty("Str")
  local Dex = srcUser:GetProperty("Dex")
  local Luk = srcUser:GetProperty("Luk")
  local A =70
  if RefineLv >= 10 then 
     A = A + math.floor(Str/10)*2+math.floor(Dex/10)*2+math.floor(Luk/10)*2
  end

 return A
end



------------------------------------------------------------------神圣大驹短剑[第八档]

function CommonFun.calcBuff_3470(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 3
  local RefineLv=srcUser:GetEquipedRefineLv(7)

    if (srcUser:HasBuffID(90000617) and RefineLv>=10) then
        A = 3 + 2
      end
  
  return A
end

------------------------------------------------------------------神圣大驹短剑[第八档]

function CommonFun.calcBuff_3471(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 3
  local RefineLv=srcUser:GetEquipedRefineLv(7)

    if (srcUser:HasBuffID(41890) and RefineLv>=10) then
        A = 3 + 2
    end
  
  return A
end


--------------------------------------------------------------------神圣大驹短剑[第八档]
function CommonFun.calcBuff_3480(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local Str=targetUser:GetProperty("Str")
  local A =0
  if RefineLv == 15 then 
      A =  math.floor(Str/10)*4
  end
  if A <= 0 then
    return 0
  end

 return A
end

--------------------------------------------------------------------神圣大驹短剑[第八档]
function CommonFun.calcBuff_3481(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Str = srcUser:GetProperty("Str")
    if Str >= 240 then 
      A= 0.03
    end

  return A
end


------------------------------------------------------------------皇家战甲

function CommonFun.calcBuff_3500(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 0
  local Ring1=srcUser:GetEquipedID(2)
  if ( Ring1==42077 or Ring1==142077)   then
      A = 100
  end
  
  return A
end


------------------------------------------------------------------驯龙者长枪【新】

function CommonFun.calcBuff_3490(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 0
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local Ring1=srcUser:GetEquipedID(7)
  if (( Ring1==40047 or Ring1==140047)  and RefineLv>=10 ) then
      A = 100
  end
  
  return A
end
------------------------------------------------------------------审判之锤

function CommonFun.calcBuff_3492(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 0
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local Ring1=srcUser:GetEquipedID(7)
  if (( Ring1==41526 or Ring1==141526)  and RefineLv>=10 and  srcUser:HasBuffID(90002041)  ) then
      A = 15
  end

  if (( Ring1==41565 or Ring1==141565)  and RefineLv>=10 ) then
      A = 15
  end 
  
  return A
end



------------------------------------------------------------------巨龙咆哮

function CommonFun.calcBuff_3491(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 0
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local Ring1=srcUser:GetEquipedID(7)
  if (( Ring1==40057 or Ring1==140057)  and RefineLv>=10 ) then
      A = 100
  end
  
  return A
end

------------------------------------------------------------------领袖之风卡片【穿戴】

function CommonFun.calcBuff_3510(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 0
  if  srcUser:HasBuffID(52640)    then
      A = 0.08
  end
  
  return A
end

------------------------------------------------------------------领袖之风卡片【存储】

function CommonFun.calcBuff_3511(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 0
  if ( srcUser:HasBuffID(81000500)  and   srcUser:HasBuffID(52640) ) then
      A = 0.02
  end
  
  return A
end
------------------------------------------------------------------念力增幅卡片【穿戴】

function CommonFun.calcBuff_3520(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 0
  if  srcUser:HasBuffID(52650)    then
      A = 100
  end
  
  return A
end

-----------------------------------------------------------------------------------------------太阳头饰伤害公式
function CommonFun.calcBuff_3530(srcUser, targetUser, a, b, c, d,lv)
  local MaxHp = srcUser:GetProperty("MaxHp")
   local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图

  if srcUser == nil or targetUser == nil then
      return 0
  end
  
  ----------------------------------------------------------竞技场最大生命除以4
  if maptype==2 or maptype==4 then
     MaxHp = MaxHp*0.25
  end

  local A = MaxHp*a
  -----------------------------------------------装备大嘴鸟卡片且存储伤害增加

    ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = -1
    end
    --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = -1
    end
  return A

end
-----------------------------------------------------------------------------------------------魔力陷阱伤害公式
function CommonFun.calcBuff_3540(srcUser, targetUser, a, b, c, d,lv)

local Str = srcUser:GetProperty("Str")
  local Dex = srcUser:GetProperty("Dex")
  local Luk = srcUser:GetProperty("Luk")
  local Atk = srcUser:GetProperty("Atk")
  local AtkPer = srcUser:GetProperty("AtkPer")
  local DamIncrease = srcUser:GetProperty("DamIncrease")
  local IgnoreDef  = 0
  local IgnoreDef1 = srcUser:GetProperty("IgnoreDef")
  local IgnoreDef2 = srcUser:GetProperty("IgnoreEquipDef")
  if targetUser.boss or targetUser.mini then
     IgnoreDef=IgnoreDef1
  else
     IgnoreDef=(IgnoreDef1+IgnoreDef2)  
  end
  
  if IgnoreDef >= 1 then
     IgnoreDef  = 1
  end 

  local Refine = srcUser:GetProperty("Refine")

  local Def2 = targetUser:GetProperty("Def")
  local DefPer2 = targetUser:GetProperty("DefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local VitPer2 = targetUser:GetProperty("VitPer")  
  local DamReduc2 = CommonFun.calcDamReDuc(srcUser, targetUser)
  local RefineDamReduc = targetUser:GetProperty("RefineDamReduc")
  local Hp2 = targetUser:GetProperty("Hp")
  local MaxHp2 = targetUser:GetProperty("MaxHp")
  ------------------------------------------------------------------技能
  lv = math.min(lv,10) -----巅峰
  local damChangePer = 0.3*lv+3
  local damChangePer1 = 4*lv

  local AttrEffect= srcUser:GetProperty("AttrEffect")
  local bits=CommonFun.getBits(AttrEffect)
  ----------------------------------------------------------------------------种族伤害
    local raceparam = 1

    local srcRace = srcUser.race
    local targetRace = targetUser.race

    if nil == CommonFun.RaceProps[targetRace] then
        raceparam = 1
    end
    if nil == CommonFun.RaceProps[srcRace] then
        raceparam = 1
    end
    local raceInc = srcUser:GetProperty(CommonFun.RaceProps[targetRace][1])
    local raceRed = targetUser:GetProperty(CommonFun.RaceProps[srcRace][2])

    local raceparam =  (1+raceInc-raceRed)

    ------------------------------------------------------------------------竞技场额外增加30%种族减免
    local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图

    if maptype==2 or maptype==4 then
      local B = raceRed - raceInc  ---------------种族伤害减免
      B = B < -1 and -1 or B > 1 and 1 or B
      B = math.floor(B*1000)/1000
      B = B + 0.3*(1-math.sin(B*3.14/2))
      --print("B2="..B)
      raceparam = 1 - B 
    end

    if raceparam <= 0.1 then
       raceparam  = 0.1
    end
----------------------------------------------------------------------------------属性伤害
  local srcAtkElement = 5
  local targetDefElement = targetUser:GetProperty("DefAttr")
  local ElementRate = GameConfig.ElementRestrain[srcAtkElement][targetDefElement]
    
    if nil == CommonFun.NatureProps[srcAtkElement] or nil == CommonFun.NatureProps[targetDefElement] or nil == targetDefElement then
       return 0
    end

  local elementInc = srcUser:GetProperty(CommonFun.NatureProps[targetDefElement][1])
  local elementRed = targetUser:GetProperty(CommonFun.NatureProps[srcAtkElement][2])
  local elementAtk = srcUser:GetProperty(CommonFun.NatureProps[srcAtkElement][3])

  local elementparam = (1+elementInc)*ElementRate

  local elementparam2 = 1+elementAtk-elementRed

    ------------------------------------------------------------------------竞技场额外增加30%元素减免
    local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图
    ------------------------maptype 1 :野外 2：pvp 3:其他普通副本 4:gvg 
    if maptype==2 or maptype==4 then
      local B = elementRed - elementAtk  ---------------元素伤害减免
      B = B < -1 and -1 or B > 1 and 1 or B
      B = math.floor(B*1000)/1000
      B = B + 0.3*(1-math.sin(B*3.14/2))
      --print("B2="..B)
      elementparam2 = 1 - B 
    end


    if elementparam2 <= 0.1 then
        elementparam2 = 0.1
    end

  local ele = elementparam*elementparam2
  --print("elementInc="..elementInc,"ElementRate="..ElementRate,"elementparam="..elementparam,"elementparam2="..elementparam2,"ele="..ele)
  if targetDefElement==nil or ElementRate==nil or elementInc==nil or elementRed==nil or elementAtk==nil then
      ele =1
  end

  local BaseAtk  = Str*2 + math.floor(Str*Str/100) + math.floor(Dex/5) + math.floor(Luk/5)
  local AtkFinal = ((Atk-BaseAtk)*(1+AtkPer)*CommonFun.ShapeCorrection(srcUser,targetUser)*ele+BaseAtk)*raceparam

  ----------------------------物理防御减免
  local DefReduc= CommonFun.CalcDef(Def,Vit,srcUser,targetUser)
  local Int2 = targetUser:GetProperty("Int")
  ---------------------------------星盘 
  local Numxp= srcUser:GetRunePoint(94050)------------星盘点
  local RuneDamage = 1 + Numxp*0.1

  local A = -(((AtkFinal+Int2*damChangePer1)*DefReduc*(1-DamReduc2)+Refine)*damChangePer*(1-RefineDamReduc)*(1+DamIncrease)-Vit2*(1+VitPer2))*RuneDamage
-------------------------------------------------------------华丽短剑
      if bits[CommonFun.AttrEffect.Hualiduanjian]==1 then
           return A*1.5
      end
------------------------------------------------------------------------特殊处理
    local AttrFunction = srcUser:GetProperty("AttrFunction")
    local bitfunc = CommonFun.getBits(AttrFunction)

    if (targetUser.boss or targetUser.mini or targetUser.changelinepunish) and targetUser.zoneType == 1 then
      if bitfunc[CommonFun.AttrFunction.JustInViceZone] == 1 then
        A = 0
      end
    end

   ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = -1
    end
    --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = -1
    end

   return A
end
-----------------------------------------------------------------------------------------------毒雾伤害公式
function CommonFun.calcBuff_3541(srcUser, targetUser, a, b, c, d,lv)

local Str = srcUser:GetProperty("Str")
  local Dex = srcUser:GetProperty("Dex")
  local Luk = srcUser:GetProperty("Luk")
  local Atk = srcUser:GetProperty("Atk")
  local AtkPer = srcUser:GetProperty("AtkPer")
  local DamIncrease = srcUser:GetProperty("DamIncrease")
  local IgnoreDef  = 0
  local IgnoreDef1 = srcUser:GetProperty("IgnoreDef")
  local IgnoreDef2 = srcUser:GetProperty("IgnoreEquipDef")
  if targetUser.boss or targetUser.mini then
     IgnoreDef=IgnoreDef1
  else
     IgnoreDef=(IgnoreDef1+IgnoreDef2)  
  end
  
  if IgnoreDef >= 1 then
     IgnoreDef  = 1
  end 

  local Refine = srcUser:GetProperty("Refine")

  local Def2 = targetUser:GetProperty("Def")
  local DefPer2 = targetUser:GetProperty("DefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local VitPer2 = targetUser:GetProperty("VitPer")  
  local DamReduc2 = CommonFun.calcDamReDuc(srcUser, targetUser)
  local RefineDamReduc = targetUser:GetProperty("RefineDamReduc")
  local Hp2 = targetUser:GetProperty("Hp")
  local MaxHp2 = targetUser:GetProperty("MaxHp")
  ------------------------------------------------------------------技能
  local damChangePer = 0.3*lv+1.3

  local AttrEffect= srcUser:GetProperty("AttrEffect")
  local bits=CommonFun.getBits(AttrEffect)
    ----------------------------------------------------------------------------种族伤害
    local raceparam = 1

    local srcRace = srcUser.race
    local targetRace = targetUser.race

    if nil == CommonFun.RaceProps[targetRace] then
        raceparam = 1
    end
    if nil == CommonFun.RaceProps[srcRace] then
        raceparam = 1
    end
    local raceInc = srcUser:GetProperty(CommonFun.RaceProps[targetRace][1])
    local raceRed = targetUser:GetProperty(CommonFun.RaceProps[srcRace][2])

    local raceparam =  (1+raceInc-raceRed)
    ------------------------------------------------------------------------竞技场额外增加30%种族减免
    local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图

    if maptype==2 or maptype==4 then
      local B = raceRed - raceInc  ---------------种族伤害减免
      B = B < -1 and -1 or B > 1 and 1 or B
      B = math.floor(B*1000)/1000
      B = B + 0.3*(1-math.sin(B*3.14/2))
      --print("B2="..B)
      raceparam = 1 - B 
    end

    if raceparam <= 0.1 then
       raceparam  = 0.1
    end
  ----------------------------------------------------------------------------------属性伤害
  local srcAtkElement = 10
  local targetDefElement = targetUser:GetProperty("DefAttr")
  local ElementRate = GameConfig.ElementRestrain[srcAtkElement][targetDefElement]
  -----------------------------------------------------------------------------------------星盘加成的毒属性对其他属性克制系数
  local NumXp1 = srcUser:GetRunePoint(31019)
  local NumXp2 = srcUser:GetRunePoint(31020)
  local RuneRate = (NumXp1 + NumXp2)*0.1

  ElementRate = ElementRate + RuneRate

  if nil == CommonFun.NatureProps[srcAtkElement] or nil == CommonFun.NatureProps[targetDefElement] or nil == targetDefElement then
       return 0
  end

  local elementInc = srcUser:GetProperty(CommonFun.NatureProps[targetDefElement][1])
  local elementRed = targetUser:GetProperty(CommonFun.NatureProps[srcAtkElement][2])
  local elementAtk = srcUser:GetProperty(CommonFun.NatureProps[srcAtkElement][3])

  local elementparam = (1+elementInc)*ElementRate

  local elementparam2 = 1+elementAtk-elementRed

    ------------------------------------------------------------------------竞技场额外增加30%元素减免
    local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图
    ------------------------maptype 1 :野外 2：pvp 3:其他普通副本 4:gvg 
    if maptype==2 or maptype==4 then
      local B = elementRed - elementAtk  ---------------元素伤害减免
      B = B < -1 and -1 or B > 1 and 1 or B
      B = math.floor(B*1000)/1000
      B = B + 0.3*(1-math.sin(B*3.14/2))
      --print("B2="..B)
      elementparam2 = 1 - B 
    end


    if elementparam2 <= 0.1 then
        elementparam2 = 0.1
    end

  local ele = elementparam*elementparam2
  --print("elementInc="..elementInc,"ElementRate="..ElementRate,"elementparam="..elementparam,"elementparam2="..elementparam2,"ele="..ele)
  if targetDefElement==nil or ElementRate==nil or elementInc==nil or elementRed==nil or elementAtk==nil then
      ele =1
  end

  local BaseAtk  = Str*2 + math.floor(Str*Str/100) + math.floor(Dex/5) + math.floor(Luk/5)
  local AtkFinal = ((Atk-BaseAtk)*(1+AtkPer)*CommonFun.ShapeCorrection(srcUser,targetUser)*ele+BaseAtk)*raceparam

  ----------------------------物理防御减免
  local DefReduc= CommonFun.CalcDef(Def,Vit,srcUser,targetUser)

  local A = -((AtkFinal*DefReduc*(1-DamReduc2)+Refine)*damChangePer*(1-RefineDamReduc)*(1+DamIncrease)-Vit2*(1+VitPer2))
-------------------------------------------------------------华丽短剑
      if bits[CommonFun.AttrEffect.Hualiduanjian]==1 then
           return A*1.5
      end
------------------------------------------------------------------------特殊处理
    local AttrFunction = srcUser:GetProperty("AttrFunction")
    local bitfunc = CommonFun.getBits(AttrFunction)

    if (targetUser.boss or targetUser.mini or targetUser.changelinepunish) and targetUser.zoneType == 1 then
      if bitfunc[CommonFun.AttrFunction.JustInViceZone] == 1 then
        A = 0
      end
    end
    
   ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = -1
    end
    --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = -1
    end

   return A
end

---------------------------------------------------------------胜利飞燕
function CommonFun.calcBuff_3550(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Str = srcUser:GetProperty("Str")
  local Dex = srcUser:GetProperty("Dex")
  local A = a
  if (Str >= 200 or Dex >= 200) then 
      A= a + b
  end

 return A
end

---------------------------------------------------------------闹哄哄的塔奥群卡
function CommonFun.calcBuff_3560(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Int = srcUser:GetProperty("Int")
  local A = a
  if (Int >= 200 ) then 
      A= a + b
  end

 return A
end

---------------------------------------------------------------背包精炼
function CommonFun.calcBuff_3570(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(11)
  local A = a
  if RefineLv >= c then 
     A= a + b
  end

 return A
end

---------------------------------------------------------------背包精炼
function CommonFun.calcBuff_3580(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(11)
  local A = a
  if RefineLv >= c then 
     A= a + b * (RefineLv-c)
  end

 return A
end

---------------------------------------------------------------白蚁★卡片
function CommonFun.calcBuff_3590(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Str = srcUser:GetProperty("Str")
  local Dex = srcUser:GetProperty("Dex")
  local A = a
  if (Str >= 225 or Dex >= 225) then 
      A= a + b
  end

 return A
end
------------------------------------------------------------------------【需要增加素质抵抗的计算公式】--【麻痹电流概率】
function CommonFun.calcBuff_3600(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local skilllv_1 = srcUser:GetLernedSkillLevel(103180)
  local SlowAtk = srcUser:GetProperty("SlowAtk")
  local SlowDef2 = targetUser:GetProperty("SlowDef")
  local SlowDam  = (1 + SlowAtk - SlowDef2)
  if SlowDam <=0 then
     SlowDam  =0
  end  
  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk)*(1-StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 

  local A= (skilllv_1*a+b)*SlowDam*StateDam*CommonFun.calcAttrSlowRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
------------------------------------------------------------------------生命吸收 提高生命上限
function CommonFun.calcBuff_3610(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local target_Hp=targetUser:GetProperty("Hp")
  local skilllv_1 = srcUser:GetLernedSkillLevel(1168)
  
  local A = -(math.min(target_Hp*(skilllv_1-5)*0.03,(skilllv_1-5)*10000))

  if (targetUser.boss or targetUser.mini) then----------------------对MVP　mini 无效
     A = 0
  end 

 return A
end
----------------------------庇护
function CommonFun.calcBuff_3620(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local skilllv_1 = srcUser:GetLernedSkillLevel(103680)-------庇护
  local A= skilllv_1*a+b
  
  if A <= 0 then
    return 0
  end

  return A
end
----------------------------冰焰
function CommonFun.calcBuff_3630(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local FreezeAtk  = srcUser:GetProperty("FreezeAtk")
  local FreezeDef2 = targetUser:GetProperty("FreezeDef")
  local FreezeDam  = (1 + FreezeAtk - FreezeDef2)
  if FreezeDam <=0 then
     FreezeDam  =0
  end   

  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk)*(1-StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  local skilllv_1 = srcUser:GetLernedSkillLevel(103700)-------冰焰
  local A= (skilllv_1*a+b)*FreezeDam*StateDam*CommonFun.calcAttrFreezeRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end

  return A
end


  ----------------------------黑焰
function CommonFun.calcBuff_3640(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local BlindAtk = srcUser:GetProperty("BlindAtk")
  local BlindDef2 = targetUser:GetProperty("BlindDef")
  local BlindDam  = (1 + BlindAtk - BlindDef2)
  if BlindDam <=0 then
     BlindDam  =0
  end  
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1+StateAtk)*(1-StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  
  local skilllv_1 = srcUser:GetLernedSkillLevel(103710)-------黑焰
  local A= (skilllv_1*a+b)*BlindDam*StateDam*CommonFun.calcAttrBurnRate(srcUser, targetUser)
  
  if A <= 0 then
    return 0
  end
  return A
end
----------------------------基因调节按智力提升魔攻
function CommonFun.calcBuff_3650(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Int=srcUser:GetProperty("Int")
  local skilllv_1 = srcUser:GetLernedSkillLevel(1128)-------基因调节
 local A= math.floor(Int*(skilllv_1-10)*0.2)
  
  if A <= 0 then
    return 0
  end

  return A
end
----------------------------守护之盾提升物攻
function CommonFun.calcBuff_3660(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Def=srcUser:GetProperty("Def")
  local DefPer=srcUser:GetProperty("DefPer")
  local skilllv_1 = srcUser:GetLernedSkillLevel(1181)-------守护之盾
  local A= math.floor(Def*(1+DefPer)*(skilllv_1-10)*0.2/12)
  
  if A <= 0 then
    return 0
  end

  return A
end
----------------------------守护之盾提升魔攻
function CommonFun.calcBuff_3670(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local MDef=srcUser:GetProperty("MDef")
  local MDefPer=srcUser:GetProperty("MDefPer")
  local skilllv_1 = srcUser:GetLernedSkillLevel(1181)-------守护之盾
  local A= math.floor(MDef*(1+MDefPer)*(skilllv_1-10)*0.2/6)
  
  if A <= 0 then
    return 0
  end

  return A
end
----------------------------自然守护提升魔法防御
function CommonFun.calcBuff_3680(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Int=srcUser:GetProperty("Int")
  local skilllv_1 = srcUser:GetLernedSkillLevel(1250)-------自然守护
  local A= math.floor(Int/(10*(11-skilllv_1)))/100
  
  if A <= 0 then
    return 0
  end

  return A
end
--------------------------------------------------------------------------------贤者 HP转换  损失HP
function CommonFun.calcBuff_3690(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1317)-------Hp转换
   local Num = srcUser:GetRunePoint(83040)
   local MaxHp = srcUser:GetProperty("MaxHp")
   local MaxHpPer = srcUser:GetProperty("MaxHpPer")

   local A = -MaxHp*(1+MaxHpPer)*(skilllv_1*0.01-Num*0.01)

   if A > 0 then 
       A = 0
   end

   return A 

end
--------------------------------------------------------------------------------贤者 HP转换  SP获得
function CommonFun.calcBuff_3691(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1317)-------Hp转换
   local MaxHp = srcUser:GetProperty("MaxHp")
   local MaxHpPer = srcUser:GetProperty("MaxHpPer")

   local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图

  ----------------------------------------------------------竞技场最大生命除以4
   if maptype==2 or maptype==4 then
     MaxHp = MaxHp*0.25
   end

   local Num_hp = srcUser:GetRunePoint(82018)

   local A = MaxHp*(1+MaxHpPer)*skilllv_1*0.01*(1+Num_hp*0.1)

   return A 

end
---------------------------------------------------------------蝴蝶结·琉璃
function CommonFun.calcBuff_3700(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end

  local MDamReduc = srcUser:GetProperty("MDamReduc")
  local A = math.floor(MDamReduc*100*75)

  if A <= 0 then
    return 0
  end     

 return A
end

--------------------------------------------------------------------------------暖风
function CommonFun.calcBuff_3710(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1325)-------暖风
   local MaxHp = targetUser:GetProperty("MaxHp")
   local MaxHpPer = targetUser:GetProperty("MaxHpPer")
   local skilllv_2 = srcUser:GetLernedSkillLevel(1333)-------召唤元素

   local BeHealEncPer2 = targetUser:GetProperty("BeHealEncPer")
   local HealEncPer = srcUser:GetProperty("HealEncPer")
   ------------------------火元素在场
   local Element = 0
   local ElementNpc = srcUser:getCurElementElfID()

   if ElementNpc==580010 then
        Element = 0.001*skilllv_2
   end

   local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图
   
  ----------------------------------------------------------竞技场最大生命除以4
   if maptype==2 or maptype==4 then
     MaxHp = MaxHp*0.25
   end

   local A = MaxHp*(1+MaxHpPer)*(skilllv_1*0.004 + 0.008 + Element)*(1+BeHealEncPer2)*(1+HealEncPer)

   return A 

end
--------------------------------------------------------------------------------元素生物buff持续时间
function CommonFun.calcBuff_3720(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1334)-------元素交流

   local skilllv_2 = srcUser:GetLernedSkillLevel(1333)-------召唤元素

   local A = 50 + 10*skilllv_1 + 10*skilllv_2

   return A 

end

------------------------------------------------------------------狼外婆卡片【存储】

function CommonFun.calcBuff_3730(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local A = 0
  if (srcUser:HasBuffID(52880) ) then
      A = 0.05
  end
  
  return A
end
------------------------------------------------------------------噩梦（减少6围）
function CommonFun.calcBuff_3740(srcUser, targetUser, a, b, c, d,lv)
 if srcUser == nil or targetUser == nil then
      return 0
  end

  local Int=srcUser:GetProperty("Int")
  local A= -math.floor(Int/2)
  
  return A
end
------------------------------------------------------------------噩梦（减少6围）

function CommonFun.calcBuff_3741(srcUser, targetUser, a, b, c, d,lv)
 if srcUser == nil or targetUser == nil then
      return 0
  end


  local Str=srcUser:GetProperty("Str")
  local A= -math.floor(Str/2)
  
  return A
end------------------------------------------------------------------噩梦（减少6围）

function CommonFun.calcBuff_3742(srcUser, targetUser, a, b, c, d,lv)
 if srcUser == nil or targetUser == nil then
      return 0
  end

  local Dex=srcUser:GetProperty("Dex")
  local A= -math.floor(Dex/2)
  
  return A
end------------------------------------------------------------------噩梦（减少6围）

function CommonFun.calcBuff_3743(srcUser, targetUser, a, b, c, d,lv)
 if srcUser == nil or targetUser == nil then
      return 0
  end

  local Agi=srcUser:GetProperty("Agi")
  local A= -math.floor(Agi/2)
  
  return A
end------------------------------------------------------------------噩梦（减少6围）

function CommonFun.calcBuff_3744(srcUser, targetUser, a, b, c, d,lv)
 if srcUser == nil or targetUser == nil then
      return 0
  end

  local Vit=srcUser:GetProperty("Vit")
  local A= -math.floor(Vit/2)

  return A
end
------------------------------------------------------------------噩梦（减少6围）
function CommonFun.calcBuff_3745(srcUser, targetUser, a, b, c, d,lv)
 if srcUser == nil or targetUser == nil then
      return 0
  end

  local Luk=srcUser:GetProperty("Luk")
  local A= -math.floor(Luk/2)
  
  return A
end
----------------------------------------------------------------------------------强韧
function CommonFun.calcBuff_3750(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end
  
  local Skilllv = srcUser:GetLernedSkillLevel(103740)
  local QualityValue_a = 0
  local QualityValue_b = 0

  QualityValue_a = math.ceil(Skilllv/2)  --向上取整(技能等级为单数时增加)
  QualityValue_b = math.floor(Skilllv/2)  --向下取整(技能等级为双数时增加)
 
  if a == 1 then
    return QualityValue_a
  elseif b == 1 then
    return QualityValue_b
  else
    return 0
  end
end
-------------
---------------------------------------------------------------------星盘按技能等级计算

function CommonFun.calcBuff_3760(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
   local Num = srcUser:GetRunePoint(c)

   local A = lv*a*Num
   --print("lv="..lv,"a="..a,"b="..b,"c="..c,"Num="..Num,"A="..A)

  return A
end
--------------------------------------------------------------------------------擒拿
function CommonFun.calcBuff_3770(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local Num = srcUser:GetRunePoint(93030)
   local MaxHp = targetUser:GetProperty("MaxHp")

   local A =-(Num*0.5/100*MaxHp)

   if targetUser.boss == true and targetUser.mini == true then
        A = 0
   end

   return A 

end
--------------------------------------------------------------------------------正义裁决
function CommonFun.calcBuff_3780(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local Num = srcUser:GetRunePoint(13030)
   local Vit = targetUser:GetProperty("Vit")

   local A =Num*1/5*Vit


   return A 

end
-------------------------------------------------------------------------------金刚不坏
function CommonFun.calcBuff_3790(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local Num = srcUser:GetRunePoint(123010)


   local A =(1-Num)*lv*a+Num*10


   return A 

end
-------------------------------------------------------------------------------攻防转换
function CommonFun.calcBuff_3800(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local Num = srcUser:GetRunePoint(123030)
   local Atk = srcUser:GetProperty("Atk")
   local AtkPer = srcUser:GetProperty("AtkPer")

   local A = math.floor((Atk*(1+AtkPer)*0.2*Num)/50)    


   return A 

end
-------------------------------------------------------------------------------攻防转换
function CommonFun.calcBuff_3810(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local skill = srcUser:GetLernedSkillLevel(192) ----------------隐匿强化
   ---------------------------星盘隐匿强化
   local Num1 = srcUser:GetRunePoint(33040)

   local A = skill*2 + 1 + Num1


   return A 

end
--------------------------------------------------------------------------------循环自然之声
function CommonFun.calcBuff_3820(srcUser, targetUser, a, b, c, d,lv)
     if srcUser == nil or targetUser == nil then
      return 0
   end
   local skilllv_1 = srcUser:GetLernedSkillLevel(1391)-------循环自然之声（舞娘）
   local skilllv_2 = srcUser:GetLernedSkillLevel(1440)-------循环自然之声（诗人）
   local Vit = srcUser:GetProperty("Vit")
   local Int = srcUser:GetProperty("Int")
   local BeHealEncPer2 = targetUser:GetProperty("BeHealEncPer")
   local HealEncPer = srcUser:GetProperty("HealEncPer")
   -----------------------------------------------------------诗人舞娘星盘
   local Num = srcUser:GetRunePoint(102045)

   local A = ((skilllv_1+skilllv_2)*3+20)*(Vit/2+Int)*(1+HealEncPer)*(1+BeHealEncPer2)*(1+Num*0.05)

   return A 
end
----------------------------------------------------------------------------------丑陋之舞
function CommonFun.calcBuff_3830(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local IgnoreDef = 0
  local IgnoreDef1 = srcUser:GetProperty("IgnoreDef")
  local IgnoreDef2 = srcUser:GetProperty("IgnoreEquipDef")
  if targetUser.boss or targetUser.mini then
     IgnoreDef=IgnoreDef1
  else
     IgnoreDef=(IgnoreDef1+IgnoreDef2)  
  end
  
  if IgnoreDef >= 1 then
     IgnoreDef=1
  end 

  local Def2 = targetUser:GetProperty("Def")
  local DefPer2 = targetUser:GetProperty("DefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local VitPer2 = targetUser:GetProperty("VitPer")
  local DamReduc2 = CommonFun.calcDamReDuc(srcUser, targetUser)
  local RefineDamReduc = targetUser:GetProperty("RefineDamReduc")
  local Sp = srcUser:GetProperty("Sp")

  local skilllv_1 = srcUser:GetLernedSkillLevel(1367)-----丑陋之舞
  ----------------------------物理防御减免
  local DefReduc= CommonFun.CalcDef(Def,Vit,srcUser,targetUser)

  local A = -(Sp*(skilllv_1+1)*DefReduc*(1-RefineDamReduc)*(1-DamReduc2)-Vit2*(1+VitPer2))

  ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = -1
    end
        --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = -1
    end

  --print("A="..A,"Sp="..Sp,"Luk="..Luk)

  return A

end
----------------------------------------------------------------------------------不和谐音
function CommonFun.calcBuff_3840(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local IgnoreDef = 0
  local IgnoreDef1 = srcUser:GetProperty("IgnoreDef")
  local IgnoreDef2 = srcUser:GetProperty("IgnoreEquipDef")
  if targetUser.boss or targetUser.mini then
     IgnoreDef=IgnoreDef1
  else
     IgnoreDef=(IgnoreDef1+IgnoreDef2)  
  end
  
  if IgnoreDef >= 1 then
     IgnoreDef=1
  end 

  local Def2 = targetUser:GetProperty("Def")
  local DefPer2 = targetUser:GetProperty("DefPer")
  local Vit2 = targetUser:GetProperty("Vit")
  local VitPer2 = targetUser:GetProperty("VitPer")
  local DamReduc2 = CommonFun.calcDamReDuc(srcUser, targetUser)
  local RefineDamReduc = targetUser:GetProperty("RefineDamReduc")
  local Atk = srcUser:GetProperty("Atk")
  local AtkPer = srcUser:GetProperty("AtkPer")

  local skilllv_1 = srcUser:GetLernedSkillLevel(1418)-----不和谐音
  ----------------------------物理防御减免
  local DefReduc= CommonFun.CalcDef(Def,Vit,srcUser,targetUser)

  local A = -(Atk*(1+AtkPer)*(skilllv_1*1.2+1.2)*DefReduc*(1-RefineDamReduc)*(1-DamReduc2)-Vit2*(1+VitPer2))

  ------------------------------------------攻击年兽伤害为1
    if targetUser:GetNpcID() == 30043 or targetUser:GetNpcID() == 56008 or targetUser:GetNpcID() == 56009 or targetUser:GetNpcID() == 56010 or targetUser:GetNpcID() == 56011 or targetUser:GetNpcID() == 56012 or targetUser:GetNpcID() == 56013 then
        A = -1
    end
        --------------------------------------------不对每次受伤只掉1血的生效
    if targetUser:DamageAlways1() then
        A = -1
    end

  --print("A="..A,"Sp="..Sp,"Luk="..Luk)

  return A

end
---------------------------------------------------------------------      雷拉德的晨露  合奏 属性 技能相关的计算
function CommonFun.calcBuff_3850(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
  local Ensemble = srcUser:GetEnsemblePartner()           ----------获取伴奏者

   if Ensemble==nil then
      return 0
   end
   
  local mapid,maptype = srcUser:GetMapInfo()-----------------获取所在地图

   local MaxHp1 = srcUser:GetProperty("MaxHp")
   local MaxHp2 = Ensemble:GetProperty("MaxHp")   ----------获取伴奏者属性
  ----------------------------------------------------------竞技场最大生命除以4
   local MaxHp = MaxHp1+MaxHp2

  if maptype==2 or maptype==4 then
     MaxHp = (MaxHp1+MaxHp2)*0.25
  end

   local A = 0

   if lv <=10 then
      A = MaxHp*0.05 + lv *400 + 1000
   elseif lv>10 then
      A = MaxHp*(0.05 + (lv-10)*0.01) + 5000
   end
   --print("lv="..lv,"a="..a,"b="..b,"c="..c,"Num="..Num,"A="..A)

  return A
end
---------------------------------------------------------------------      远古夕阳之歌  合奏 属性 技能相关的计算
function CommonFun.calcBuff_3860(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
  local Ensemble = srcUser:GetEnsemblePartner()           ----------获取伴奏者

   if Ensemble==nil then
      return 0
   end
   
   local Atk1 = srcUser:GetProperty("Atk")
   local AtkPer1 = srcUser:GetProperty("AtkPer")
   local Atk2 = Ensemble:GetProperty("Atk")   ----------获取伴奏者属性
   local AtkPer2 = Ensemble:GetProperty("AtkPer")

   local Atk = Atk1*(1+AtkPer1)+Atk2*(1+AtkPer2)
   ------------------------------------------------------------------星盘
   local Num1 = srcUser:GetRunePoint(102049)
   local Num2 = Ensemble:GetRunePoint(102049)
   local Rune = (Num1+Num2)*0.02+1

   local A = 0

   if lv <=10 then
      A =  lv*15*Rune
   elseif lv>10 then
      A = (Atk*( (lv-10)*0.004 ) + 150)*Rune
   end

  return A
end
---------------------------------------------------------------------      远古夕阳之歌  合奏 属性 技能相关的计算
function CommonFun.calcBuff_3870(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
  local Ensemble = srcUser:GetEnsemblePartner()           ----------获取伴奏者

   if Ensemble==nil then
      return 0
   end
   
   local MAtk1 = srcUser:GetProperty("MAtk")
   local MAtkPer1 = srcUser:GetProperty("MAtkPer")
   local MAtk2 = Ensemble:GetProperty("MAtk")   ----------获取伴奏者属性
   local MAtkPer2 = Ensemble:GetProperty("MAtkPer")

   local MAtk = MAtk1*(1+MAtkPer1)+MAtk2*(1+MAtkPer2)
   ------------------------------------------------------------------星盘
   local Num1 = srcUser:GetRunePoint(102048)
   local Num2 = Ensemble:GetRunePoint(102048)
   local Rune = (Num1+Num2)*0.02+1

   local A = 0

   if lv <=10 then
      A = lv*15*Rune
   elseif lv>10 then
      A = (MAtk*((lv-10)*0.004 ) + 150)*Rune
   end

  return A
end

----------------------------------------------------------------------------------命运的塔罗牌
function CommonFun.calcBuff_3880(srcUser, targetUser, a, b, c, d,lv)
--a HP百分比
--b SP百分比

  if srcUser == nil or targetUser == nil then
      return 0
  end

  local Hp = targetUser:GetProperty("Hp")

  local Sp = targetUser:GetProperty("Sp")

  local A = -(Hp*lv*a + Sp*lv*b)

    return A

end
----------------------------------------------------------------------------------安息 摇篮曲
function CommonFun.calcBuff_3890(srcUser, targetUser, a, b, c, d,lv)
--a HP百分比
--b SP百分比

  if srcUser == nil or targetUser == nil then
      return 0
  end

  local MaxHp = targetUser:GetProperty("MaxHp")

  local MaxSp = targetUser:GetProperty("MaxSp")

  local A = MaxHp*lv*a + MaxSp*lv*b

    return A

end
----------------------------------------------------------------------------------死亡轮回
function CommonFun.calcBuff_3900(srcUser, targetUser, a, b, c, d,lv)


  if srcUser == nil or targetUser == nil then
      return 0
  end
  local  HpPerRatio=1
   if Hp<0.8*MaxHp then
            HpPerRatio=2
   end
  local A = -0.5*HpPerRatio
    return A

end



---------------------------------------------------------------狼外婆的拖鞋
function CommonFun.calcBuff_4000(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(4)
  local A =0
  if RefineLv >= 12 and srcUser:HasBuffID(41561)  then 
      A = 0.03
  end

 return A
end
---------------------------------------------------------------法力风暴之杖
function CommonFun.calcBuff_4010(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local skilllv_1 = srcUser:GetLernedSkillLevel(1163)-------元素强化
  local RefineLv = srcUser:GetEquipedRefineLv(7)
  local A = math.min(0.1,skilllv_1 * 0.02)
  if RefineLv >=10 then 
   A = A + (RefineLv-10) * 0.01
  end

   return A 
end

---------------------------------------------------------------献祭之书[第八档]
function CommonFun.calcBuff_4020(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local IgnoreMDef = srcUser:GetProperty("IgnoreMDef")
  local RefineLv=srcUser:GetEquipedRefineLv(1)
  local A = 0
  if RefineLv >= 10 and IgnoreMDef > 0.6 then 
    A = 0.03
  end


   return A 
end

---------------------------------------------------------------------贤者日记

function CommonFun.calcBuff_4030(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
   local Num = srcUser:GetRunePoint(c)
   local RefineLv = srcUser:GetEquipedRefineLv(7)


   local A = lv*a + b + Num*d  + RefineLv*0.3
   --print("lv="..lv,"a="..a,"b="..b,"c="..c,"Num="..Num,"A="..A)

  return A
end

---------------------------------------------------------------------精神手杖

function CommonFun.calcBuff_4040(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   
   local Num = srcUser:GetRunePoint(c)
   local RefineLv = srcUser:GetEquipedRefineLv(7)
   local JS = 0
   if RefineLv == 15 and srcUser:HasBuffID(90002133) then 
        JS = 0.05
   end


   local A = lv*a + b + Num*d  + JS
   --print("lv="..lv,"a="..a,"b="..b,"c="..c,"Num="..Num,"A="..A)

  return A
end

----------------------------------------------------------------------------------精神手杖[第八档]
function CommonFun.calcBuff_4050(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0
  if RefineLv >= 12 and srcUser:HasBuffID(90002137) then 
          A=0.05
  end

 return A
end

----------------------------------------------------------------------------------贤者日记[第八档]
function CommonFun.calcBuff_4060(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =0
  if RefineLv >= 12 and srcUser:HasBuffID(90002147) then 
       A=0.05
  end

 return A
end
----------------------------------------------------------------------------------灵犀宝珠[第八档]

function CommonFun.calcBuff_4070(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(1)
  local A =0
  if RefineLv >= 10 and srcUser:HasBuffID(90002157) then 
          A=0.05
  end

 return A
end

----------------------------------------------------------------------------------代理者拳刃[第八档]

function CommonFun.calcBuff_4080(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =5
  if RefineLv >= 10 and srcUser:HasBuffID(90001333) then 
        A=8
  end

 return A
end

----------------------------------------------------------------------------------暗杀者拳刃

function CommonFun.calcBuff_4081(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local A =5
  if RefineLv >= 10 and srcUser:HasBuffID(41870) then 
        A =8
  end

 return A
end

----------------------------------------------------------------------------------牙科手术刀[第二档]

function CommonFun.calcBuff_4090(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Str=srcUser:GetProperty("Str")
  local A =0
  if  srcUser:HasBuffID(90002161) then 
    if  Str>=240 then 
        A=0.08
    elseif  Str>=200 then 
        A=0.03
    end   
  end

 return A
end

----------------------------------------------------------------------------------巨人战斧[1][第十档]

function CommonFun.calcBuff_4100(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Str=srcUser:GetProperty("Str")
  local A =0
  if  srcUser:HasBuffID(90000909) and Str>=240 then 
        A=0.1
  end

 return A
end
----------------------------------------------------------------------------------超重双手斧[第四档]

function CommonFun.calcBuff_4110(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Str=srcUser:GetProperty("Str")
  local A =0
  if  srcUser:HasBuffID(90002173) then 
    if  Str>=240 then 
        A=0.15
    elseif  Str>=210 then 
        A=0.08
    elseif  Str>=180 then 
        A=0.03
    end   
  end

 return A
end

----------------------------------------------------------------------------------超重双手斧[第四档]

function CommonFun.calcBuff_4120(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Str=srcUser:GetProperty("Str")
  local A =0.05
  if  srcUser:HasBuffID(90002173) then 
    if  Str>=240 then 
        A=0.25
    elseif  Str>=210 then 
        A=0.15
    elseif  Str>=180 then 
        A=0.1
    end
  end

 return A
end


----------------------------------------------------------------------------------瓶中精灵
function CommonFun.calcBuff_4130(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
 
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)
  local Ring1=srcUser:GetEquipedID(5)
  local Ring2=srcUser:GetEquipedID(6)

  local a = 0
  local b = 0
  local c = 0
  local d = 0
  local A = 3

  if srcUser:HasBuffID(90002223) and (Ring1==44038 or Ring1==144038) and RefineLv1>=10 then
      a = 1
  end
  if srcUser:HasBuffID(90002223)  and (Ring2==44038 or Ring2==144038) and RefineLv2>=10 then
      b = 1
  end
  if srcUser:HasBuffID(90002223) and (Ring1==44038 or Ring1==144038) and RefineLv1==15 then
      c = 1
  end
  if srcUser:HasBuffID(90002223) and (Ring2==44038 or Ring2==144038) and RefineLv2==15 then
      d = 1
  end

 local A = 3 + math.min(1,a+b ) + math.min(1,c+d ) 

 return A
end

----------------------------------------------------------------------------------奥尔里昂的手套[第十档]
function CommonFun.calcBuff_4140(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring1=srcUser:GetEquipedID(5)
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local Ring2=srcUser:GetEquipedID(6)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)

  local a = 0
  local b = 0

  if (Ring1==44005 or Ring1==144005) and RefineLv1>=12 then
      a = 0.03
        end
  if (Ring2==44005 or Ring2==144005) and RefineLv2>=12 then
      b = 0.03
  end

 local A = a + b  

 return A
end


----------------------------------------------------------------------------------奥尔里昂的项链[第十档]
function CommonFun.calcBuff_4150(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring1=srcUser:GetEquipedID(5)
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local Ring2=srcUser:GetEquipedID(6)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)

  local a = 0
  local b = 0

  if (Ring1==44004 or Ring1==144004) and RefineLv1>=5 then
      a = 30
        end
  if (Ring2==44004 or Ring2==144004) and RefineLv2>=5 then
      b = 30
  end

 local A = a + b  

 return A
end


----------------------------------------------------------------------------------奥尔里昂的项链[第十档]
function CommonFun.calcBuff_4160(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local Ring1=srcUser:GetEquipedID(5)
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local Ring2=srcUser:GetEquipedID(6)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)

  local a = 0
  local b = 0

  if (Ring1==44004 or Ring1==144004) and RefineLv1>=10 then
      a = 0.03
        end
  if (Ring2==44004 or Ring2==144004) and RefineLv2>=10 then
      b = 0.03
  end

 local A = a + b  

 return A
end

----------------------------------------------------------------------------------黑狐颈链[第十档]
function CommonFun.calcBuff_4170(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
 
  local RefineLv1=srcUser:GetEquipedRefineLv(5)
  local RefineLv2=srcUser:GetEquipedRefineLv(6)
  local Ring1=srcUser:GetEquipedID(5)
  local Ring2=srcUser:GetEquipedID(6)

  local a = 0
  local b = 0
  local c = 0
  local d = 0
  local A = 5

  if srcUser:HasBuffID(90001679) and (Ring1==44021 or Ring1==144021) and RefineLv1>=10 then
      a = 1
  end
  if srcUser:HasBuffID(90001679)  and (Ring2==44021 or Ring2==144021) and RefineLv2>=10 then
      b = 1
  end
  if srcUser:HasBuffID(90001679)  and (Ring1==44021 or Ring1==144021) and RefineLv1==15 then
      c = 2
  end
  if srcUser:HasBuffID(90001679)  and (Ring2==44021 or Ring2==144021) and RefineLv2==15 then
      d = 2
  end

 local A = 5 + math.min(1,a+b ) + math.min(2,c+d ) 

 return A
end



----------------------------------------------------------------------------------伯爵斗篷[第四档]
function CommonFun.calcBuff_4180(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv1=srcUser:GetEquipedRefineLv(3)
  local IgnoreDef = srcUser:GetProperty("IgnoreDef")
  local A = 0
  if (RefineLv1 >=8 and srcUser:HasBuffID(90002263))  then
      A = IgnoreDef*100*0.5
  end

 return A
end

----------------------------------------------------------------------------------伯爵斗篷[第四档]
function CommonFun.calcBuff_4190(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv1=srcUser:GetEquipedRefineLv(3)
  local A = 0
  if (RefineLv1 >=12 and srcUser:HasBuffID(90002263) )  then
      A = 0.03
  end

 return A
end
--------------------------------------------------------------------------------孤注一掷
function CommonFun.calcBuff_4200(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
   local MDef2 = srcUser:GetProperty("MDef")
   local MDefPer2 = srcUser:GetProperty("MDefPer")
   local A =MDef2*(1+MDefPer2)*2
   
   return A 

end

--------------------------------------------------------------------------------【亡者-鹗枭男爵卡片】和【鹗枭男爵★卡片】
function CommonFun.calcBuff_4210(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
  local A = 20
  if ( srcUser:HasBuffID(52950) and srcUser:HasBuffID(53050) )  then
      A = 45
  end
   
   return A 

end


----------------------------------------------------------------死灵★卡片

function CommonFun.calcBuff_4220(srcUser, targetUser, a, b, c, d,lv)
 if srcUser == nil or targetUser == nil then
      return 0
  end

  local Agi=srcUser:GetProperty("Agi")
  local A= 0.075
  if Agi > 180 then 
    A= 0.075+0.05
  end
   return A 

end



----------------------------------------------------------------贤者之书

function CommonFun.calcBuff_4230(srcUser, targetUser, a, b, c, d,lv)
 if srcUser == nil or targetUser == nil then
      return 0
  end

  local Agi=srcUser:GetProperty("Agi")
  local A= math.floor(Agi/20)/100
  
    return A

  end

----------------------------------------------------------------完美舞姿卡片

function CommonFun.calcBuff_4240(srcUser, targetUser, a, b, c, d,lv)
 if srcUser == nil or targetUser == nil then
      return 0
  end

  local MaxSp = srcUser:GetProperty("MaxSp")
  local A= math.floor(MaxSp/800)*0.01
  
    return A

  end

 ----------------------------------------------------------------土人★卡片
function CommonFun.calcBuff_4250(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
  local A = 15
  local RefineLv2=srcUser:GetEquipedRefineLv(2)

  if ( srcUser:HasBuffID(53150) and RefineLv2 >=10 )  then
      A = 30
  end
   
   return A 

end


---------------------------------------------------------------精炼+b以上，每精炼+1,属性+a，c固定值[3号位通用]
function CommonFun.calcBuff_4260(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(8)
  local A =c

  if RefineLv > b then 
      A=(RefineLv-b)* a + A
  end

 return A
end
----------------------------------------------------------------------------------地元素领域
function CommonFun.calcBuff_4270(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local Num1 = targetUser:GetBuffLayer(118142)
  local A = 0

  if Num1 >=3 then 
      A = 100
  end

  return A

end

 ----------------------------------------------------------------审判之锤
function CommonFun.calcBuff_4280(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
  local A = 0

  if ( srcUser:HasBuffID(41240) or srcUser:HasBuffID(41970) )  then
      A = 15
  end
   
   return A 

end


 ----------------------------------------------------------------厨神的祝福
function CommonFun.calcBuff_4290(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
  local A = 0

  if  srcUser:HasBuffID(8004)   then
      A = 1
  end
   
   return A 

end

 ----------------------------------------------------------------厨神的祝福
function CommonFun.calcBuff_4300(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
  local A = 0

  if  srcUser:HasBuffID(8004)   then
      A = 8
  end
   
   return A 

end

----------------------------------------------------------------------------------致命一击
function CommonFun.calcBuff_4310(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
    return 0
  end

  local Num1 = targetUser:GetBuffLayer(161740)
  local MaxHp = targetUser:GetProperty("MaxHp")
  local A = math.min(Num1*0.3+0.3,1)*MaxHp


  return -A

end


------------------------------------------------------------------------无影无踪
function CommonFun.calcBuff_4320(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local StunAtk = srcUser:GetProperty("StunAtk")
  local StunDef2 = targetUser:GetProperty("StunDef")
  local StunDam  = (1 + StunAtk - StunDef2)
  if StunDam <=0 then
     StunDam  =0
  end 
  ---------------------------------------------------------------------异常状态的每个公式必加
  local StateAtk  = srcUser:GetProperty("StateAtk")
  local StateDef2 = targetUser:GetProperty("StateDef")
  local StateDam  = (1 + StateAtk - StateDef2)
  if StateDam<=0 then
     StateDam =0
  end 
  
  local StateEffect = targetUser:GetProperty("StateEffect")
  local bits=CommonFun.getBits(StateEffect)

  local Profession=srcUser:GetProfressionID()
  if bits[CommonFun.StateEffect.Poison] ==1 and (Profession==32 or Profession==33 or Profession==34) then 
    b= 5
  end
  
  local A= b*StunDam*StateDam*CommonFun.calcAttrDizzyRate(srcUser, targetUser)

  --------------print("b="..b,"A="..A)

  if A <= 0 then
    return 0
  end   

  return A
end


 ----------------------------------------------------------------奈伯利安·星切
function CommonFun.calcBuff_4330(srcUser, targetUser, a, b, c, d,lv)
   if srcUser == nil or targetUser == nil then
      return 0
   end
  local A = 0

  if  srcUser:HasBuffID(34152)   then
      A = 100
  end
   
   return A 

end


----------------------------------------------------------------阿斯特蕾娅的眷恋

function CommonFun.calcBuff_4340(srcUser, targetUser, a, b, c, d,lv)
 if srcUser == nil or targetUser == nil then
      return 0
  end

  local Agi=srcUser:GetProperty("Agi")
  local A= math.floor(Agi/2)
  
    return A

  end

---------------------------------------------------------------放浪者外套
function CommonFun.calcBuff_4350(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(2)
  local A =0

  if (RefineLv >= 10 and srcUser:HasBuffID(90001623) )then 
      A= a 
  end

 return A
end

---------------------------------------------------------------格里芬之爪
function CommonFun.calcBuff_4360(srcUser, targetUser, a, b, c, d,lv)
  if srcUser == nil or targetUser == nil then
      return 0
  end
  local RefineLv=srcUser:GetEquipedRefineLv(7)
  local Ring1=srcUser:GetEquipedID(7)
  local A =100

  if (Ring1==62540 or Ring1==162540) then 
       A=RefineLv* a + A + b
  end

 return A
end

CommonFun.BaseAttrCalNoPer = {
    "Cri",
    "MaxHp" ,
    "MaxSp",
    "MoveSpd",
    "Hit" ,
    "Flee" , 
    "RestoreSpd" ,
    "SpRestoreSpd"
}

function CommonFun.checkIsNoNeedPercent(key)
  for i=1,#CommonFun.BaseAttrCalNoPer do
    local single = CommonFun.BaseAttrCalNoPer[i]
    if(single == key)then
      return true
    end
  end
end



CommonFun.CalcBuffFuncs = {
  [20] = CommonFun.calcBuff_20,
  [21] = CommonFun.calcBuff_21,
  [22] = CommonFun.calcBuff_22,
  [23] = CommonFun.calcBuff_23,
  [39] = CommonFun.calcBuff_39,
  [40] = CommonFun.calcBuff_40,
  [41] = CommonFun.calcBuff_41,
  [50] = CommonFun.calcBuff_50,
  [51] = CommonFun.calcBuff_51,
  [52] = CommonFun.calcBuff_52,
  [53] = CommonFun.calcBuff_53,
  [54] = CommonFun.calcBuff_54,
  [55] = CommonFun.calcBuff_55,
  [56] = CommonFun.calcBuff_56,
  [57] = CommonFun.calcBuff_57,
  [58] = CommonFun.calcBuff_58,
  [59] = CommonFun.calcBuff_59,
  [60] = CommonFun.calcBuff_60,
  [61] = CommonFun.calcBuff_61,
  [62] = CommonFun.calcBuff_62,
  [100] = CommonFun.calcBuff_100,
  [101] = CommonFun.calcBuff_101,
  [102] = CommonFun.calcBuff_102,
  [103] = CommonFun.calcBuff_103,
  [104] = CommonFun.calcBuff_104,
  [105] = CommonFun.calcBuff_105,
  [106] = CommonFun.calcBuff_106,
  [107] = CommonFun.calcBuff_107,
  [110] = CommonFun.calcBuff_110,
  [111] = CommonFun.calcBuff_111,
  [112] = CommonFun.calcBuff_112,
  [113] = CommonFun.calcBuff_113,
  [114] = CommonFun.calcBuff_114,
  [115] = CommonFun.calcBuff_115,
  [120] = CommonFun.calcBuff_120,
  [130] = CommonFun.calcBuff_130,
  [131] = CommonFun.calcBuff_131,
  [132] = CommonFun.calcBuff_132,
  [140] = CommonFun.calcBuff_140,
  [141] = CommonFun.calcBuff_141,
  [150] = CommonFun.calcBuff_150,
  [151] = CommonFun.calcBuff_151,
  [152] = CommonFun.calcBuff_152,
  [153] = CommonFun.calcBuff_153,
  [154] = CommonFun.calcBuff_154,
  [160] = CommonFun.calcBuff_160,
  [170] = CommonFun.calcBuff_170,
  [171] = CommonFun.calcBuff_171,
  [180] = CommonFun.calcBuff_180,
  [185] = CommonFun.calcBuff_185,
  [190] = CommonFun.calcBuff_190,
  [200] = CommonFun.calcBuff_200,
  [201] = CommonFun.calcBuff_201,
  [202] = CommonFun.calcBuff_202,
  [203] = CommonFun.calcBuff_203,
  [204] = CommonFun.calcBuff_204,
  [205] = CommonFun.calcBuff_205,
  [300] = CommonFun.calcBuff_300,
  [301] = CommonFun.calcBuff_301,
  [302] = CommonFun.calcBuff_302,
  [310] = CommonFun.calcBuff_310,
  [311] = CommonFun.calcBuff_311,
  [320] = CommonFun.calcBuff_320,
  [321] = CommonFun.calcBuff_321,
  [322] = CommonFun.calcBuff_322,
  [323] = CommonFun.calcBuff_323,
  [330] = CommonFun.calcBuff_330,
  [340] = CommonFun.calcBuff_340,
  [350] = CommonFun.calcBuff_350,
  [360] = CommonFun.calcBuff_360,
  [370] = CommonFun.calcBuff_370,
  [380] = CommonFun.calcBuff_380,
  [390] = CommonFun.calcBuff_390,
  [400] = CommonFun.calcBuff_400,
  [401] = CommonFun.calcBuff_401,
  [410] = CommonFun.calcBuff_410,
  [420] = CommonFun.calcBuff_420,
  [421] = CommonFun.calcBuff_421,
  [422] = CommonFun.calcBuff_422,
  [430] = CommonFun.calcBuff_430,
  [440] = CommonFun.calcBuff_440,
  [441] = CommonFun.calcBuff_441,
  [442] = CommonFun.calcBuff_442,
  [450] = CommonFun.calcBuff_450,
  [460] = CommonFun.calcBuff_460,
  [470] = CommonFun.calcBuff_470,
  [471] = CommonFun.calcBuff_471,
  [480] = CommonFun.calcBuff_480,
  [490] = CommonFun.calcBuff_490,
  [500] = CommonFun.calcBuff_500,
  [510] = CommonFun.calcBuff_510,
  [511] = CommonFun.calcBuff_511,
  [520] = CommonFun.calcBuff_520,
  [530] = CommonFun.calcBuff_530,
  [540] = CommonFun.calcBuff_540,
  [550] = CommonFun.calcBuff_550,
  [551] = CommonFun.calcBuff_551,
  [552] = CommonFun.calcBuff_552,
  [560] = CommonFun.calcBuff_560,
  [570] = CommonFun.calcBuff_570,
  [580] = CommonFun.calcBuff_580,
  [590] = CommonFun.calcBuff_590,
  [600] = CommonFun.calcBuff_600,
  [610] = CommonFun.calcBuff_610,
  [620] = CommonFun.calcBuff_620,
  [630] = CommonFun.calcBuff_630,
  [631] = CommonFun.calcBuff_631,
  [640] = CommonFun.calcBuff_640,
  [650] = CommonFun.calcBuff_650,
  [660] = CommonFun.calcBuff_660,
  [670] = CommonFun.calcBuff_670,
  [671] = CommonFun.calcBuff_671,
  [680] = CommonFun.calcBuff_680,
  [690] = CommonFun.calcBuff_690,
  [700] = CommonFun.calcBuff_700,
  [710] = CommonFun.calcBuff_710,
  [720] = CommonFun.calcBuff_720,
  [730] = CommonFun.calcBuff_730,
  [731] = CommonFun.calcBuff_731,
  [732] = CommonFun.calcBuff_732,
  [733] = CommonFun.calcBuff_733,
  [734] = CommonFun.calcBuff_734,
  [740] = CommonFun.calcBuff_740,
  [741] = CommonFun.calcBuff_741,
  [750] = CommonFun.calcBuff_750,
  [760] = CommonFun.calcBuff_760,
  [770] = CommonFun.calcBuff_770,
  [780] = CommonFun.calcBuff_780,
  [790] = CommonFun.calcBuff_790,
  [800] = CommonFun.calcBuff_800,
  [1000] = CommonFun.calcBuff_1000,
  [1100] = CommonFun.calcBuff_1100,
  [1200] = CommonFun.calcBuff_1200,
  [1300] = CommonFun.calcBuff_1300,
  [1320] = CommonFun.calcBuff_1320,
  [1400] = CommonFun.calcBuff_1400,
  [1500] = CommonFun.calcBuff_1500,
  [1600] = CommonFun.calcBuff_1600,
  [1700] = CommonFun.calcBuff_1700,
  [1701] = CommonFun.calcBuff_1701,
  [1800] = CommonFun.calcBuff_1800,
  [1850] = CommonFun.calcBuff_1850,
  [1900] = CommonFun.calcBuff_1900,
  [1901] = CommonFun.calcBuff_1901,
  [1910] = CommonFun.calcBuff_1910,
  [1920] = CommonFun.calcBuff_1920,
  [1930] = CommonFun.calcBuff_1930,
  [1940] = CommonFun.calcBuff_1940,
  [1950] = CommonFun.calcBuff_1950,
  [1960] = CommonFun.calcBuff_1960,
  [1970] = CommonFun.calcBuff_1970,
  [1980] = CommonFun.calcBuff_1980,  
  [2000] = CommonFun.calcBuff_2000,
  [2010] = CommonFun.calcBuff_2010,  
  [2020] = CommonFun.calcBuff_2020,  
  [2030] = CommonFun.calcBuff_2030, 
  [2040] = CommonFun.calcBuff_2040,
  [2041] = CommonFun.calcBuff_2041,
  [2050] = CommonFun.calcBuff_2050, 
  [2060] = CommonFun.calcBuff_2060, 
  [2061] = CommonFun.calcBuff_2061, 
  [2070] = CommonFun.calcBuff_2070,
  [2080] = CommonFun.calcBuff_2080,  
  [2090] = CommonFun.calcBuff_2090, 
  [2091] = CommonFun.calcBuff_2091,
  [2092] = CommonFun.calcBuff_2092,
  [2093] = CommonFun.calcBuff_2093,
  [2100] = CommonFun.calcBuff_2100,  
  [2110] = CommonFun.calcBuff_2110, 
  [2120] = CommonFun.calcBuff_2120,
  [2121] = CommonFun.calcBuff_2121,
  [2130] = CommonFun.calcBuff_2130,
  [2140] = CommonFun.calcBuff_2140,   
  [2150] = CommonFun.calcBuff_2150, 
  [2151] = CommonFun.calcBuff_2151,   
  [2160] = CommonFun.calcBuff_2160,  
  [2170] = CommonFun.calcBuff_2170,  
  [2180] = CommonFun.calcBuff_2180,  
  [2190] = CommonFun.calcBuff_2190,  
  [2200] = CommonFun.calcBuff_2200,  
  [2210] = CommonFun.calcBuff_2210,
  [2220] = CommonFun.calcBuff_2220,
  [2230] = CommonFun.calcBuff_2230,
  [2240] = CommonFun.calcBuff_2240,
  [2250] = CommonFun.calcBuff_2250,
  [2260] = CommonFun.calcBuff_2260,
  [2270] = CommonFun.calcBuff_2270,
  [2280] = CommonFun.calcBuff_2280,
  [2290] = CommonFun.calcBuff_2290,
  [2300] = CommonFun.calcBuff_2300,
  [2310] = CommonFun.calcBuff_2310,
  [2320] = CommonFun.calcBuff_2320,
  [2330] = CommonFun.calcBuff_2330,
  [2340] = CommonFun.calcBuff_2340,
  [2350] = CommonFun.calcBuff_2350,  
  [2360] = CommonFun.calcBuff_2360,
  [2370] = CommonFun.calcBuff_2370,
  [2380] = CommonFun.calcBuff_2380,
  [2390] = CommonFun.calcBuff_2390,
  [2400] = CommonFun.calcBuff_2400,
  [2410] = CommonFun.calcBuff_2410,
  [2420] = CommonFun.calcBuff_2420,
  [2421] = CommonFun.calcBuff_2421,
  [2430] = CommonFun.calcBuff_2430,
  [2440] = CommonFun.calcBuff_2440,
  [2441] = CommonFun.calcBuff_2441,
  [2442] = CommonFun.calcBuff_2442,
  [2450] = CommonFun.calcBuff_2450,
  [2460] = CommonFun.calcBuff_2460,
  [2470] = CommonFun.calcBuff_2470,
  [2480] = CommonFun.calcBuff_2480,
  [2490] = CommonFun.calcBuff_2490,
  [2500] = CommonFun.calcBuff_2500,
  [2510] = CommonFun.calcBuff_2510,
  [2520] = CommonFun.calcBuff_2520,
  [2530] = CommonFun.calcBuff_2530,
  [2540] = CommonFun.calcBuff_2540,
  [2550] = CommonFun.calcBuff_2550,
  [2560] = CommonFun.calcBuff_2560,
  [2570] = CommonFun.calcBuff_2570,
  [2580] = CommonFun.calcBuff_2580,
  [2581] = CommonFun.calcBuff_2581,
  [2590] = CommonFun.calcBuff_2590,
  [2591] = CommonFun.calcBuff_2591,
  [2592] = CommonFun.calcBuff_2592,
  [2600] = CommonFun.calcBuff_2600,
  [2601] = CommonFun.calcBuff_2601,
  [2610] = CommonFun.calcBuff_2610,
  [2620] = CommonFun.calcBuff_2620,
  [2630] = CommonFun.calcBuff_2630,
  [2640] = CommonFun.calcBuff_2640,
  [2650] = CommonFun.calcBuff_2650,
  [2660] = CommonFun.calcBuff_2660,
  [2670] = CommonFun.calcBuff_2670,
  [2680] = CommonFun.calcBuff_2680,
  [2690] = CommonFun.calcBuff_2690,
  [2691] = CommonFun.calcBuff_2691,
  [2700] = CommonFun.calcBuff_2700,
  [2710] = CommonFun.calcBuff_2710,
  [2720] = CommonFun.calcBuff_2720,
  [2730] = CommonFun.calcBuff_2730,
  [2740] = CommonFun.calcBuff_2740,
  [2750] = CommonFun.calcBuff_2750,
  [2760] = CommonFun.calcBuff_2760,
  [2770] = CommonFun.calcBuff_2770,
  [2780] = CommonFun.calcBuff_2780,
  [2790] = CommonFun.calcBuff_2790,
  [2800] = CommonFun.calcBuff_2800,
  [2810] = CommonFun.calcBuff_2810,
  [2820] = CommonFun.calcBuff_2820,
  [2830] = CommonFun.calcBuff_2830,
  [2840] = CommonFun.calcBuff_2840,
  [2850] = CommonFun.calcBuff_2850,
  [2860] = CommonFun.calcBuff_2860,
  [2870] = CommonFun.calcBuff_2870,
  [2880] = CommonFun.calcBuff_2880,
  [2890] = CommonFun.calcBuff_2890,
  [2900] = CommonFun.calcBuff_2900,
  [2910] = CommonFun.calcBuff_2910,
  [2920] = CommonFun.calcBuff_2920,
  [2930] = CommonFun.calcBuff_2930,
  [2940] = CommonFun.calcBuff_2940,
  [2950] = CommonFun.calcBuff_2950,
  [2960] = CommonFun.calcBuff_2960,
  [2970] = CommonFun.calcBuff_2970,
  [3000] = CommonFun.calcBuff_3000,
  [3010] = CommonFun.calcBuff_3010,
  [3020] = CommonFun.calcBuff_3020,
  [3021] = CommonFun.calcBuff_3021,
  [3030] = CommonFun.calcBuff_3030,
  [3040] = CommonFun.calcBuff_3040,
  [3050] = CommonFun.calcBuff_3050,
  [3051] = CommonFun.calcBuff_3051,
  [3060] = CommonFun.calcBuff_3060,
  [3070] = CommonFun.calcBuff_3070,
  [3080] = CommonFun.calcBuff_3080,
  [3090] = CommonFun.calcBuff_3090,
  [3100] = CommonFun.calcBuff_3100,
  [3110] = CommonFun.calcBuff_3110,
  [3120] = CommonFun.calcBuff_3120,
  [3121] = CommonFun.calcBuff_3121,
  [3122] = CommonFun.calcBuff_3122,
  [3130] = CommonFun.calcBuff_3130,
  [3140] = CommonFun.calcBuff_3140,
  [3150] = CommonFun.calcBuff_3150,
  [3151] = CommonFun.calcBuff_3151,
  [3152] = CommonFun.calcBuff_3152,
  [3160] = CommonFun.calcBuff_3160,
  [3170] = CommonFun.calcBuff_3170,
  [3180] = CommonFun.calcBuff_3180,
  [3181] = CommonFun.calcBuff_3181,
  [3190] = CommonFun.calcBuff_3190,
  [3200] = CommonFun.calcBuff_3200, 
  [3210] = CommonFun.calcBuff_3210, 
  [3220] = CommonFun.calcBuff_3220,
  [3221] = CommonFun.calcBuff_3221,
  [3222] = CommonFun.calcBuff_3222,
  [3223] = CommonFun.calcBuff_3223,
  [3250] = CommonFun.calcBuff_3250,
  [3251] = CommonFun.calcBuff_3251,
  [3252] = CommonFun.calcBuff_3252,
  [3253] = CommonFun.calcBuff_3253,
  [3254] = CommonFun.calcBuff_3254,
  [3300] = CommonFun.calcBuff_3300, 
  [3301] = CommonFun.calcBuff_3301,
  [3302] = CommonFun.calcBuff_3302,
  [3303] = CommonFun.calcBuff_3303,
  [3304] = CommonFun.calcBuff_3304,
  [3310] = CommonFun.calcBuff_3310, 
  [3320] = CommonFun.calcBuff_3320, 
  [3321] = CommonFun.calcBuff_3321, 
  [3322] = CommonFun.calcBuff_3322,
  [3323] = CommonFun.calcBuff_3323, 
  [3324] = CommonFun.calcBuff_3324, 
  [3325] = CommonFun.calcBuff_3325,    
  [3330] = CommonFun.calcBuff_3330, 
  [3340] = CommonFun.calcBuff_3340,  
  [3350] = CommonFun.calcBuff_3350, 
  [3360] = CommonFun.calcBuff_3360, 
  [3370] = CommonFun.calcBuff_3370, 
  [3380] = CommonFun.calcBuff_3380,  
  [3390] = CommonFun.calcBuff_3390, 
  [3400] = CommonFun.calcBuff_3400, 
  [3401] = CommonFun.calcBuff_3401, 
  [3410] = CommonFun.calcBuff_3410, 
  [3420] = CommonFun.calcBuff_3420, 
  [3430] = CommonFun.calcBuff_3430,  
  [3440] = CommonFun.calcBuff_3440,  
  [3441] = CommonFun.calcBuff_3441,  
  [3450] = CommonFun.calcBuff_3450,  
  [3451] = CommonFun.calcBuff_3451, 
  [3452] = CommonFun.calcBuff_3452, 
  [3460] = CommonFun.calcBuff_3460,  
  [3461] = CommonFun.calcBuff_3461,  
  [3470] = CommonFun.calcBuff_3470,  
  [3471] = CommonFun.calcBuff_3471,    
  [3480] = CommonFun.calcBuff_3480, 
  [3481] = CommonFun.calcBuff_3481, 
  [3490] = CommonFun.calcBuff_3490, 
  [3491] = CommonFun.calcBuff_3491, 
  [3492] = CommonFun.calcBuff_3492, 
  [3500] = CommonFun.calcBuff_3500, 
  [3510] = CommonFun.calcBuff_3510, 
  [3511] = CommonFun.calcBuff_3511, 
  [3520] = CommonFun.calcBuff_3520, 
  [3530] = CommonFun.calcBuff_3530, 
  [3540] = CommonFun.calcBuff_3540,
  [3541] = CommonFun.calcBuff_3541,
  [3550] = CommonFun.calcBuff_3550,  
  [3560] = CommonFun.calcBuff_3560, 
  [3570] = CommonFun.calcBuff_3570, 
  [3580] = CommonFun.calcBuff_3580,  
  [3590] = CommonFun.calcBuff_3590,  
  [3600] = CommonFun.calcBuff_3600,
  [3610] = CommonFun.calcBuff_3610,   
  [3620] = CommonFun.calcBuff_3620,  
  [3630] = CommonFun.calcBuff_3630,
  [3640] = CommonFun.calcBuff_3640, 
  [3650] = CommonFun.calcBuff_3650,   
  [3660] = CommonFun.calcBuff_3660,  
  [3670] = CommonFun.calcBuff_3670,
  [3680] = CommonFun.calcBuff_3680, 
  [3690] = CommonFun.calcBuff_3690,
  [3691] = CommonFun.calcBuff_3691,
  [3700] = CommonFun.calcBuff_3700, 
  [3710] = CommonFun.calcBuff_3710, 
  [3720] = CommonFun.calcBuff_3720,  
  [3730] = CommonFun.calcBuff_3730,  
  [3740] = CommonFun.calcBuff_3740,  
  [3741] = CommonFun.calcBuff_3741,  
  [3742] = CommonFun.calcBuff_3742,  
  [3743] = CommonFun.calcBuff_3743,  
  [3744] = CommonFun.calcBuff_3744, 
  [3745] = CommonFun.calcBuff_3745,   
  [3750] = CommonFun.calcBuff_3750, 
  [3760] = CommonFun.calcBuff_3760, 
  [3770] = CommonFun.calcBuff_3770, 
  [3780] = CommonFun.calcBuff_3780, 
  [3790] = CommonFun.calcBuff_3790, 
  [3800] = CommonFun.calcBuff_3800, 
  [3810] = CommonFun.calcBuff_3810,   
  [3820] = CommonFun.calcBuff_3820,
  [3830] = CommonFun.calcBuff_3830,
  [3840] = CommonFun.calcBuff_3840,
  [3850] = CommonFun.calcBuff_3850,
  [3860] = CommonFun.calcBuff_3860,
  [3870] = CommonFun.calcBuff_3870,
  [3880] = CommonFun.calcBuff_3880,
  [3890] = CommonFun.calcBuff_3890,
  [3900] = CommonFun.calcBuff_3900,
  [4000] = CommonFun.calcBuff_4000,
  [4010] = CommonFun.calcBuff_4010,
  [4020] = CommonFun.calcBuff_4020,
  [4030] = CommonFun.calcBuff_4030,
  [4040] = CommonFun.calcBuff_4040,
  [4050] = CommonFun.calcBuff_4050,
  [4060] = CommonFun.calcBuff_4060,
  [4070] = CommonFun.calcBuff_4070,
  [4080] = CommonFun.calcBuff_4080,
  [4081] = CommonFun.calcBuff_4081,
  [4090] = CommonFun.calcBuff_4090,
  [4100] = CommonFun.calcBuff_4100,
  [4110] = CommonFun.calcBuff_4110,
  [4120] = CommonFun.calcBuff_4120,
  [4130] = CommonFun.calcBuff_4130,
  [4140] = CommonFun.calcBuff_4140,
  [4150] = CommonFun.calcBuff_4150,
  [4160] = CommonFun.calcBuff_4160, 
  [4170] = CommonFun.calcBuff_4170,
  [4180] = CommonFun.calcBuff_4180,
  [4190] = CommonFun.calcBuff_4190,
  [4200] = CommonFun.calcBuff_4200,
  [4210] = CommonFun.calcBuff_4210,
  [4220] = CommonFun.calcBuff_4220,
  [4230] = CommonFun.calcBuff_4230,
  [4240] = CommonFun.calcBuff_4240,
  [4250] = CommonFun.calcBuff_4250,
  [4260] = CommonFun.calcBuff_4260,
  [4270] = CommonFun.calcBuff_4270,
  [4280] = CommonFun.calcBuff_4280,
  [4290] = CommonFun.calcBuff_4290,
  [4300] = CommonFun.calcBuff_4300,
  [4310] = CommonFun.calcBuff_4310,
  [4320] = CommonFun.calcBuff_4320,
  [4330] = CommonFun.calcBuff_4330,
  [4340] = CommonFun.calcBuff_4340,
  [4350] = CommonFun.calcBuff_4350,
  [4360] = CommonFun.calcBuff_4360,
}